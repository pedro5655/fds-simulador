<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador FDS - Heineken Brasil</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- Social Media Meta Tags -->
    <meta property="og:image" content="https://pedro5655.github.io/fds-simulador/social-banner.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:title" content="Simulador FDS">
    <meta property="og:description" content="Fotografia de Sucesso - Otimize sua execução no ponto de venda.">
    
    <!-- React e ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para entender JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- html2canvas para gerar a imagem -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- jsPDF para gerar o PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Recharts Dependencies -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        heineken: {
                            green: '#008200',
                            dark: '#005500',
                            red: '#FF0000',
                            silver: '#C3C3C3',
                        }
                    }
                }
            }
        }
    </script>

    <style>body {
  -webkit-font-smoothing: antialiased;
}
.no-scrollbar::-webkit-scrollbar {
  display: none;
}
.no-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
}
    </style>
</head>
<body class="bg-gray-900">
    <div id="root"></div>


    <script type="text/babel">        const { useState, useEffect, useRef } = React;

        // --- NATIVE FILE SAVING HELPER ---
        // --- NATIVE FILE SAVING HELPER ---




        // --- ÍCONES SVG ---
        const IconBase = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Star = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </IconBase>
        );
        const RefreshCw = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                <path d="M21 3v5h-5"></path>
                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                <path d="M8 16H3v5"></path>
            </IconBase>
        );
        const Info = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </IconBase>
        );
        const ChevronDown = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><polyline points="6 9 12 15 18 9"></polyline></IconBase>
        );
        const ChevronUp = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><polyline points="18 15 12 9 6 15"></polyline></IconBase>
        );

        const CheckCircle = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </IconBase>
        );
        const AlertCircle = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </IconBase>
        );
        const Globe = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
            </IconBase>
        );
        const TrendingUp = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </IconBase>
        );
        const AlertTriangle = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </IconBase>
        );
        const X = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </IconBase>
        );

        const ImageIcon = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
            </IconBase>
        );
        const ArrowRight = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
            </IconBase>
        );
        const LayoutGrid = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
            </IconBase>
        );
        const Target = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <circle cx="12" cy="12" r="10"></circle>
                <circle cx="12" cy="12" r="6"></circle>
                <circle cx="12" cy="12" r="2"></circle>
            </IconBase>
        );
        const Download = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </IconBase>
        );

        const Megaphone = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <path d="m3 11 18-5v12L3 14v-3z"></path>
                <path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"></path>
            </IconBase>
        );
        const Tag = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                <line x1="7" y1="7" x2="7.01" y2="7"></line>
            </IconBase>
        );
        const Store = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <path d="M3 21h18v-8a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v8z"></path>
                <path d="M21 10l-1.5-6.5a2 2 0 0 0-2-1.5h-11a2 2 0 0 0-2 1.5L3 10"></path>
                <path d="M10 14v4"></path>
                <path d="M14 14v4"></path>
            </IconBase>
        );

        const LogOut = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </IconBase>
        );











        // --- ICONS EXTRAS (TREINAMENTO) ---
        const Menu = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><line x1="4" y1="12" x2="20" y2="12"></line><line x1="4" y1="6" x2="20" y2="6"></line><line x1="4" y1="18" x2="20" y2="18"></line></IconBase>
        );
        const Home = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></IconBase>
        );
        const ShieldCheck = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><path d="M9 12l2 2 4-4"></path></IconBase>
        );
        const Calculator = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <rect x="4" y="2" width="16" height="20" rx="2"></rect>
                <line x1="8" y1="6" x2="16" y2="6"></line>
                <line x1="16" y1="14" x2="16" y2="18"></line>
                <path d="M16 10h.01"></path>
                <path d="M12 10h.01"></path>
                <path d="M8 10h.01"></path>
                <path d="M12 14h.01"></path>
                <path d="M8 14h.01"></path>
                <path d="M12 18h.01"></path>
                <path d="M8 18h.01"></path>
            </IconBase>
        );

        const ClipboardList = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><path d="M12 11h4"></path><path d="M12 16h4"></path><path d="M8 11h.01"></path><path d="M8 16h.01"></path></IconBase>
        );
        const Users = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></IconBase>
        );
        const ChevronLeft = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><polyline points="15 18 9 12 15 6"></polyline></IconBase>
        );
        const ChevronRight = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><polyline points="9 18 15 12 9 6"></polyline></IconBase>
        );

        const MessageCircleQuestion = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path></IconBase>
        );
        const Footprints = ({ size = 24, className = "" }) => (
             <IconBase className={className} width={size} height={size}><path d="M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 11 3.8 11 8c0 2.25-.79 4.39-2 6" /><path d="M13.12 14c.25-2.25 .83-4.22 2-6 2.13-3.25 5.5-3.25 5.5-3.25C22 4.38 22 7 22 10.5c0 2.5-1.09 3.51-1.02 5.62 .03 .85 .02 1.88-2.98 1.88H15c-3.25 0-3.5-3.25-1.88-4z" /><circle cx="4" cy="20" r="2" /></IconBase>
        );
        const Clock = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></IconBase>
        );
        const Calendar = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></IconBase>
        );
        const Presentation = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><path d="M21 16H3"></path><path d="M10 20H8"></path><path d="M16 20h-2"></path><path d="M4 16l2-10h12l2 10"></path><path d="M12 6v10"></path></IconBase>
        );
        const Award = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></IconBase>
        );
        const CheckCircle2 = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></IconBase>
        );
        const Heart = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></IconBase>
        );
        const Eye = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></IconBase>
        );

        const Search = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </IconBase>
        );

        const ClipboardCopy = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </IconBase>
        );

        const Check = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <polyline points="20 6 9 17 4 12"></polyline>
            </IconBase>
        );

        const Trash2 = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2-2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </IconBase>
        );

        // --- TREINAMENTO CONSTANTS ---
         const COMPANY_DATA = {
          values: ["Respeito e Cuidado", "Paixão", "Diversão", "Coragem"],
          behaviors: ["Moldar", "Conectar", "Desenvolver", "Entregar"],
          purpose: "Criar momentos de verdadeira união para inspirar um mundo melhor.",
          mission: "Nossa estrela em cada coração e em cada copo brasileiro."
        };

         const SAFETY_ATTITUDES = [
          { id: 1, title: "Organize sua Rotina", desc: "Planejamento evita pressa e riscos." },
          { id: 2, title: "Use 100% dos EPIs", desc: "Bota, luvas e óculos. Sem adornos (anéis, colares)." },
          { id: 3, title: "Identifique Riscos", desc: "Comunique responsáveis. Prateleiras seguras, elétrica ok." },
          { id: 4, title: "Equipamentos da Loja", desc: "Escadas em dia. Paleteiras conservadas." },
          { id: 5, title: "Avarias de Produtos", desc: "Cuidado com cortes e piso molhado." },
          { id: 6, title: "Empilhadeiras", desc: "Distância mínima de 5m. Nunca subir nos garfos." },
          { id: 7, title: "Sem Celular na Loja", desc: "Use apenas o corporativo parado em local seguro." },
          { id: 8, title: "Nunca Improvise", desc: "Não use caixas/mesas como escada." },
          { id: 9, title: "Saídas de Emergência", desc: "Conheça a rota de fuga." },
          { id: 10, title: "Segurança no Trânsito", desc: "Respeite sinalizações dentro e fora da loja." },
        ];

         const ROUTINE_STEPS = [
          {
              title: "PREPARE-SE PARA A VISITA E REGISTRE SUA ENTRADA.",
              desc: [
                  "Esteja com as tarefas do dia pré-definidas e faça o check-in no App Execução."
              ]
          },
          {
              title: "FAÇA-SE PRESENTE.",
              desc: [
                  "Cumprimente o cliente e a equipe da loja. Colete o encarte/tabloide vigente e veja promoções dos nossos produtos e da concorrência.",
                  "Verifique se está com todos os EPIs."
              ]
          },
          {
              title: "ORGANIZE A GÔNDOLA.",
              desc: [
                  "Puxe os produtos disponíveis para frente, garantindo nosso espaço primário.",
                  "Observe se todos os produtos estão precificados, de acordo com a política de preços, e verifique a validade dos itens."
              ]
          },
          {
              title: "VERIFIQUE AS DEMAIS ÁREAS DA LOJA.",
              desc: [
                  "Observe a situação dos refrigeradores, pontos extras e displays para planejar o abastecimento. Veja se todos os produtos estão precificados e dentro da régua de preços."
              ]
          },
          {
              title: "PREPARE O ABASTECIMENTO E MANTENHA O ESTOQUE ORGANIZADO.",
              desc: [
                  "Separe os produtos para abastecimento respeitando a regra de “Primeiro que vence, primeiro que sai.”",
                  "Organize o estoque e verifique possíveis estoques virtuais."
              ]
          },
          {
              title: "FAÇA O ABASTECIMENTO DE TODAS AS ÁREAS DA LOJA",
              desc: [
                  "Siga a seguinte ordem: área primária, refrigerador, ilha, ponta de gôndola, displays, cross e correlatos"
              ]
          },
          {
              title: "CONFIRA OS PREÇOS E GARANTA A PRECIFICAÇÃO EM TODOS OS PRODUTOS",
              desc: [
                  "Emita as etiquetas de preço dos itens que foram corrigidos e daqueles que estão sem preço.",
                  "Solicite SPLASH/cartaz para produtos promocionados ou em pontos extras."
              ]
          },
          {
              title: "APLIQUE O MERCHANDISING.",
              desc: [
                  "Aplique os materiais de merchandising disponíveis e específicos para o canal, através da orientação da FDS."
              ]
          },
          {
              title: "CONQUISTE NOVOS ESPAÇOS.",
              desc: [
                  "Tenha bom relacionamento com os funcionários da loja para conquistar espaços adicionais sem que isso implique em custo adicional."
              ]
          },
          {
              title: "REALIZE AS ATIVIDADES PRESENTES NO APLICATIVO DE EXECUÇÃO.",
              desc: [
                  "Pesquisas, avaliações, tarefas, calendários de ações, contratos e Report de Riscos."
              ]
          },
          {
              title: "FAÇA O FECHAMENTO DA VISITA, VALORIZANDO O TRABALHO REALIZADO.",
              desc: [
                  "Comunique para o encarregado da loja todo o trabalho executado e sugira um pedido de produtos, de acordo com a necessidade."
              ]
          }
        ];

         const VISIT_SCRIPT_STEPS = [
          { step: "01", title: "Recepção e Apresentação", desc: "Cumprimente (Bom dia/Boa tarde) e se apresente formalmente: Diga seu nome, tempo de companhia (Heineken) e há quanto tempo atende essa loja específica." },
          { step: "02", title: "Segurança em Primeiro Lugar (SHE)", desc: "Antes de começar a andar, sinalize onde estão as saídas de emergência. Mostre os EPIs fornecidos (botas, luvas, etc.), destacando que auxiliam na segurança." },
          { step: "03", title: "O Tour: Foco nas Categorias", desc: "Comece por Craft, depois Premium, Mainstream e NAB. Tenha em mente o % SOVI das marcas e a evolução do SOVI total da loja no último mês." },
          { step: "04", title: "Pontos Extras e Execução", desc: "Após as bebidas, fale sobre pontos extras: quantos a loja tem vs. total (Ex: '8 de 15') e se as metas por categoria estão sendo batidas (3 Premium, 2 Main, 1 Craft)." },
          { step: "05", title: "A 'Prova Oral'", desc: "Enquanto caminha, esteja preparado para responder perguntas. Consulte a aba 'Simulador de Auditoria' para verificar questionário e respostas." },
          { step: "06", title: "Geladeiras", desc: "Finalize o tour mostrando os equipamentos gelados. Saiba o percentual de SOVI dentro da geladeira." },
          { step: "07", title: "Encerramento", desc: "Conduza a visita até a saída da loja, agradeça e lembre a visita de que os nossos cuidados não terminam na loja." }
        ];

         const PILLARS_SCORE = [
          { name: 'Presença', points: 40, icon: <ClipboardList />, color: 'bg-green-600', desc: "Produtos Obrigatórios" },
          { name: 'Posicionamento', points: 35, icon: <Target />, color: 'bg-green-500', desc: "Onde e como expor" },
          { name: 'Visibilidade', points: 20, icon: <Eye />, color: 'bg-lime-500', desc: "Promoção e Pontos Extras" },
          { name: 'Precificação', points: 5, icon: <AlertTriangle />, color: 'bg-yellow-500', desc: "Sinalização de preço" },
        ];

         const SOVI_CRAFT_DATA = [
          { name: 'Nossas Marcas', value: 53, fill: '#008200' },
          { name: 'Concorrência', value: 47, fill: '#C3C3C3' },
        ];

         const SOVI_PREMIUM_DATA = [
          { name: 'Nossas Marcas', value: 57, fill: '#008200' },
          { name: 'Concorrência', value: 43, fill: '#C3C3C3' },
        ];

         const SOVI_MAINSTREAM_DATA = [
          { name: 'Nossas Marcas', value: 25, fill: '#008200' },
          { name: 'Concorrência', value: 75, fill: '#C3C3C3' },
        ];

         const BRAND_TARGETS = [
          // Craft
          { brand: 'Baden Baden', value: '30%', category: '(Craft)' },
          { brand: 'Eisenbahn Estilos', value: '13%', category: '(Craft)' },
          { brand: 'Blue Moon', value: '4%', category: '(Craft)' },
          { brand: 'Lagunitas', value: '4%', category: '(Craft)' },
          { brand: 'Praya Clássica', value: '2%', category: '(Craft)' },
          
          // Premium
          { brand: 'Heineken', value: '30%', category: '(Premium)' },
          { brand: 'Heineken 0.0', value: '5%', category: '(Premium)' },
          { brand: 'Eisenbahn Pilsen', value: '7%', category: '(Premium)' },
          { brand: 'Eisenbahn Unfiltered', value: '5%', category: '(Premium)' },
          { brand: 'Sol', value: '5%', category: '(Premium)' },
          { brand: 'Amstel Ultra', value: '3%', category: '(Premium)' },
          { brand: 'Praya Lager', value: '2%', category: '(Premium)' },

          // Mainstream
          { brand: 'Amstel', value: '25%', category: '(Mainstream)' },
        ];

         const AUDIT_QUESTIONS = [
          {
            category: 'Institucional',
            question: "Quais são os valores da companhia?",
            answer: "Respeito e cuidado, Paixão, Diversão e Coragem."
          },
          {
            category: 'Institucional',
            question: "Quais são os 4 pilares de comportamento?",
            answer: "Moldar, Conectar, Desenvolver e Entregar."
          },
          {
            category: 'Institucional',
            question: "Qual o propósito da Heineken?",
            answer: "Criar momentos de verdadeira união para inspirar um mundo melhor."
          },
          {
            category: 'Institucional',
            question: "Qual a missão da Heineken?",
            answer: "Nossa estrela em cada coração e em cada copo brasileiro."
          },
          {
            category: 'SOVI',
            question: "O que a CIA pede de cabeça sobre SOVI?",
            answer: "Saber o SOVI de cada categoria atual da loja (Craft 53%, Premium 57%, Mainstream 25%) e ter anotado o SOVI de cada marca."
          },
          {
            category: 'Rotina',
            question: "Como funciona a dinâmica com supervisor e coaching?",
            answer: "Visita semanal do supervisor, Reunião Mensal e Coaching 1x ao mês (treinamento na rotina com feedback)."
          },
          {
            category: 'Rotina',
            question: "Você sabe como alterar o roteiro de lojas?",
            answer: "Sim, é possível alterar através do Involves."
          },
          {
            category: 'Segurança',
            question: "O que fazer se o risco reportado não for resolvido?",
            answer: "Havendo risco, reporte, comunique aos responsáveis de loja e ao gestor direto Heineken para entrar em contato com o canal de She da Cia."
          },
          {
            category: 'Visibilidade',
            question: "Quantos packs para considerar Ponto Extra?",
            answer: "20 packs para Premium e Mainstream, e 5 packs para Craft."
          },
          {
            category: 'Visibilidade',
            question: "Quais as metas de Pontos Extras?",
            answer: (
              <div className="w-full overflow-x-auto">
                <table className="w-full text-[9px] table-fixed">
                  <thead>
                    <tr className="bg-green-700 text-white text-center">
                      <th className="p-0.5 rounded-tl-lg w-16">SEGMENTO</th>
                      <th className="p-0.5">VOL. MÍN. (PCTS)</th>
                      <th className="p-0.5">ATÉ 5 PEs</th>
                      <th className="p-0.5">6 A 10 PEs</th>
                      <th className="p-0.5">11 A 15 PEs</th>
                      <th className="p-0.5">16 A 20 PEs</th>
                      <th className="p-0.5 rounded-tr-lg">&gt;21 PEs</th>
                    </tr>
                  </thead>
                  <tbody className="text-center font-bold text-gray-800">
                    <tr className="bg-amber-100 border-b border-white">
                      <td className="bg-amber-800 text-white p-1 text-left font-bold">CRAFT</td>
                      <td className="bg-amber-900 text-white p-0.5">05</td>
                      <td>-</td>
                      <td>1</td>
                      <td>1</td>
                      <td>1</td>
                      <td>1</td>
                    </tr>
                    <tr className="bg-gray-100 border-b border-white">
                      <td className="bg-black text-white p-1 text-left font-bold">PREMIUM</td>
                      <td className="bg-gray-900 text-white p-0.5">20</td>
                      <td>1</td>
                      <td>2</td>
                      <td>3</td>
                      <td>5</td>
                      <td>6</td>
                    </tr>
                    <tr className="bg-red-100">
                      <td className="bg-heineken-red text-white p-1 text-left font-bold">MAINSTREAM</td>
                      <td className="bg-red-800 text-white p-0.5">20</td>
                      <td>1</td>
                      <td>1</td>
                      <td>2</td>
                      <td>2</td>
                      <td>3</td>
                    </tr>
                  </tbody>
                </table>
                <div className="mt-2 text-[10px] text-gray-500 leading-tight space-y-1 text-left">
                   <p>⚠️ Abaixo do volume mínimo = não pontua.</p>
                   <p>⚠️ PE com material de marca = volume mínimo ignorado.</p>
                   <p>⚠️ Sem PE misto (marcas/embalagens dif). Premium separado de Mainstream.</p>
                   <p>⚠️ Posicione próximo: Corredor diretor, cervejas ou churrasco.</p>
                </div>
              </div>
            )
          },
          {
            category: 'Geral',
            question: "Onde consultar o Book da FDS?",
            answer: "Na Biblioteca do App Involves."
          },
          {
            category: 'Geral',
            question: "Sobre as LIVES do canal OFF?",
            answer: "Link enviado pelo supervisor ou na biblioteca. Liberado mais cedo para assistir em local tranquilo."
          },
          {
             category: 'Rotina',
             question: "Como é realizado o coaching?",
             answer: "Treinamento prático na rotina (tópicos: segurança, metas, FDS, execução, Involves). Ao final, a supervisora fornece feedback."
          },
          {
             category: 'Geral',
             question: "Como é feita a sugestão de pedidos?",
             answer: "Baseada no giro de produtos e estoque virtual para evitar rupturas. Confira os dias de entrega da sua loja com o Gerente."
          },
          {
             category: 'Segurança',
             question: "Quais suas atitudes seguras no dia a dia?",
             answer: "Uso de EPIs (bota, luvas...), sem adornos, sinalização de riscos e respeito ao trânsito de equipamentos (5m de distância)."
          },
          {
             category: 'Segurança',
             question: "Onde você reporta um risco na loja?",
             answer: "No App Involves. Também comunico imediatamente os gestores da loja e meu Gestor direto."
          },
          {
             category: 'Visibilidade',
             question: "Qual a importância do Ponto Extra e Cross?",
             answer: "Impulsionar vendas fora da área primária (gôndola natural) e gerar vendas por impulso."
          },
          {
             category: 'Visibilidade',
             question: "Quais os produtos mais vendidos da loja?",
             answer: "Saiba os 'campeões' de cada categoria (ex: Heineken 600ml, Amstel Lata). Consulte o histórico da sua loja."
          },
          {
             category: 'Rotina',
             question: "Quais pesquisas são feitas no Involves e os dias?",
             answer: "Rotineiramente: Preço, Share (SOVI), Ruptura, Validade e Pontos Extras. É crucial saber os dias específicos da sua grade de pesquisas."
          }
        ];
        
        // --- TREINAMENTO MODULE COMPONENTS ---
        const ModuleSafety = () => {
          const [activeTab, setActiveTab] = useState('safety');

          return (
            <div className="space-y-6">
              <div className="flex p-1 bg-gray-200 rounded-lg">
                <button 
                  onClick={() => setActiveTab('safety')}
                  className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${activeTab === 'safety' ? 'bg-white shadow text-heineken-green' : 'text-gray-500'}`}
                >
                  Segurança (10 Atitudes)
                </button>
                <button 
                  onClick={() => setActiveTab('routine')}
                  className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${activeTab === 'routine' ? 'bg-white shadow text-heineken-green' : 'text-gray-500'}`}
                >
                  Rotina Diária (11 Passos)
                </button>
              </div>

              {activeTab === 'safety' ? (
                <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                  <div className="bg-white p-6 rounded-xl shadow-sm border-l-4 border-heineken-green">
                    <h2 className="text-2xl font-bold text-heineken-green flex items-center gap-2">
                      <ShieldCheck className="w-8 h-8" />
                      10 Atitudes Seguras
                    </h2>
                    <p className="text-gray-600 mt-2">Segurança em primeiro lugar. Essas atitudes são inegociáveis.</p>
                  </div>

                  <div className="flex flex-col gap-4">
                    {SAFETY_ATTITUDES.map((item) => (
                      <div key={item.id} className="bg-white p-4 rounded-lg shadow hover:shadow-md transition-shadow">
                        <div className="flex items-start gap-3">
                          <div className="bg-green-100 text-heineken-green font-bold rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0">
                            {item.id}
                          </div>
                          <div>
                            <h3 className="font-bold text-gray-800">{item.title}</h3>
                            <p className="text-sm text-gray-600 mt-1">{item.desc}</p>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>

                  <div className="bg-yellow-50 p-4 rounded-lg border border-yellow-200 flex gap-3">
                    <AlertTriangle className="text-yellow-600 w-6 h-6 flex-shrink-0" />
                    <div>
                      <h4 className="font-bold text-yellow-800">Reporte de Riscos</h4>
                      <p className="text-sm text-yellow-700">
                        Identificou um risco? Reporte imediatamente no <strong>App Involves</strong> e avise o gerente da loja.
                      </p>
                    </div>
                  </div>
                </div>
              ) : (
                <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                  <div className="bg-white p-6 rounded-xl shadow-sm border-l-4 border-heineken-green">
                    <h2 className="text-2xl font-bold text-heineken-green flex items-center gap-2">
                      <Footprints className="w-8 h-8" />
                      Os 11 Passos da Execução
                    </h2>
                    <p className="text-gray-600 mt-2">Siga o trajeto definido e cumpra a rotina perfeita.</p>
                  </div>

                  <div className="flex flex-col gap-4 my-8">
                    {ROUTINE_STEPS.map((step, index) => (
                      <div key={index} className="bg-white p-4 rounded-lg shadow hover:shadow-md transition-shadow">
                        <div className="flex items-start gap-3">
                          <div className="bg-green-100 text-heineken-green font-bold rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0">
                            {index + 1}
                          </div>
                          <div>
                            <h3 className="font-bold text-gray-800">{step.title}</h3>
                            <div className="text-sm text-gray-600 mt-1 space-y-1">
                              {step.desc.map((d, i) => (
                                <p key={i}>{d}</p>
                              ))}
                            </div>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="bg-white p-4 rounded-lg shadow border-t-4 border-blue-500">
                      <div className="flex items-center gap-2 mb-2">
                        <Clock className="text-blue-500" />
                        <h3 className="font-bold text-gray-800">Horário</h3>
                      </div>
                      <ul className="text-sm text-gray-600 space-y-1">
                        <li>44 horas semanais</li>
                        <li>Check-in: 08:00hs</li>
                        <li>Almoço: 1h de duração</li>
                        <li>Check-out: 16:20hs</li>
                      </ul>
                    </div>

                    <div className="bg-white p-4 rounded-lg shadow border-t-4 border-purple-500">
                      <div className="flex items-center gap-2 mb-2">
                        <Calendar className="text-purple-500" />
                        <h3 className="font-bold text-gray-800">Rotina Mensal</h3>
                      </div>
                      <ul className="text-sm text-gray-600 space-y-1">
                        <li>Matinal: 1x semana (30min)</li>
                        <li>Reunião Mensal: 1x mês (Presencial)</li>
                        <li>Visita Supervisor: 1x semana</li>
                        <li>Coaching: 1x mês</li>
                      </ul>
                    </div>
                  </div>
                </div>
              )}

              {/* Bottom Navigation Tabs */}
              <div className="flex p-1 bg-gray-200 rounded-lg mt-12">
                <button 
                  onClick={() => { setActiveTab('safety'); window.scrollTo({ top: 0, behavior: 'smooth' }); }}
                  className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${activeTab === 'safety' ? 'bg-white shadow text-heineken-green' : 'text-gray-500'}`}
                >
                  Segurança (10 Atitudes)
                </button>
                <button 
                  onClick={() => { setActiveTab('routine'); window.scrollTo({ top: 0, behavior: 'smooth' }); }}
                  className={`flex-1 py-2 text-sm font-bold rounded-md transition-all ${activeTab === 'routine' ? 'bg-white shadow text-heineken-green' : 'text-gray-500'}`}
                >
                  Rotina Diária (11 Passos)
                </button>
              </div>
            </div>
          );
        };

        const ModuleVisit = () => {
          // Simplificado apenas para Roteiro de Visita
          return (
            <div className="space-y-6 pb-20">
               <div className="bg-white p-6 rounded-xl shadow-sm border-l-4 border-heineken-green">
                <h2 className="text-2xl font-bold text-heineken-green flex items-center gap-2">
                  <Presentation className="w-8 h-8" />
                  Roteiro de Visita
                </h2>
                <p className="text-gray-600 mt-2">O passo a passo para apresentar sua loja durante uma auditoria ou visita do supervisor.</p>
              </div>

              <div className="space-y-4">
                {VISIT_SCRIPT_STEPS.map((step, idx) => (
                  <div key={idx} className="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden">
                    <div className="bg-gray-50 px-4 py-2 border-b border-gray-100 flex justify-between items-center">
                      <span className="font-black text-heineken-green text-lg">PASSO {step.step}</span>
                      <ChevronRight className="text-gray-300 w-5 h-5" />
                    </div>
                    <div className="p-4">
                      <h3 className="font-bold text-gray-800 mb-1">{step.title}</h3>
                      <p className="text-gray-600 text-sm leading-relaxed">{step.desc}</p>
                    </div>
                  </div>
                ))}
              </div>

               <div className="bg-blue-50 p-4 rounded-lg border border-blue-100 mt-4">
                <p className="text-sm text-blue-800 font-medium text-center">
                  "Visita gabaritada é só correr pro abraço!"
                </p>
              </div>
            </div>
          );
        };

        const ModuleScoring = () => {
          return (
            <div className="space-y-6 pb-20">
              <div className="bg-gradient-to-r from-heineken-green to-heineken-dark text-white p-6 rounded-xl shadow-lg">
                <div className="flex justify-between items-start">
                  <div>
                     <h2 className="text-3xl font-bold flex items-center gap-2">
                      <Award className="w-8 h-8 text-yellow-400" />
                      100 Pontos
                    </h2>
                    <p className="text-green-100 mt-1">Nota máxima que sua loja pode alcançar.</p>
                  </div>
                  <div className="text-right">
                     <span className="text-xs uppercase tracking-wider opacity-75">Fotografia de Sucesso</span>
                     <div className="text-2xl font-bold">2025</div>
                  </div>
                </div>
              </div>

              <div className="grid grid-cols-1 gap-4">
                {PILLARS_SCORE.map((pillar) => (
                  <div key={pillar.name} className="bg-white rounded-lg shadow-sm overflow-hidden flex">
                    <div className={`${pillar.color} w-2`}></div>
                    <div className="p-4 flex-1 flex justify-between items-center">
                      <div className="flex items-center gap-4">
                        <div className={`p-3 rounded-full bg-gray-50 text-gray-600`}>
                          {pillar.icon}
                        </div>
                        <div>
                          <h3 className="font-bold text-gray-800 text-lg">{pillar.name}</h3>
                          <p className="text-sm text-gray-500">{pillar.desc}</p>
                        </div>
                      </div>
                      <div className="text-center">
                        <span className="block text-2xl font-bold text-gray-800">{pillar.points}</span>
                        <span className="text-xs text-gray-400 uppercase font-bold">Pontos</span>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
              
               <div className="bg-white p-6 rounded-xl shadow-sm mt-6">
                <h3 className="font-bold text-gray-800 mb-4 flex items-center gap-2">
                   <Star className="text-yellow-500 fill-yellow-500" />
                   Planograma Ideal
                </h3>
                <div className="flex flex-col gap-2">
                   <p className="text-sm text-gray-600 mb-2">Ordem de exposição na gôndola (Esquerda para Direita):</p>
                   
                   <div className="grid grid-cols-2 gap-1 w-full text-[10px]">
                      <div className="bg-amber-900 text-white py-4 px-1 rounded text-center font-bold flex items-center justify-center break-words leading-tight">CRAFT</div>
                      <div className="bg-heineken-green text-white py-4 px-1 rounded text-center font-bold flex items-center justify-center break-words leading-tight">PREMIUM</div>
                      <div className="bg-red-600 text-white py-4 px-1 rounded text-center font-bold flex items-center justify-center break-words leading-tight text-[9px]">MAINSTREAM</div>
                      <div className="bg-blue-500 text-white py-4 px-1 rounded text-center font-bold flex items-center justify-center break-words leading-tight">ECONOMY</div>
                   </div>
                   
                   <p className="text-xs text-gray-400 mt-2 text-center">
                     *Na ausência de item, substituir pelo próximo à direita.
                   </p>
                </div>
               </div>
            </div>
          );
        };

        // Ensure Recharts is defined to avoid crash
        const RechartsObj = window.Recharts || {};
        const { ResponsiveContainer, PieChart, Pie, Cell, Tooltip: RechartsTooltip, Legend } = RechartsObj;
        
        const ChartCard = ({ title, data, wrapped = true }) => {
            if (!PieChart || !ResponsiveContainer) {
                return (
                    <div className="bg-white p-4 rounded-xl shadow-sm flex flex-col items-center justify-center p-8 text-red-500 border border-red-200">
                        <AlertTriangle size={32} className="mb-2" />
                        <span className="font-bold text-center">Gráfico não disponível</span>
                        <span className="text-xs text-center mt-1">Falha ao carregar biblioteca Recharts</span>
                    </div>
                );
            }

            const content = (
              <div className="flex flex-col items-center w-full">
                <h3 className="font-bold text-gray-800 mb-2">{title}</h3>
                <div className="h-64 w-full">
                  <ResponsiveContainer width="100%" height="100%">
                    <PieChart>
                      <Pie
                        data={data}
                        cx="50%"
                        cy="50%"
                        innerRadius="60%"
                        outerRadius="80%"
                        paddingAngle={5}
                        dataKey="value"
                      >
                        {data.map((entry, index) => (
                          <Cell key={`cell-${index}`} fill={entry.fill} />
                        ))}
                      </Pie>
                      <RechartsTooltip />
                      <Legend iconSize={8} wrapperStyle={{ fontSize: '12px' }} />
                    </PieChart>
                  </ResponsiveContainer>
                </div>
                <div className="text-center mt-[-10px]">
                  <span className="text-3xl font-bold text-heineken-green">{data[0].value}%</span>
                  <p className="text-xs text-gray-500">Meta HEINEKEN</p>
                </div>
              </div>
            );

            if (!wrapped) return content;

            return (
              <div className="bg-white p-4 rounded-xl shadow-sm flex flex-col items-center">
                {content}
              </div>
            );
          };

        const ModuleSovi = () => {
          return (
            <div className="space-y-6 pb-20">
              <div className="bg-white p-6 rounded-xl shadow-sm border-l-4 border-heineken-green">
                <h2 className="text-2xl font-bold text-heineken-green flex items-center gap-2">
                  <TrendingUp className="w-8 h-8" />
                  Metas de SOVI 2025
                </h2>
                <p className="text-gray-600 mt-2">Memorize estes números! Eles serão perguntados na auditoria.</p>
              </div>

              {/* Charts Selection - Unified on Desktop */}
              <div className="bg-white p-6 rounded-xl shadow-sm">
                <div className="grid grid-cols-1 md:grid-cols-3 gap-8 divide-y md:divide-y-0 md:divide-x divide-gray-100">
                  <div className="pb-6 md:pb-0 md:px-4">
                     <ChartCard title="Segmento CRAFT" data={SOVI_CRAFT_DATA} wrapped={false} />
                  </div>
                  <div className="py-6 md:py-0 md:px-4">
                     <ChartCard title="Segmento PREMIUM" data={SOVI_PREMIUM_DATA} wrapped={false} />
                  </div>
                  <div className="pt-6 md:pt-0 md:px-4">
                     <ChartCard title="Segmento MAINSTREAM" data={SOVI_MAINSTREAM_DATA} wrapped={false} />
                  </div>
                </div>
              </div>

              <div className="bg-white p-6 rounded-xl shadow-sm">
                <h3 className="font-bold text-gray-800 mb-4 border-b pb-2">Metas por Marca (Destaques)</h3>
                <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                  {BRAND_TARGETS.map((item, idx) => (
                    <div key={idx} className="bg-gray-50 p-3 rounded border border-gray-100">
                      <span className="block text-sm text-gray-500">{item.brand}</span>
                      <span className="block text-lg font-bold text-heineken-green leading-none">{item.value}</span>
                      <span className="block text-[10px] font-bold text-heineken-green/80 uppercase tracking-tight">{item.category}</span>
                    </div>
                  ))}
                </div>
                <div className="mt-4 p-3 bg-red-50 text-red-700 text-sm rounded border border-red-100">
                   <strong>Importante:</strong> Lojas não pontuam por SOVI de marcas DCC, mas as metas são informativas.
                </div>
              </div>
            </div>
          );
        };

        const ModuleQuiz = () => {
          const [openIndex, setOpenIndex] = useState(null);

          const toggleQuestion = (index) => {
            setOpenIndex(openIndex === index ? null : index);
          };

          return (
            <div className="space-y-6 pb-20">
              <div className="bg-heineken-dark text-white p-6 rounded-xl shadow-lg">
                <h2 className="text-2xl font-bold flex items-center gap-2">
                  <MessageCircleQuestion className="w-8 h-8 text-heineken-red" />
                  Simulador de Auditoria
                </h2>
                <p className="text-green-100 mt-2">
                  Perguntas reais que o supervisor ou auditor fará em loja.
                  Toque para revelar a resposta correta.
                </p>
              </div>

              <div className="space-y-3">
                {AUDIT_QUESTIONS.map((q, idx) => (
                  <div 
                    key={idx} 
                    className={`bg-white rounded-lg shadow-sm border transition-all duration-300 ${openIndex === idx ? 'ring-2 ring-heineken-green border-transparent' : 'border-gray-200'}`}
                  >
                    <button
                      onClick={() => toggleQuestion(idx)}
                      className="w-full text-left p-4 flex justify-between items-center focus:outline-none"
                    >
                      <div className="flex items-center gap-3">
                        <span className={`text-xs font-bold px-2 py-1 rounded uppercase flex-shrink-0 ${
                          q.category === 'SOVI' ? 'bg-blue-100 text-blue-700' :
                          q.category === 'Segurança' ? 'bg-red-100 text-red-700' :
                          q.category === 'Visibilidade' ? 'bg-purple-100 text-purple-700' :
                          q.category === 'Institucional' ? 'bg-yellow-100 text-yellow-700' :
                          'bg-gray-100 text-gray-700'
                        }`}>
                          {q.category}
                        </span>
                        <span className="font-semibold text-gray-800 text-sm md:text-base leading-tight">{q.question}</span>
                      </div>
                      {openIndex === idx ? <ChevronUp className="text-heineken-green flex-shrink-0" /> : <ChevronDown className="text-gray-400 flex-shrink-0" />}
                    </button>
                    
                    {openIndex === idx && (
                      <div className="px-4 pb-4 pt-0 animate-in fade-in slide-in-from-top-2 duration-300">
                        <div className="bg-green-50 p-4 rounded-lg border border-green-100 text-gray-700 flex flex-col gap-2">
                          <CheckCircle2 className="w-5 h-5 text-heineken-green flex-shrink-0" />
                          <div className="flex-1 w-full">{q.answer}</div>
                        </div>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>
          );
        };

        const ModuleCompany = () => {
          return (
            <div className="space-y-6 pb-20">
              <div className="bg-white p-6 rounded-xl shadow-sm border-t-4 border-heineken-green">
                <div className="flex justify-center mb-4">
                  <Star className="w-12 h-12 text-heineken-red fill-current animate-pulse" />
                </div>
                <h2 className="text-2xl font-bold text-center text-gray-800 mb-2">Identidade Heineken</h2>
                <p className="text-center text-gray-600">Nossa cultura e quem somos.</p>
              </div>

              {/* Missão */}
              <div className="bg-heineken-green text-white p-6 rounded-xl shadow-lg relative overflow-hidden">
                <div className="relative z-10">
                  <h3 className="font-bold text-lg mb-2 flex items-center gap-2">
                    <Star className="fill-white" size={20} /> Missão
                  </h3>
                  <p className="text-xl font-medium italic">"{COMPANY_DATA.mission}"</p>
                </div>
                <div className="absolute -right-4 -bottom-4 opacity-10">
                  <Star size={120} />
                </div>
              </div>

              {/* Propósito */}
              <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <h3 className="font-bold text-heineken-green text-lg mb-3 flex items-center gap-2">
                   <Heart className="fill-heineken-green" size={20} /> Propósito
                </h3>
                <p className="text-gray-800 text-lg leading-relaxed">
                  {COMPANY_DATA.purpose}
                </p>
              </div>

              {/* Valores */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="bg-white p-5 rounded-xl shadow-sm border-l-4 border-heineken-red">
                  <h3 className="font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <Heart className="text-heineken-red" /> Valores
                  </h3>
                  <ul className="space-y-2">
                    {COMPANY_DATA.values.map((val, idx) => (
                      <li key={idx} className="flex items-center gap-2 text-gray-700">
                        <div className="w-1.5 h-1.5 rounded-full bg-heineken-red"></div>
                        {val}
                      </li>
                    ))}
                  </ul>
                </div>

                <div className="bg-white p-5 rounded-xl shadow-sm border-l-4 border-blue-600">
                  <h3 className="font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <Users className="text-blue-600" /> Comportamentos
                  </h3>
                  <ul className="space-y-2">
                    {COMPANY_DATA.behaviors.map((val, idx) => (
                      <li key={idx} className="flex items-center gap-2 text-gray-700">
                        <div className="w-1.5 h-1.5 rounded-full bg-blue-600"></div>
                        {val}
                      </li>
                    ))}
                  </ul>
                </div>
              </div>
            </div>
          );
        };

        const TreinamentoApp = ({ onNavigateBack, deferredPrompt, installPlatform, setShowInstallModal }) => {
          const [currentScreen, setCurrentScreen] = useState('HOME');
          const [isMenuOpen, setIsMenuOpen] = useState(false);

          const AppScreen = {
              HOME: 'HOME',
              SAFETY: 'SAFETY',
              ROUTINE: 'ROUTINE',
              SCORING: 'SCORING',
              SOVI: 'SOVI',
              VISIBILITY: 'VISIBILITY',
              AUDIT_QUIZ: 'AUDIT_QUIZ',
              COMPANY: 'COMPANY'
          };

          const STUDY_FLOW = [
            AppScreen.COMPANY,
            AppScreen.ROUTINE,
            AppScreen.SOVI,
            AppScreen.SAFETY,
            AppScreen.SCORING,
            AppScreen.AUDIT_QUIZ
          ];

          const navigateTo = (screen) => {
            setCurrentScreen(screen);
            setIsMenuOpen(false);
            window.scrollTo(0, 0);
          };

          const getTitle = (screen) => {
            switch(screen) {
              case AppScreen.HOME: return 'Início';
              case AppScreen.SAFETY: return 'Segurança & Rotina';
              case AppScreen.ROUTINE: return 'Roteiro de Visita';
              case AppScreen.SCORING: return 'Pilares & Pontuação';
              case AppScreen.SOVI: return 'Metas de SOVI';
              case AppScreen.AUDIT_QUIZ: return 'Simulador de Auditoria';
              case AppScreen.COMPANY: return 'Sobre a Heineken';
              default: return '';
            }
          };

          const renderScreen = () => {
            switch (currentScreen) {
              case AppScreen.HOME:
                return (
                  <div className="space-y-6 animate-in fade-in duration-500 pb-20">
                     <div className="bg-white rounded-2xl p-8 text-center shadow-sm mt-4">
                        <Star className="w-16 h-16 text-heineken-red mx-auto mb-4 fill-current" />
                        <h1 className="text-3xl font-bold text-gray-900 mb-2">Fotografia de Sucesso 2025</h1>
                        <p className="text-gray-500 mb-8">Treinamento oficial para promotores e preparação para auditoria.</p>
                        
                        <button 
                          onClick={() => navigateTo(AppScreen.AUDIT_QUIZ)}
                          className="w-full bg-heineken-green text-white py-4 rounded-xl font-bold shadow-lg shadow-green-200 hover:bg-heineken-dark transition-colors flex items-center justify-center gap-2 mb-4"
                        >
                          <MessageCircleQuestion />
                          Iniciar Simulador de Auditoria
                        </button>

                        <p className="text-xs text-gray-400 uppercase tracking-widest mt-8">Módulos de Estudo</p>
                        <div className="grid grid-cols-2 gap-3 mt-4">
                           <button onClick={() => navigateTo(AppScreen.COMPANY)} className="bg-gray-50 p-4 rounded-xl border border-gray-100 hover:border-green-500 transition-colors">
                              <Users className="w-6 h-6 text-gray-700 mx-auto mb-2" />
                              <span className="text-sm font-semibold text-gray-700">Sobre a Heineken</span>
                           </button>
                           <button onClick={() => navigateTo(AppScreen.ROUTINE)} className="bg-gray-50 p-4 rounded-xl border border-gray-100 hover:border-green-500 transition-colors">
                              <ClipboardList className="w-6 h-6 text-gray-700 mx-auto mb-2" />
                              <span className="text-sm font-semibold text-gray-700">Roteiro de Visita</span>
                           </button>
                           <button onClick={() => navigateTo(AppScreen.SOVI)} className="bg-gray-50 p-4 rounded-xl border border-gray-100 hover:border-green-500 transition-colors">
                              <TrendingUp className="w-6 h-6 text-gray-700 mx-auto mb-2" />
                              <span className="text-sm font-semibold text-gray-700">Metas SOVI</span>
                           </button>
                           <button onClick={() => navigateTo(AppScreen.SAFETY)} className="bg-gray-50 p-4 rounded-xl border border-gray-100 hover:border-green-500 transition-colors">
                              <ShieldCheck className="w-6 h-6 text-gray-700 mx-auto mb-2" />
                              <span className="text-sm font-semibold text-gray-700">Segurança & Rotina</span>
                           </button>
                           <button onClick={() => navigateTo(AppScreen.SCORING)} className="col-span-2 bg-gray-50 p-4 rounded-xl border border-gray-100 hover:border-green-500 transition-colors flex flex-col items-center">
                              <Award className="w-6 h-6 text-gray-700 mb-2" />
                              <span className="text-sm font-semibold text-gray-700">4 Pilares e Pontuação</span>
                           </button>
                        </div>
                     </div>
                  </div>
                );
              case AppScreen.SAFETY: return <ModuleSafety />;
              case AppScreen.ROUTINE: return <ModuleVisit />;
              case AppScreen.SCORING: return <ModuleScoring />;
              case AppScreen.SOVI: return <ModuleSovi />;
              case AppScreen.AUDIT_QUIZ: return <ModuleQuiz />;
              case AppScreen.COMPANY: return <ModuleCompany />;
              default: return null;
            }
          };

          const getNavigationButtons = () => {
            if (currentScreen === AppScreen.HOME) return null;

            const currentIndex = STUDY_FLOW.indexOf(currentScreen);
            const prevScreen = currentIndex > 0 ? STUDY_FLOW[currentIndex - 1] : null;
            const nextScreen = currentIndex < STUDY_FLOW.length - 1 ? STUDY_FLOW[currentIndex + 1] : null;

            return (
              <div className="mt-8 pt-6 border-t border-gray-200 flex flex-col gap-3">
                <div className="flex justify-between items-center gap-3">
                    {prevScreen ? (
                      <button 
                        onClick={() => navigateTo(prevScreen)}
                        className="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-white text-gray-600 font-semibold rounded-xl border border-gray-200 shadow-sm hover:bg-gray-50 transition-colors"
                      >
                        <ChevronLeft size={20} />
                        <span className="text-sm md:text-base">Anterior</span>
                      </button>
                    ) : (
                      <div className="flex-1"></div>
                    )}

                    {nextScreen ? (
                      <button 
                        onClick={() => navigateTo(nextScreen)}
                        className="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-heineken-green text-white font-semibold rounded-xl shadow-md shadow-green-200 hover:bg-heineken-dark transition-colors"
                      >
                        <span className="text-sm md:text-base">Próximo</span>
                        <ChevronRight size={20} />
                      </button>
                    ) : (
                      <div className="flex-1"></div>
                    )}
                </div>

                <button 
                    onClick={() => navigateTo(AppScreen.HOME)}
                    className="w-full flex items-center justify-center gap-2 px-4 py-3 bg-gray-100 text-gray-600 font-bold rounded-xl border border-gray-200 hover:bg-gray-200 transition-colors"
                >
                    <Home size={18} />
                    <span className="text-sm md:text-base">Voltar ao Início</span>
                </button>
              </div>
            );
          };

          const NavButton = ({ icon, label, onClick, active }) => (
            <button 
                onClick={onClick}
                className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${
                active 
                    ? 'bg-green-50 text-heineken-green' 
                    : 'text-gray-600 hover:bg-gray-50'
                }`}
            >
                {icon}
                {label}
            </button>
          );

          return (
            <div className="min-h-screen bg-gray-100 font-sans text-gray-900 pb-10">
              {/* Header */}
              {/* Header Removed to avoid duplication with Main App Header */}


              {/* Main Content */}
              <main className={`mx-auto px-4 pt-6 pb-8 transition-all duration-300 ${currentScreen !== 'HOME' && getTitle(currentScreen) !== '' ? 'max-w-5xl' : 'max-w-md'}`}>
                {renderScreen()}
                {getNavigationButtons()}
              </main>

              {/* Sidebar Navigation */}
              {isMenuOpen && (
                <div className="fixed inset-0 z-50 flex">
                  <div 
                    className="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" 
                    onClick={() => setIsMenuOpen(false)}
                  />
                  <div className="relative bg-white w-64 h-full shadow-2xl flex flex-col animate-in slide-in-from-left duration-300">
                    <div className="p-6 bg-heineken-green text-white flex justify-between items-center">
                      <span className="font-bold text-xl">Menu</span>
                      <button onClick={() => setIsMenuOpen(false)}>
                        <X className="w-6 h-6" />
                      </button>
                    </div>
                    
                    <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
                      <NavButton icon={<Home />} label="Início" active={currentScreen === AppScreen.HOME} onClick={() => navigateTo(AppScreen.HOME)} />
                      <NavButton icon={<MessageCircleQuestion />} label="Simulador de Auditoria" active={currentScreen === AppScreen.AUDIT_QUIZ} onClick={() => navigateTo(AppScreen.AUDIT_QUIZ)} />
                      <div className="h-px bg-gray-200 my-2" />
                      <NavButton icon={<Users />} label="Sobre a Heineken" active={currentScreen === AppScreen.COMPANY} onClick={() => navigateTo(AppScreen.COMPANY)} />
                      <NavButton icon={<ClipboardList />} label="Roteiro de Visita" active={currentScreen === AppScreen.ROUTINE} onClick={() => navigateTo(AppScreen.ROUTINE)} />
                      <NavButton icon={<TrendingUp />} label="Metas de SOVI" active={currentScreen === AppScreen.SOVI} onClick={() => navigateTo(AppScreen.SOVI)} />
                      <NavButton icon={<ShieldCheck />} label="Segurança & Rotina" active={currentScreen === AppScreen.SAFETY} onClick={() => navigateTo(AppScreen.SAFETY)} />
                      <NavButton icon={<Award />} label="4 Pilares (Pontuação)" active={currentScreen === AppScreen.SCORING} onClick={() => navigateTo(AppScreen.SCORING)} />
                    </nav>

                    <div className="p-4 border-t text-center text-xs text-gray-400">
                      Heineken Brasil &copy; 2025
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };
        
        // --- DADOS E LÃ“GICA ---
        const CATEGORIES = {
            premium: {
                title: "Premium",
                target: 57,
                color: "bg-green-100 border-green-200",
                headerColor: "bg-[#008200] text-white",
                products: [
                    "Heineken Original",
                    "Heineken 0.0",
                    "Heineken Spritz",
                    "Eisenbahn Pilsen",
                    "Eisenbahn Unfiltered",
                    "Amstel Ultra",
                    "Sol",
                    "Sol 0.0",
                    "Praya Lager"
                ]
            },
            craft: {
                title: "Craft",
                target: 53,
                color: "bg-amber-50 border-amber-200",
                headerColor: "bg-amber-600 text-white",
                products: [
                    "Eisenbahn (Estilos)",
                    "Baden Baden (Estilos)",
                    "Praya Clássica",
                    "Lagunitas",
                    "Blue Moon"
                ]
            },
            mainstream: {
                title: "Mainstream",
                target: 25,
                color: "bg-blue-50 border-blue-200",
                headerColor: "bg-blue-600 text-white",
                products: [
                    "Amstel",
                    "Devassa",
                    "Tiger"
                ]
            },
            economy: {
                title: "Economy",
                target: null,
                color: "bg-gray-50 border-gray-200",
                headerColor: "bg-gray-500 text-white",
                products: [
                    "Kaiser",
                    "Glacial",
                    "Bavária",
                    "Schin"
                ]
            },
            nab: {
                title: "Nab",
                target: null,
                color: "bg-teal-50 border-teal-200",
                headerColor: "bg-teal-600 text-white",
                products: [
                    "Fys Tônica",
                    "Fys: Sabores",
                    "Clash'd",
                    "Mamba Water",
                    "Baer-Mate",
                    "Baer-Matcha"
                ]
            },
            rtd: {
                title: "RTD",
                target: null,
                color: "bg-purple-50 border-purple-200",
                headerColor: "bg-purple-600 text-white",
                products: [
                    "Amstel Vibes"
                ]
            },
            outros: {
                title: "Outros",
                target: null,
                color: "bg-gray-50 border-gray-200",
                headerColor: "bg-slate-600 text-white",
                products: [
                    "Refrigerante",
                    "Chá",
                    "Água",
                    "Bebida Mista"
                ]
            }
        };

        const RI_SKU_MAPPING = {
            "Heineken Original": [
                "Heineken Lager Lata 350ml",
                "Heineken Lager Vidro 250ml",
                "Heineken Lata 269ml",
                "Heineken Lager Vidro 330ml",
                "Heineken Lager Lata 473ml",
                "Heineken Lager Vidro 600ml",
                "Heineken Keg 5L"
            ],
            "Heineken 0.0": [
                "Heineken Pilsen Zero Lata 350ml",
                "Heineken Pilsen Zero Lata 269ml",
                "Heineken Pilsen Zero Vidro 330ml"
            ],
            "Heineken Spritz": [
                "Heineken Spritz Long Neck 330ml"
            ],
            "Eisenbahn Pilsen": [
                "Eisenbahn Pilsen Lata 269ml",
                "Eisenbahn Pilsen Lata 350ml",
                "Eisenbahn Pilsen Lata 473ml",
                "Eisenbahn Pilsen Vidro 355ml",
                "Eisenbahn Pilsen Vidro 600ml"
            ],
            "Eisenbahn Unfiltered": [
                "Eisenbahn Unfiltered Lata 350ml",
                "Eisenbahn Unfiltered Lata 473ml",
                "Eisenbahn Unfiltered Vidro 355ml"
            ], 
            "Amstel Ultra": [
                "Amstel Ultra Vidro 275ml",
                "Amstel Ultra Lata 269ml"
            ],
            "Sol": [
                "Sol Pilsen Vidro 330ml",
                "Sol Pilsen Vidro 600ml"
            ],
            "Sol 0.0": [
                "Sol Pilsen Zero Vidro 330ml"
            ],
            "Praya Lager": [
                "Praya Lager 355ml"
            ],
            "Eisenbahn (Estilos)": [
                "Eisenbahn American Ipa Lata 350ml",
                "Eisenbahn Ipa Vidro 355ml",
                "Eisenbahn Pale Ale Lata 350ml",
                "Eisenbahn Pale Ale Vidro 355ml",
                "Eisenbahn Session Ipa Lata 350ml",
                "Eisenbahn Session Ipa Vidro 355ml",
                "Eisenbahn Weizenbier Vidro 355ml"
            ],
            "Baden Baden (Estilos)": [
                "Baden Baden Cristal Lata 350ml",
                "Baden Baden Cristal Vidro 600ml",
                "Baden Baden Ipa Lata 350ml",
                "Baden Baden Ipa Vidro 600ml",
                "Baden Baden Witbier Lata 350ml",
                "Baden Baden Witbier Vidro 600ml",
                "Baden Baden Golden Lata 350ml",
                "Baden Baden Golden Vidro 600ml",
                "Baden Baden Peach Lata 350ml",
                "Baden Baden Peach Vidro 600ml",
                "Baden Baden Amber Lata 350ml"
            ],
            "Praya Clássica": [
                "Praya Classica 355ml",
                "Praya Classica 600ml"
            ],
            "Lagunitas": [
                "Lagunitas IPA Lata 350ml",
                "Lagunitas IPA Vidro 355ml",
                "Lagunitas Day Time Lata 350ml",
                "Lagunitas Day Time Vidro 355ml"
            ],
            "Blue Moon": [
                "Blue Moon Witbier Lata 350ml",
                "Blue Moon Witbier Vidro 355ml"
            ],
            "Amstel": [
                "Amstel Lager Lata 269ml",
                "Amstel Lager Lata 350ml",
                "Amstel Lager Lata 473ml",
                "Amstel Lager Vidro 355ml",
                "Amstel Lager Vidro 600ml"
            ],
            "Devassa": [
                "Devassa Puro Malte Lata 269ml",
                "Devassa Puro Malte Lata 350ml",
                "Devassa Puro Malte Lata 473ml",
                "Devassa Puro Malte Vidro 355ml",
                "Devassa Puro Malte Vidro 600ml",
                "Devassa Puro Malte Vidro 1L"
            ],
            "Tiger": [
                "Tiger Pure Malt Lata 269ml",
                "Tiger Pure Malt Lata 350ml",
                "Tiger Pure Malt Lata 473ml",
                "Tiger Pure Malt Vidro 600ml"
            ],
            "Kaiser": [
                "Kaiser Pilsen Lata 269ml",
                "Kaiser Pilsen Lata 350ml",
                "Kaiser Pilsen Lata 473ml",
                "Kaiser Pilsen Vidro 600ml",
                "Kaiser Pilsen Vidro 1L"
            ],
            "Glacial": [
                "Glacial Pilsen Lata 350ml",
                "Glacial Pilsen Lata 473ml"
            ],
            "Bavária": [
                "Bavaria Pilsen Lata 350ml",
                "Bavaria Pilsen Lata 473ml"
            ],
            "Schin": [
                "Schin Pilsen Lata 350ml",
                "Schin Pilsen Lata 473ml",
                "Schin Pilsen Vidro 600ml",
                "Schin Pilsen Vidro 1L"
            ],
            "Fys Tônica": [
                "Fys Tônica Água Tônica Lata 350ml",
                "Fys Tônica Água Tônica Zero Lata 350ml"
            ],
            "Fys: Sabores": [
                "Fys Limão Siciliano Lata 350ml",
                "Fys Limão Siciliano Zero Lata 350ml",
                "Fys Guaraná da Amazônia Lata 350ml",
                "Fys Guaraná da Amazônia Zero Lata 350ml",
                "Fys Laranja Pera Lata 350ml",
                "Fys Laranja Pera Zero Lata 350ml"
            ],
            "Clash'd": [
                "Clash'd Limão Morango Gengibre Lata 269ml",
                "Clash'd Frutas Vermelhas Hibisco Lata 269ml",
                "Clash'd Maçã Canela Baunilha Lata 269ml"
            ],
            "Mamba Water": [
                "Mamba Water Lata 350ml",
                "Mamba Water Gas Lata 350ml"
            ],
            "Baer-Mate": [
                "Baer-Mate Original Garrafa 350ml",
                "Baer-Mate Original Lata 269ml"
            ],
            "Baer-Matcha": [
                "Baer-Matcha Garrafa 350ml"
            ],
             "Amstel Vibes": [
                "Amstel Vibes Lemon Lata 269ml",
                "Amstel Vibes Strawmellon Lata 269ml"
            ]
        };
        
        const CategoryTabs = ({ categories, activeCategory, onSelect }) => {
            const [startIndex, setStartIndex] = useState(0);
            const ITEMS_PER_PAGE = 2;
            
            // Sync startIndex with activeCategory to ensure visibility
            useEffect(() => {
                const keys = Object.keys(categories);
                const activeIndex = keys.indexOf(activeCategory);
                if (activeIndex !== -1) {
                    if (activeIndex < startIndex) {
                        setStartIndex(activeIndex);
                    } else if (activeIndex >= startIndex + ITEMS_PER_PAGE) {
                        setStartIndex(activeIndex - ITEMS_PER_PAGE + 1);
                    }
                }
            }, [activeCategory, startIndex, categories]);

            const entries = Object.entries(categories);
            const visibleEntries = entries.slice(startIndex, startIndex + ITEMS_PER_PAGE);
            
            const keys = Object.keys(categories);
            const activeIndex = keys.indexOf(activeCategory);
            const hasPrev = activeIndex > 0;
            const hasNext = activeIndex < keys.length - 1;

            const handlePrev = () => {
                if (hasPrev) onSelect(keys[activeIndex - 1]);
            };

            const handleNext = () => {
                if (hasNext) onSelect(keys[activeIndex + 1]);
            };

            return (
                <div className="flex items-center justify-between gap-2 mb-4">
                    <button 
                        onClick={handlePrev}
                        disabled={!hasPrev}
                        className={`p-2 rounded-full transition-all ${
                            hasPrev 
                                ? 'text-[#008200] hover:bg-green-50' 
                                : 'text-gray-200 cursor-not-allowed'
                        }`}
                        aria-label="Anterior"
                    >
                        <ChevronLeft size={24} />
                    </button>

                    <div className="flex-1 flex gap-2 justify-center">
                        {visibleEntries.map(([key, config]) => (
                            <button
                                key={key}
                                onClick={() => onSelect(key)}
                                className={`
                                    flex-1 py-2 px-1 rounded-lg text-xs md:text-sm font-bold transition-all shadow-sm border truncate
                                    ${activeCategory === key 
                                        ? `${config.headerColor} border-transparent ring-2 ring-offset-1 ring-gray-200` 
                                        : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'}
                                `}
                            >
                                {config.title}
                            </button>
                        ))}
                    </div>

                     <button 
                        onClick={handleNext}
                        disabled={!hasNext}
                        className={`p-2 rounded-full transition-all ${
                            hasNext 
                                ? 'text-[#008200] hover:bg-green-50' 
                                : 'text-gray-200 cursor-not-allowed'
                        }`}
                        aria-label="Próximo"
                    >
                        <ChevronRight size={24} />
                    </button>
                </div>
            );
        };

        const ProductInput = ({ name, value, onChange, share, totalShelf }) => {
            return (
                <div className="flex items-center justify-between py-3 border-b border-gray-100 last:border-0">
                    <div className="w-1/2 pr-2">
                        <span className="text-sm font-medium text-gray-700 block">{name}</span>
                        <span className="text-[10px] text-gray-400">
                            Share: <strong>{totalShelf > 0 ? share : '0.0'}%</strong>
                        </span>
                    </div>
                    <div className="w-1/2 flex items-center gap-3 justify-end">
                        <input
                            type="number"
                            value={value}
                            onChange={(e) => onChange(e.target.value)}
                            placeholder="0"
                            className="w-20 p-2 text-right bg-white border border-gray-300 rounded text-sm focus:ring-1 focus:ring-[#008200] focus:border-[#008200] outline-none transition-all"
                        />
                        <span className="text-xs text-gray-400 w-4">cm</span>
                    </div>
                </div>
            );
        };

        const SCORES_PRESENCA = {
            "Baden Baden IPA Lata 350ml OU Vidro 600ml": {
                hiper: { gondola: 1.0, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 2.0, gelada: 0.5 },
                cc: { gondola: 2.0, gelada: 0 }
            },
            "Baden Baden Pilsen Cristal Lata 350ml OU Vidro 600ml": {
                hiper: { gondola: 1.0, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 2.0, gelada: 0.5 },
                cc: { gondola: 2.0, gelada: 0 }
            },
            "Baden Baden Witbier Lata 350ml OU Vidro 600ml": {
                hiper: { gondola: 1.0, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 2.0, gelada: 0.5 },
                cc: { gondola: 2.0, gelada: 0 }
            },
            "Blue Moon Witbier Lata 350ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 1.5, gelada: 0.5 },
                cc: { gondola: 1.0, gelada: 0 }
            },
            "Blue Moon Witbier Vidro 355ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 1.5, gelada: 0.5 },
                cc: { gondola: 1.0, gelada: 0 }
            },
            "Eisenbahn IPA Lata 350ml OU Vidro 355ml": {
                hiper: { gondola: 1.0, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 1.0, gelada: 0.5 },
                cc: { gondola: 1.0, gelada: 0 }
            },
            "Eisenbahn Pale Ale Lata 350ml OU Vidro 355ml": {
                hiper: { gondola: 1.0, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 1.0, gelada: 0.5 },
                cc: { gondola: 1.0, gelada: 0 }
            },
            "Eisenbahn Session Ipa Lata 350ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 0, gelada: 0 }
            },
            "Eisenbahn Session Ipa Vidro 355ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 0, gelada: 0 }
            },
            "Eisenbahn Weizenbier Vidro 355ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 0.5, gelada: 0 }
            },
            "Lagunitas IPA Lata 350ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 1.5, gelada: 0.5 },
                cc: { gondola: 1.0, gelada: 0 }
            },
            "Lagunitas IPA Vidro 355ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 1.5, gelada: 0.5 },
                cc: { gondola: 1.0, gelada: 0 }
            },
            "Praya Classica 355ml": {
                hiper: { gondola: 0.5, gelada: 0 },
                super: { gondola: 0.5, gelada: 0 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 0.5, gelada: 0 }
            },
             "Praya Classica 600ml": {
                hiper: { gondola: 0.5, gelada: 0 },
                super: { gondola: 0.5, gelada: 0 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 0.5, gelada: 0 }
            },
            "Eisenbahn Pilsen Vidro 355ml": {
                hiper: { gondola: 1.5, gelada: 0.5 },
                super: { gondola: 1.5, gelada: 0.5 },
                mini: { gondola: 1.5, gelada: 0.5 },
                cc: { gondola: 2.5, gelada: 0 }
            },
            "Eisenbahn Unfiltered 355ml": {
                hiper: { gondola: 1.5, gelada: 0.5 },
                super: { gondola: 1.5, gelada: 0.5 },
                mini: { gondola: 1.5, gelada: 0.5 },
                cc: { gondola: 2.5, gelada: 0 }
            },
            "Heineken Lager Lata 350ml": {
                hiper: { gondola: 1.5, gelada: 1.0 },
                super: { gondola: 2.0, gelada: 1.0 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 3.0, gelada: 0 }
            },
            "Heineken Lager Vidro 250ml": {
                hiper: { gondola: 1.5, gelada: 1.0 },
                super: { gondola: 2.0, gelada: 1.0 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 3.0, gelada: 0 }
            },
            "Heineken Lata 269ml": {
                hiper: { gondola: 1.5, gelada: 1.0 },
                super: { gondola: 2.0, gelada: 1.0 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 3.0, gelada: 0 }
            },
            "Heineken Lager Vidro 330ml": {
                hiper: { gondola: 1.5, gelada: 0.5 },
                super: { gondola: 2.0, gelada: 1.0 },
                mini: { gondola: 3.0, gelada: 1.0 },
                cc: { gondola: 3.0, gelada: 0 }
            },
            "Heineken Pilsen Zero Lata 350ml": {
                hiper: { gondola: 1.5, gelada: 0.5 },
                super: { gondola: 2.0, gelada: 1.0 },
                mini: { gondola: 2.5, gelada: 1.0 },
                cc: { gondola: 2.5, gelada: 0 }
            },
            "Heineken Pilsen Zero Lata 269ml": {
                hiper: { gondola: 1.5, gelada: 0.5 },
                super: { gondola: 2.0, gelada: 1.0 },
                mini: { gondola: 2.5, gelada: 1.0 },
                cc: { gondola: 2.5, gelada: 0 }
            },
            "Heineken Pilsen Zero Vidro 330ml": {
                hiper: { gondola: 1.5, gelada: 1.0 },
                super: { gondola: 0.5, gelada: 1.0 },
                mini: { gondola: 2.5, gelada: 1.0 },
                cc: { gondola: 2.5, gelada: 0 }
            },
            "Praya Lager 355ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0.5, gelada: 0.5 },
                cc: { gondola: 0.5, gelada: 0 }
            },
            "Sol Pilsen Vidro 330ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0.5, gelada: 0.5 },
                cc: { gondola: 0.5, gelada: 0 }
            },
            "Amstel Ultra Vidro 275ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 1.0, gelada: 0.5 },
                mini: { gondola: 2.5, gelada: 0.5 },
                cc: { gondola: 0.5, gelada: 0 }
            },
            "Amstel Ultra Lata 269ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 1.0, gelada: 0.5 },
                mini: { gondola: 2.5, gelada: 0.5 },
                cc: { gondola: 0.5, gelada: 0 }
            },
            "Eisenbahn Pilsen Lata 473ml": {
                hiper: { gondola: 1.5, gelada: 0.5 },
                super: { gondola: 1.5, gelada: 0.5 },
                mini: { gondola: 1.5, gelada: 0.5 },
                cc: { gondola: 2.5, gelada: 0 }
            },
            "Eisenbahn Unfiltered 350ml": {
                hiper: { gondola: 1.5, gelada: 0.5 },
                super: { gondola: 1.5, gelada: 0.5 },
                mini: { gondola: 1.5, gelada: 0.5 },
                cc: { gondola: 2.5, gelada: 0 }
            },
            "Heineken Lager Lata 473ml": {
                hiper: { gondola: 1.5, gelada: 1.0 },
                super: { gondola: 2.0, gelada: 1.0 },
                mini: { gondola: 3.0, gelada: 1.0 },
                cc: { gondola: 3.0, gelada: 0 }
            },
            "Amstel Lager Lata 269ml": {
                hiper: { gondola: 1.5, gelada: 1.0 },
                super: { gondola: 1.5, gelada: 1.0 },
                mini: { gondola: 1.5, gelada: 1.0 },
                cc: { gondola: 2.0, gelada: 0 }
            },
            "Amstel Lager Lata 350ml": {
                hiper: { gondola: 1.5, gelada: 1.0 },
                super: { gondola: 1.5, gelada: 1.0 },
                mini: { gondola: 1.5, gelada: 1.0 },
                cc: { gondola: 2.0, gelada: 0 }
            },
            "Amstel Lager Lata 473ml": {
                hiper: { gondola: 1.5, gelada: 1.0 },
                super: { gondola: 1.5, gelada: 1.0 },
                mini: { gondola: 1.5, gelada: 1.0 },
                cc: { gondola: 2.0, gelada: 0 }
            },
            "Amstel Lager Vidro 355ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 0, gelada: 0 }
            },
            "Fys (Todos sabores/variações, exceto Tônica)": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0.5, gelada: 0.5 },
                cc: { gondola: 0.5, gelada: 0 }
            },
            "Fys Tônica Lata 350ml (Regular/Zero)": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0.5, gelada: 0.5 },
                cc: { gondola: 0.5, gelada: 0 }
            }
        };

        const POSICIONAMENTO_CHECKLIST = [
            { id: 'estilos_ordenados', label: 'A exposição dos estilos está ordenada com os líquidos mais escuros para os mais claros?', points: 1.0 },
            { id: 'baden_colorado', label: 'Baden Baden está exposta próxima a Colorado?', points: 1.0 },
            { id: 'baden_blue_lagunitas', label: 'Baden Baden, Blue Moon e Lagunitas estão expostas na gôndola de Especiais?', points: 1.0 },
            { id: 'amstel_planograma', label: 'Na gôndola de Mainstream, Amstel segue a ordem de posicionamento conforme planograma?', points: 1.0 },
            { id: 'mainstream_70_30', label: 'Na gôndola de Mainstream, temos 70% dos pacotes fechados nas prateleiras inferiores e 30% expostos em unidades nas prateleiras superiores?', points: 1.0 },
            { id: 'heineken_00_dupla', label: 'Heineken 00 tem dupla exposição (na gôndola de Premium ao lado de Heineken Regular e na gôndola de cervejas sem álcool)?', points: 1.0 },
            { id: 'premium_protecao', label: 'Na gôndola de Premium, ao menos uma marca do nosso portfólio está protegendo a marca Heineken de Spaten?', points: 1.0 },
            { id: 'premium_planograma', label: 'Na gôndola de Premium, nossas marcas seguem a ordem de posicionamento conforme planograma?', points: 1.0 },
            { id: 'praya_abrindo', label: 'Na gôndola de Premium, Praya Lager está abrindo o segmento?', points: 0.5 },
            { id: 'premium_70_30', label: 'Na gôndola de Premium, temos 70% dos pacotes fechados nas prateleiras inferiores e 30% expostos em unidades nas prateleiras superiores?', points: 1.0 },
            { id: 'fys_tonica', label: 'Tônica FYS está posicionada próxima de Schweppes Tônica ou Antarctica Tônica?', points: 0.5 },
            { id: 'extra_amstel', label: 'Ponto extra de Amstel está posicionado na área de churrasco/açougue (caso tenha)?', points: 0.0 },
            { id: 'extra_heineken', label: 'Ponto extra de Heineken está posicionado ao lado do ponto extra de Heineken 0.0 (caso tenha)?', points: 0.0 },
            { id: 'extra_praya', label: 'Ponto extra de Praya Lager está posicionado ao lado do ponto extra de Corona (caso tenha)?', points: 0.0 },
            { id: 'extra_sol', label: 'Ponto extra de Sol está posicionado ao lado do ponto extra de Corona (caso tenha)?', points: 0.0 }
        ];

        const StoreTypeSelector = ({ selected, onSelect }) => {
            const types = [
                { id: 'hiper', label: 'Hiper' },
                { id: 'super', label: 'Super' },
                { id: 'mini', label: 'Mini' },
                { id: 'cc', label: 'C&C' }
            ];

            return (
                <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-6">
                    <h2 className="text-sm font-bold text-gray-400 uppercase mb-3">Tipo de Loja</h2>
                    <div className="flex gap-2">
                        {types.map(type => (
                            <button
                                key={type.id}
                                onClick={() => onSelect(type.id)}
                                className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all border ${
                                    selected === type.id
                                        ? 'bg-[#008200] text-white border-[#008200] shadow-md'
                                        : 'bg-gray-50 text-gray-500 border-gray-200 hover:bg-gray-100'
                                }`}
                            >
                                {type.label}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const DownloadHelperCard = () => (
            <div className="mb-4 flex justify-center">
                <div className="inline-flex items-center gap-2 bg-blue-50 px-3 py-1.5 rounded-lg border border-blue-100">
                    <Download className="h-3 w-3 text-blue-400" />
                    <p className="text-[10px] text-blue-600 font-medium">
                        Para baixar PDF, PNG ou Copiar a lista, use os botões acima.
                    </p>
                </div>
            </div>
        );

        const ScoreRules = () => (
            <div className="bg-white p-3 rounded-xl shadow-sm border border-gray-100 mb-4">
                <div className="flex justify-between items-center mb-2 cursor-pointer group" onClick={() => document.getElementById('rules-content').classList.toggle('hidden')}>
                    <h3 className="text-xs font-bold text-gray-500 uppercase flex items-center gap-1">
                        <Info size={12} /> Regras de Pontuação
                    </h3>
                    <ChevronDown size={14} className="text-gray-400 group-hover:text-gray-600 transition-transform duration-300" id="rules-chevron" />
                </div>
                <div id="rules-content" className="space-y-2 hidden animate-in fade-in slide-in-from-top-1">
                    <div className="flex items-center gap-2 text-[10px] leading-tight text-gray-600">
                        <div className="w-2 h-2 rounded-full bg-[#008200] shrink-0"></div>
                        <span className="font-bold w-12 shrink-0">70-100%</span>
                        <span>Execução Excelente (Verde)</span>
                    </div>
                    <div className="flex items-center gap-2 text-[10px] leading-tight text-gray-600">
                        <div className="w-2 h-2 rounded-full bg-amber-500 shrink-0"></div>
                        <span className="font-bold w-12 shrink-0">30-69%</span>
                        <span>Atenção / Melhoria (Amarelo)</span>
                    </div>
                    <div className="flex items-center gap-2 text-[10px] leading-tight text-gray-600">
                        <div className="w-2 h-2 rounded-full bg-red-500 shrink-0"></div>
                        <span className="font-bold w-12 shrink-0">0-29%</span>
                        <span>Crítico / Ação Imediata (Vermelho)</span>
                    </div>
                </div>
            </div>
        );

        const AuditoriaScorecard = ({ scores, totalScore, activeTab, onCopyList, onDownloadPDF, isCapturing }) => {
            let scoreColor = "text-red-500";
            let starColor = "text-red-500";
            
            if (totalScore >= 70) {
                scoreColor = "text-[#008200]";
                starColor = "text-[#008200]";
            } else if (totalScore >= 30) {
                scoreColor = "text-amber-500";
                starColor = "text-amber-500";
            }

            return (
                <>
                    <div className="sticky top-[72px] z-30 mb-6">
                        <div className="bg-white p-4 rounded-xl shadow-md border border-gray-100">
                            <div className="flex justify-between items-center mb-3">
                                <h2 className="text-sm font-bold text-gray-800 uppercase flex items-center gap-2">
                                    <Star className={`w-4 h-4 ${starColor} fill-current`} />
                                    Auditoria FDS
                                </h2>
                                <span className={`text-2xl font-bold ${scoreColor}`}>{totalScore} <span className="text-xs text-gray-400 font-normal">/ 100 pts</span></span>
                            </div>

                            <div className="grid grid-cols-4 gap-2 text-center mb-4">
                                <div className="bg-gray-50 p-2 rounded border border-gray-100">
                                    <span className="block text-[10px] font-bold text-gray-400 uppercase">Presença</span>
                                    <span className="block text-lg font-bold text-gray-800">{scores.presenca}</span>
                                </div>
                                <div className="bg-gray-50 p-2 rounded border border-gray-100">
                                    <span className="block text-[10px] font-bold text-gray-400 uppercase">
                                        Posic. {activeTab === 'ri' ? '(RI)' : activeTab === 'share' ? '(Manual)' : ''}
                                    </span>
                                    <span className="block text-lg font-bold text-gray-800">{scores.posicionamento}</span>
                                </div>
                                <div className="bg-gray-50 p-2 rounded border border-gray-100">
                                    <span className="block text-[10px] font-bold text-gray-400 uppercase">Promo.</span>
                                    <span className="block text-lg font-bold text-gray-800">{scores.visibilidade}</span>
                                </div>
                                <div className="bg-gray-50 p-2 rounded border border-gray-100">
                                    <span className="block text-[10px] font-bold text-gray-400 uppercase">Preço</span>
                                    <span className="block text-lg font-bold text-gray-800">{scores.precificacao}</span>
                                </div>
                            </div>

                            <div className="grid grid-cols-2 gap-3">
                                <button 
                                    onClick={onCopyList}
                                    className="flex items-center justify-center gap-2 px-4 py-2.5 bg-gray-50 text-gray-700 rounded-lg text-xs font-bold border border-gray-200 hover:bg-gray-100 hover:text-[#008200] transition-colors active:scale-95"
                                >
                                    <ClipboardCopy size={16} />
                                    Copiar Resumo
                                </button>
                                <button 
                                    onClick={onDownloadPDF}
                                    disabled={isCapturing}
                                    className="flex items-center justify-center gap-2 px-4 py-2.5 bg-[#008200] text-white rounded-lg text-xs font-bold shadow-md hover:bg-[#006000] transition-transform active:scale-95 disabled:opacity-50"
                                >
                                    <Download size={16} />
                                    {isCapturing ? 'Gerando...' : 'Baixar PDF'}
                                </button>
                            </div>
                        </div>
                    </div>
                    <ScoreRules />
                </>
            );
        };

        const TabPresenca = ({ data = {}, storeType, onChange }) => {
            return (
                <div className="space-y-3">
                    {Object.entries(SCORES_PRESENCA).map(([product, scores]) => {
                        const currentScores = scores[storeType] || { gondola: 0, gelada: 0 };
                        const productState = (data && data[product]) || { gondola: false, gelada: false };

                        return (
                            <div key={product} className="bg-gray-50 p-3 rounded-lg border border-gray-200 flex justify-between items-center">
                                <span className="text-sm font-medium text-gray-700 w-1/3">{product}</span>
                                <div className="flex gap-4">
                                    <label className="flex items-center gap-2 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            checked={productState.gondola}
                                            onChange={(e) => onChange(product, 'gondola', e.target.checked)}
                                            className="w-4 h-4 text-[#008200] rounded focus:ring-[#008200]"
                                        />
                                        <div className="flex flex-col">
                                            <span className="text-xs font-bold text-gray-600">Gôndola</span>
                                            <span className="text-[10px] text-gray-400">+{currentScores.gondola} pts</span>
                                        </div>
                                    </label>
                                    <label className="flex items-center gap-2 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            checked={productState.gelada}
                                            onChange={(e) => onChange(product, 'gelada', e.target.checked)}
                                            className="w-4 h-4 text-[#008200] rounded focus:ring-[#008200]"
                                        />
                                        <div className="flex flex-col">
                                            <span className="text-xs font-bold text-gray-600">Gelada</span>
                                            <span className="text-[10px] text-gray-400">+{currentScores.gelada} pts</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        );
                    })}
                </div>
            );
        };



        const CategorySection = ({ categoryKey, config, values, onUpdateWorld, onUpdateProduct, isTabbed, onSelectCategory, allCategories }) => {
            const [isOpen, setIsOpen] = useState(true);

            useEffect(() => {
                if (isTabbed) setIsOpen(true);
            }, [isTabbed, categoryKey]);

            // Safety checks
            if (!config) return null;
            const safeValues = values || { world: '', products: {} };

            const worldCm = safeValues.world;
            const productValues = safeValues.products || {};
            const totalShelf = parseFloat(worldCm) || 0;
            
            const hnkTotalVal = config.products.reduce((acc, prod) => {
                return acc + (parseFloat(productValues[prod]) || 0);
            }, 0);

            const isError = hnkTotalVal > totalShelf && totalShelf > 0;
            const totalShare = totalShelf > 0 ? ((hnkTotalVal / totalShelf) * 100).toFixed(1) : 0;
            const isTargetMet = config.target ? parseFloat(totalShare) >= config.target : true;


            const targetCm = config.target ? (totalShelf * config.target) / 100 : 0;
            const missingCm = config.target ? (targetCm - hnkTotalVal).toFixed(1) : 0;
            const isMissing = parseFloat(missingCm) > 0;

            // Navigation Logic
            const currentIndex = allCategories ? allCategories.indexOf(categoryKey) : -1;
            const prevCategory = currentIndex > 0 ? allCategories[currentIndex - 1] : null;
            const nextCategory = currentIndex !== -1 && currentIndex < allCategories.length - 1 ? allCategories[currentIndex + 1] : null;

            return (
                <div className="mb-6 bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden">
                    <div 
                        className={`p-4 flex justify-between items-center text-white ${config.headerColor}`}
                    >
                        <div className="flex items-center gap-2">
                            <Star className="w-5 h-5 text-red-500 fill-current" />
                            <h2 className="text-lg font-bold uppercase tracking-wider">{config.title}</h2>
                        </div>
                        <div className="flex items-center gap-3">
                            {config.target !== null && (
                                <span className="text-xs font-semibold bg-white/20 px-2 py-1 rounded">
                                    META: {config.target}%
                                </span>
                            )}
                        </div>
                    </div>

                    <div className="p-4">
                            <div className="bg-blue-50 p-4 rounded-lg border border-blue-100 mb-6">
                                <div className="flex justify-between items-center mb-2">
                                    <label className="text-[10px] md:text-xs font-bold text-blue-800 uppercase flex items-center gap-1">
                                        <Globe size={14} />
                                        Espaço Total (Mundo)
                                    </label>
                                </div>
                                <div className="flex items-center gap-2">
                                    <input
                                        type="tel"
                                        value={worldCm}
                                        onChange={(e) => onUpdateWorld(e.target.value)}
                                        placeholder="Total gôndola"
                                        className="w-full p-3 text-base md:text-lg bg-white border border-blue-200 rounded-lg text-gray-800 focus:ring-2 focus:ring-blue-500 outline-none placeholder-gray-400"
                                    />
                                    <span className="font-bold text-blue-300 text-lg">cm</span>
                                </div>
                            </div>

                            <div className="mb-6">
                                <h3 className="text-xs font-bold text-gray-400 uppercase mb-3 pl-1">Nossos Produtos (cm)</h3>
                                <div className={`bg-gray-50 rounded-lg p-2 border ${isError ? 'border-red-300' : 'border-gray-200'}`}>
                                    {config.products.map((prod, idx) => {
                                        const val = parseFloat(productValues[prod]) || 0;
                                        const share = totalShelf > 0 ? ((val / totalShelf) * 100).toFixed(1) : 0;
                                        
                                        return (
                                            <ProductInput 
                                                key={idx}
                                                name={prod}
                                                value={productValues[prod] || ''}
                                                onChange={(val) => onUpdateProduct(prod, val)}
                                                share={share}
                                                totalShelf={totalShelf}
                                            />
                                        );
                                    })}
                                </div>
                                {isError && (
                                    <div className="flex items-center gap-1 text-red-500 text-xs mt-1 pl-1">
                                        <AlertTriangle size={12} />
                                        <span>Atenção: A soma dos produtos excede o total do mundo!</span>
                                    </div>
                                )}
                            </div>

                            <div className="border-t-2 border-dashed border-gray-200 pt-4">
                                <div className="flex justify-between items-end">
                                    <div>
                                        <span className="text-sm font-bold text-gray-500 block">SHARE TOTAL</span>
                                        <span className="text-xs text-gray-400">
                                            (Nossos: {hnkTotalVal}cm / Mundo: {totalShelf}cm)
                                        </span>
                                    </div>
                                    <div className={`text-4xl font-bold ${isTargetMet ? 'text-[#008200]' : 'text-red-500'}`}>
                                        {totalShare}%
                                    </div>
                                </div>
                                {config.target && totalShelf > 0 && (
                                    <div className="space-y-2 mt-3">
                                        <div className={`p-2 rounded flex items-center justify-center gap-2 text-sm font-bold ${isTargetMet ? 'bg-green-100 text-[#008200]' : 'bg-red-100 text-red-600'}`}>
                                            {isTargetMet ? <CheckCircle size={18} /> : <AlertCircle size={18} />}
                                            {isTargetMet ? `META DE ${config.target}% ATINGIDA` : `ABAIXO DA META DE ${config.target}%`}
                                        </div>
                                        {isMissing && (
                                            <div className="p-2 rounded flex items-center justify-center gap-2 text-xs font-bold bg-amber-50 text-amber-700 border border-amber-200">
                                                <AlertTriangle size={14} />
                                                <span>Faltam {missingCm} cm para atingir a meta</span>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>

                            {/* Navigation Buttons */}
                            {isTabbed && allCategories && (
                                <div className="flex justify-between mt-6 pt-4 border-t border-gray-100">
                                    {prevCategory ? (
                                        <button
                                            onClick={() => onSelectCategory(prevCategory)}
                                            className="flex items-center gap-2 text-sm font-bold text-gray-500 hover:text-[#008200] transition-colors"
                                        >
                                            <ArrowRight size={16} className="rotate-180" />
                                            Anterior
                                        </button>
                                    ) : <div></div>}
                                    
                                    {nextCategory ? (
                                        <button
                                            onClick={() => onSelectCategory(nextCategory)}
                                            className="flex items-center gap-2 text-sm font-bold text-[#008200] hover:text-[#006000] transition-colors"
                                        >
                                            Próximo
                                            <ArrowRight size={16} />
                                        </button>
                                    ) : <div></div>}
                                </div>
                            )}
                        </div>
                    {/* )} removed */}
                </div>
            );
        };

        const OutrosSection = ({ config, products, onUpdateProduct }) => {
            return (
                <div className="mb-6 bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden">
                    <div className={`p-4 flex justify-between items-center text-white ${config.headerColor}`}>
                        <div className="flex items-center gap-2">
                            <Star className="w-5 h-5 text-white fill-current" />
                            <h2 className="text-lg font-bold uppercase tracking-wider">{config.title}</h2>
                        </div>
                    </div>

                    <div className="p-4 space-y-4">
                        {config.products.map((item, idx) => (
                            <div key={idx} className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <label className="text-xs font-bold text-gray-700 uppercase flex items-center gap-1 mb-2">
                                    <Globe size={14} />
                                    Espaço Total da Categoria ({item})
                                </label>
                                <div className="flex items-center gap-2">
                                    <input
                                        type="number"
                                        value={products[item] || ''}
                                        onChange={(e) => onUpdateProduct(item, e.target.value)}
                                        placeholder={`Total de ${item} em cm`}
                                        className="w-full p-3 text-lg bg-white border border-gray-300 rounded text-gray-800 focus:ring-2 focus:ring-gray-500 outline-none"
                                    />
                                    <span className="font-bold text-gray-400">cm</span>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const TabPosicionamento = ({ 
            allData, riData, CATEGORIES, activeCategory, onSelectCategory, onUpdateWorld, onUpdateProduct, onUpdateRiWorld, onUpdateRiProduct,
            activeSubTab, setActiveSubTab, // New Props
            checklistData, onChecklistChange, auditoriaScore,
            onCopyList, onDownloadPDF, isCapturing
        }) => {
            // Local state removed in favor of props
            const [showGuide, setShowGuide] = useState(true);

            // Calculate shares for Manual Calculator
            const getCatShare = (catKey) => {
                const catData = allData[catKey];
                if (!catData) return 0;
                
                const worldCm = parseFloat(catData.world) || 0;
                const config = CATEGORIES[catKey];
                
                if (!config) return 0;

                let catTotalHnk = 0;
                config.products.forEach(prod => {
                    catTotalHnk += (parseFloat(catData.products[prod]) || 0);
                });
                return worldCm > 0 ? (catTotalHnk / worldCm) * 100 : 0;
            };

            // Calculate shares for RI Calculator
            const getRiShare = (catKey) => {
                const catData = riData ? riData[catKey] : null;
                if (!catData) return 0;
                
                const worldCm = parseFloat(catData.world) || 0;
                const config = CATEGORIES[catKey];
                
                if (!config) return 0;

                let catTotalHnk = 0;
                config.products.forEach(prod => {
                    catTotalHnk += (parseFloat(catData.products[prod]) || 0);
                });
                return worldCm > 0 ? (catTotalHnk / worldCm) * 100 : 0;
            };

            // Manual Scores
            const sharePremium = getCatShare('premium');
            const shareCraft = getCatShare('craft');
            const shareMainstream = getCatShare('mainstream');

            const scorePremiumManual = sharePremium >= 57 ? 9 : 0;
            const scoreCraftManual = shareCraft >= 53 ? 8 : 0;
            const scoreMainstreamManual = shareMainstream >= 25 ? 8 : 0;
            
            // RI Scores
            const shareRiPremium = getRiShare('premium');
            const shareRiCraft = getRiShare('craft');
            const shareRiMainstream = getRiShare('mainstream');

            const scoreRiPremium = shareRiPremium >= 57 ? 9 : 0;
            const scoreRiCraft = shareRiCraft >= 53 ? 8 : 0;
            const scoreRiMainstream = shareRiMainstream >= 25 ? 8 : 0;

            let checklistScore = 0;
            POSICIONAMENTO_CHECKLIST.forEach(item => {
                if (checklistData[item.id]) checklistScore += item.points;
            });

            // Dynamic Scoring Logic
            let activeScorePremium = scorePremiumManual;
            let activeScoreCraft = scoreCraftManual;
            let activeScoreMainstream = scoreMainstreamManual;
            
            // If RI tab is active, use RI scores. IF Manual or Checklist, default to Manual?
            // User requested: "Cenário B (Usuário clica/usa Calculadora RI): Pontuação Final = Pontos do Checklist + Pontos da Calculadora RI"
            // This implies logic depends on activeSubTab.
            if (activeSubTab === 'ri') {
                activeScorePremium = scoreRiPremium;
                activeScoreCraft = scoreRiCraft;
                activeScoreMainstream = scoreRiMainstream;
            }

            const totalScore = activeScorePremium + activeScoreCraft + activeScoreMainstream + checklistScore;

            const subTabs = [
                { id: 'checklist', label: 'Checklist', icon: ClipboardList },
                { id: 'share', label: 'Calculadora Manual', icon: Calculator },
                { id: 'ri', label: 'Calculadora RI', icon: Calculator }
            ];

            return (
                <div className="space-y-6">

                    {/* Score Summary */}
                    <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <h3 className="text-sm font-bold text-gray-700 uppercase mb-3 text-center">Resumo da Pontuação</h3>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div className={`p-3 rounded border ${activeScorePremium > 0 ? 'bg-green-50 border-green-200' : 'bg-white border-gray-200'}`}>
                                <span className="text-xs text-gray-500 block">Premium (Meta 57%)</span>
                                <span className="font-bold text-lg">
                                    {activeSubTab === 'ri' ? shareRiPremium.toFixed(1) : sharePremium.toFixed(1)}%
                                </span>
                                <span className={`text-xs font-bold block ${activeScorePremium > 0 ? 'text-[#008200]' : 'text-gray-400'}`}>
                                    +{activeScorePremium} pts
                                </span>
                            </div>
                            <div className={`p-3 rounded border ${activeScoreCraft > 0 ? 'bg-green-50 border-green-200' : 'bg-white border-gray-200'}`}>
                                <span className="text-xs text-gray-500 block">Craft (Meta 53%)</span>
                                <span className="font-bold text-lg">
                                    {activeSubTab === 'ri' ? shareRiCraft.toFixed(1) : shareCraft.toFixed(1)}%
                                </span>
                                <span className={`text-xs font-bold block ${activeScoreCraft > 0 ? 'text-[#008200]' : 'text-gray-400'}`}>
                                    +{activeScoreCraft} pts
                                </span>
                            </div>
                            <div className={`p-3 rounded border ${activeScoreMainstream > 0 ? 'bg-green-50 border-green-200' : 'bg-white border-gray-200'}`}>
                                <span className="text-xs text-gray-500 block">Mainstream (Meta 25%)</span>
                                <span className="font-bold text-lg">
                                    {activeSubTab === 'ri' ? shareRiMainstream.toFixed(1) : shareMainstream.toFixed(1)}%
                                </span>
                                <span className={`text-xs font-bold block ${activeScoreMainstream > 0 ? 'text-[#008200]' : 'text-gray-400'}`}>
                                    +{activeScoreMainstream} pts
                                </span>
                            </div>
                            <div className="p-3 rounded border bg-white border-gray-200">
                                <span className="text-xs text-gray-500 block">Checklist</span>
                                <span className="font-bold text-lg">{checklistScore} pts</span>
                            </div>
                        </div>
                        <div className="text-center bg-[#008200] text-white p-2 rounded font-bold">
                            Total Posicionamento: {totalScore} / 35 pts
                        </div>
                    </div>

                    {/* User Guide / Context Alert */}
                    {showGuide && (
                        <div className="bg-orange-50 border-l-4 border-orange-500 shadow-md p-3 rounded-r-lg relative animate-in fade-in slide-in-from-top-2 mb-4">
                             <button 
                                onClick={() => setShowGuide(false)}
                                className="absolute top-2 right-2 text-orange-300 hover:text-orange-500"
                            >
                                <X size={14} />
                            </button>
                            <div className="flex gap-3 items-center pr-5">
                                <div className="p-1.5 bg-orange-100 rounded-full shrink-0 animate-pulse">
                                    <AlertTriangle className="text-orange-600" size={16} />
                                </div>
                                <div>
                                    <p className="text-[11px] font-bold text-orange-900 uppercase tracking-wide leading-tight mb-0.5">
                                        Importante
                                    </p>
                                    <p className="text-[11px] text-orange-800 leading-tight">
                                        A nota e os relatórios (PDF/Cópia) mudam conforme a <strong>Calculadora (Manual ou RI)</strong> selecionada na tela.
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Sub-Tab Navigation */}
                    <div className="flex gap-2 bg-gray-100 p-1 rounded-lg">
                        {subTabs.map(tab => {
                            const Icon = tab.icon;
                            const isActive = activeSubTab === tab.id;
                            return (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveSubTab(tab.id)}
                                    className={`flex-1 flex flex-col md:flex-row items-center justify-center gap-1 md:gap-2 py-1.5 md:py-2 rounded-md text-[10px] md:text-xs font-bold transition-all text-center leading-tight ${
                                        isActive
                                            ? 'bg-white text-[#008200] shadow-sm'
                                            : 'text-gray-500 hover:text-gray-700'
                                    }`}
                                >
                                    <Icon size={16} className="shrink-0" />
                                    <span>{tab.label}</span>
                                </button>
                            );
                        })}
                    </div>

                    {/* Content Area */}
                    <div className="bg-white rounded-xl border border-gray-200 p-4 shadow-sm">
                        
                        {/* SHARE CALCULATOR */}
                        {activeSubTab === 'share' && (
                            <div className="animate-in fade-in duration-300">
                                <div className="flex flex-col items-center justify-center mb-6">
                                    <h3 className="text-lg font-bold text-gray-800 mb-2 flex items-center justify-center gap-2">
                                        <Calculator size={20} className="text-[#008200]" />
                                        Calculadora Manual
                                    </h3>
                                </div>

                                <CategoryTabs 
                                    categories={CATEGORIES} 
                                    activeCategory={activeCategory} 
                                    onSelect={onSelectCategory} 
                                />

                                <div className="min-h-[300px]">
                                    {Object.entries(CATEGORIES).map(([key, config]) => {
                                        if (key !== activeCategory) return null;
                                        
                                        if (key === 'outros') {
                                            return (
                                                <OutrosSection
                                                    key={key}
                                                    config={config}
                                                    products={allData[key]?.products || {}}
                                                    onUpdateProduct={(prod, val) => onUpdateProduct(prod, val)}
                                                />
                                            );
                                        }

                                        return (
                                            <CategorySection 
                                                key={key}
                                                categoryKey={key}
                                                config={config} 
                                                values={allData[key]} 
                                                onUpdateWorld={onUpdateWorld}
                                                onUpdateProduct={onUpdateProduct}
                                                allCategories={Object.keys(CATEGORIES)}
                                                onSelectCategory={onSelectCategory}
                                                isTabbed={true}
                                            />
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {/* RI CALCULATOR */}
                        {activeSubTab === 'ri' && (
                            <div className="animate-in fade-in duration-300">
                                 <div className="flex flex-col items-center justify-center mb-6">
                                    <h3 className="text-lg font-bold text-gray-800 mb-2 flex items-center justify-center gap-2">
                                        <Calculator size={20} className="text-[#008200]" />
                                        Calculadora RI
                                    </h3>
                                </div>

                                {/* Filtered Tabs for RI */}
                                <CategoryTabs 
                                    categories={Object.fromEntries(Object.entries(CATEGORIES).filter(([key]) => key !== 'outros' && key !== 'economy'))}
                                    activeCategory={activeCategory} 
                                    onSelect={onSelectCategory} 
                                />

                                <div className="space-y-6">
                                    {(() => {
                                        const riCategories = Object.fromEntries(Object.entries(CATEGORIES).filter(([key]) => key !== 'outros' && key !== 'economy'));
                                        
                                        // If active category is filtered out, show nothing
                                        if (!riCategories[activeCategory]) return null;

                                        const config = riCategories[activeCategory];
                                                    const totalShelf = parseFloat(riData[activeCategory]?.world) || 0;

                                                    // Navigation Logic
                                                    const allCategories = Object.keys(riCategories);
                                                    const currentIndex = allCategories.indexOf(activeCategory);
                                                    const prevCategory = currentIndex > 0 ? allCategories[currentIndex - 1] : null;
                                        const nextCategory = currentIndex !== -1 && currentIndex < allCategories.length - 1 ? allCategories[currentIndex + 1] : null;
                                        
                                        // Calculate Totals
                                        let hnkTotalVal = 0;
                                        config.products.forEach(brand => {
                                            const skus = RI_SKU_MAPPING[brand] || [];
                                            skus.forEach(sku => {
                                                hnkTotalVal += (parseFloat((riData[activeCategory]?.skus || {})[sku]) || 0);
                                            });
                                        });

                                        const totalShare = totalShelf > 0 ? ((hnkTotalVal / totalShelf) * 100).toFixed(1) : 0;
                                        const isTargetMet = config.target ? parseFloat(totalShare) >= config.target : true;
                                        const targetCm = config.target ? (totalShelf * config.target) / 100 : 0;
                                        const missingCm = config.target ? (targetCm - hnkTotalVal).toFixed(1) : 0;
                                        const isMissing = parseFloat(missingCm) > 0;

                                        return (
                                            <div className="mb-6 bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden">
                                                {/* HEADER */}
                                                <div className={`p-4 flex justify-between items-center text-white ${config.headerColor}`}>
                                                    <div className="flex items-center gap-2">
                                                        <Star className="w-5 h-5 text-red-500 fill-current" />
                                                        <h2 className="text-lg font-bold uppercase tracking-wider">{config.title}</h2>
                                                    </div>
                                                    <div className="flex items-center gap-3">
                                                        {config.target !== null && (
                                                            <span className="text-xs font-semibold bg-white/20 px-2 py-1 rounded">
                                                                META: {config.target}%
                                                            </span>
                                                        )}
                                                    </div>
                                                </div>

                                                <div className="p-4">
                                                    {/* WORLD INPUT */}
                                                    <div className="bg-blue-50 p-4 rounded-lg border border-blue-100 mb-6">
                                                        <div className="flex justify-between items-center mb-2">
                                                            <label className="text-[10px] md:text-xs font-bold text-blue-800 uppercase flex items-center gap-1">
                                                                <Globe size={14} />
                                                                Espaço Total (Mundo)
                                                            </label>
                                                        </div>
                                                        <div className="flex items-center gap-2">
                                                            <input
                                                                type="tel"
                                                                value={riData[activeCategory]?.world || ''}
                                                                onChange={(e) => onUpdateRiWorld(activeCategory, e.target.value)}
                                                                placeholder="Total gôndola"
                                                                className="w-full p-3 text-base md:text-lg bg-white border border-blue-200 rounded-lg text-gray-800 focus:ring-2 focus:ring-blue-500 outline-none placeholder-gray-400"
                                                            />
                                                            <span className="font-bold text-blue-300 text-lg">cm</span>
                                                        </div>
                                                    </div>

                                                    {/* SKU INPUTS */}
                                                    <div className="mb-6 space-y-4">
                                                        {config.products.map(brand => {
                                                            const skus = RI_SKU_MAPPING[brand] || [];
                                                            if (skus.length === 0) return null;

                                                            let brandTotal = 0;
                                                            skus.forEach(sku => {
                                                                brandTotal += (parseFloat((riData[activeCategory]?.skus || {})[sku]) || 0);
                                                            });
                                                             const brandShare = totalShelf > 0 ? ((brandTotal / totalShelf) * 100).toFixed(1) : 0;

                                                            return (
                                                                <div key={brand} className="bg-gray-50 rounded-lg p-3 border border-gray-200">
                                                                    <div className="flex justify-between items-center mb-2 border-b border-gray-200 pb-2">
                                                                        <h4 className="font-bold text-gray-700 text-sm">{brand}</h4>
                                                                        <div className="text-xs text-gray-500">
                                                                            <span className="font-bold text-[#008200]">{brandTotal}cm</span> ({brandShare}%)
                                                                        </div>
                                                                    </div>
                                                                    <div className="space-y-2">
                                                                        {skus.map(sku => (
                                                                            <div key={sku} className="grid grid-cols-[1fr,100px] gap-2 items-center">
                                                                                 <label className="text-xs text-gray-600 leading-tight">
                                                                                    {sku}
                                                                                </label>
                                                                                <div className="relative">
                                                                                    <input
                                                                                        type="number"
                                                                                        value={(riData[activeCategory]?.skus || {})[sku] || ''}
                                                                                        onChange={(e) => onUpdateRiProduct(activeCategory, sku, e.target.value)}
                                                                                        placeholder="cm"
                                                                                        className="w-full p-2 pr-6 bg-white border border-gray-300 rounded text-right text-sm font-bold focus:ring-1 focus:ring-[#008200] outline-none"
                                                                                    />
                                                                                    <span className="absolute right-2 top-1/2 -translate-y-1/2 text-[10px] text-gray-400 font-bold">cm</span>
                                                                                </div>
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>

                                                    {/* SUMMARY SECTION */}
                                                    <div className="border-t-2 border-dashed border-gray-200 pt-4">
                                                        <div className="flex justify-between items-end">
                                                            <div>
                                                                <span className="text-sm font-bold text-gray-500 block">SHARE TOTAL</span>
                                                                <span className="text-xs text-gray-400">
                                                                    (Nossos: {hnkTotalVal}cm / Mundo: {totalShelf}cm)
                                                                </span>
                                                            </div>
                                                            <div className={`text-4xl font-bold ${isTargetMet ? 'text-[#008200]' : 'text-red-500'}`}>
                                                                {totalShare}%
                                                            </div>
                                                        </div>
                                                        {config.target && totalShelf > 0 && (
                                                            <div className="space-y-2 mt-3">
                                                                <div className={`p-2 rounded flex items-center justify-center gap-2 text-sm font-bold ${isTargetMet ? 'bg-green-100 text-[#008200]' : 'bg-red-100 text-red-600'}`}>
                                                                    {isTargetMet ? <CheckCircle size={18} /> : <AlertCircle size={18} />}
                                                                    {isTargetMet ? `META DE ${config.target}% ATINGIDA` : `ABAIXO DA META DE ${config.target}%`}
                                                                </div>
                                                                {isMissing && (
                                                                    <div className="p-2 rounded flex items-center justify-center gap-2 text-xs font-bold bg-amber-50 text-amber-700 border border-amber-200">
                                                                        <AlertTriangle size={14} />
                                                                        <span>Faltam {missingCm} cm para atingir a meta</span>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        )}
                                                    </div>

                                                    {/* Navigation Buttons */}
                                                    <div className="flex justify-between mt-6 pt-4 border-t border-gray-100">
                                                        {prevCategory ? (
                                                            <button
                                                                onClick={() => onSelectCategory(prevCategory)}
                                                                className="flex items-center gap-2 text-sm font-bold text-gray-500 hover:text-[#008200] transition-colors"
                                                            >
                                                                <ArrowRight size={16} className="rotate-180" />
                                                                Anterior
                                                            </button>
                                                        ) : <div></div>}
                                                        
                                                        {nextCategory ? (
                                                            <button
                                                                onClick={() => onSelectCategory(nextCategory)}
                                                                className="flex items-center gap-2 text-sm font-bold text-[#008200] hover:text-[#006000] transition-colors"
                                                            >
                                                                Próximo
                                                                <ArrowRight size={16} />
                                                            </button>
                                                        ) : <div></div>}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })()}
                                </div>
                            </div>
                        )}

                        {/* CHECKLIST */}
                        {activeSubTab === 'checklist' && (
                            <div className="animate-in fade-in duration-300">
                                <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    <ClipboardList size={20} className="text-[#008200]" />
                                    Checklist de Execução
                                </h3>
                                <div className="divide-y divide-gray-100">
                                    {POSICIONAMENTO_CHECKLIST.map(item => (
                                        <label key={item.id} className="flex items-start gap-3 p-3 hover:bg-gray-50 cursor-pointer transition-colors rounded-lg">
                                            <input
                                                type="checkbox"
                                                checked={checklistData[item.id] || false}
                                                onChange={(e) => onChecklistChange(item.id, e.target.checked)}
                                                className="mt-1 w-5 h-5 text-[#008200] rounded focus:ring-[#008200] shrink-0"
                                            />
                                            <div className="flex-1">
                                                <span className="text-sm text-gray-700 block">{item.label}</span>
                                                <span className="text-[10px] font-bold text-gray-400">Vale {item.points} pts</span>
                                            </div>
                                        </label>
                                    ))}
                                </div>
                            </div>
                        )}

                    </div>
                </div>
            );
        };

        const TabVisibilidade = ({ data, onChange }) => {
            const totalPes = parseInt(data.totalPes) || 0;
            
            let targetCraft = 0;
            let targetPremium = 0;
            let targetMainstream = 0;

            if (totalPes <= 5) {
                targetCraft = 0;
                targetPremium = 1;
                targetMainstream = 1;
            } else if (totalPes >= 6 && totalPes <= 10) {
                targetCraft = 1;
                targetPremium = 2;
                targetMainstream = 1;
            } else if (totalPes >= 11 && totalPes <= 15) {
                targetCraft = 1;
                targetPremium = 3;
                targetMainstream = 2;
            } else if (totalPes >= 16 && totalPes <= 20) {
                targetCraft = 1;
                targetPremium = 5;
                targetMainstream = 2;
            } else if (totalPes >= 21) {
                targetCraft = 1;
                targetPremium = 6;
                targetMainstream = 3;
            }

            return (
                <div className="space-y-4">
                    <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <label className="block text-sm font-bold text-blue-800 mb-2 uppercase">
                            Total Pes de Cerveja na Loja
                        </label>
                        <input
                            type="number"
                            value={data.totalPes}
                            onChange={(e) => onChange('totalPes', e.target.value)}
                            className="w-full p-3 text-lg bg-white border border-blue-300 rounded text-gray-800 focus:ring-2 focus:ring-blue-500 outline-none"
                            placeholder="Ex: 12"
                        />
                        <p className="text-xs text-blue-600 mt-2">
                            *Define as metas de Pontos Extras
                        </p>
                    </div>

                    <div className="grid grid-cols-1 gap-4">
                        {/* CRAFT */}
                        <div className="bg-gray-50 p-3 rounded-lg border border-gray-200">
                            <div className="flex justify-between items-center mb-2">
                                <label className="text-sm font-bold text-amber-700 uppercase">Craft (Artesanais)</label>
                                <span className="text-xs font-bold bg-amber-100 text-amber-800 px-2 py-1 rounded">
                                    Meta: {targetCraft} PE
                                </span>
                            </div>
                            <div className="flex items-center gap-2">
                                <input
                                    type="number"
                                    value={data.peCraft}
                                    onChange={(e) => onChange('peCraft', e.target.value)}
                                    className="flex-1 p-2 border border-gray-300 rounded text-sm"
                                    placeholder="Qtd PE"
                                />
                                <span className="text-xs font-bold text-gray-400 w-16 text-right">
                                    Vale 6 pts
                                </span>
                            </div>
                        </div>

                        {/* PREMIUM */}
                        <div className="bg-gray-50 p-3 rounded-lg border border-gray-200">
                            <div className="flex justify-between items-center mb-2">
                                <label className="text-sm font-bold text-[#008200] uppercase">Premium</label>
                                <span className="text-xs font-bold bg-green-100 text-[#008200] px-2 py-1 rounded">
                                    Meta: {targetPremium} PE
                                </span>
                            </div>
                            <div className="flex items-center gap-2">
                                <input
                                    type="number"
                                    value={data.pePremium}
                                    onChange={(e) => onChange('pePremium', e.target.value)}
                                    className="flex-1 p-2 border border-gray-300 rounded text-sm"
                                    placeholder="Qtd PE"
                                />
                                <span className="text-xs font-bold text-gray-400 w-16 text-right">Vale 8 pts</span>
                            </div>
                        </div>

                        {/* MAINSTREAM */}
                        <div className="bg-gray-50 p-3 rounded-lg border border-gray-200">
                            <div className="flex justify-between items-center mb-2">
                                <label className="text-sm font-bold text-blue-700 uppercase">Mainstream</label>
                                <span className="text-xs font-bold bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                    Meta: {targetMainstream} PE
                                </span>
                            </div>
                            <div className="flex items-center gap-2">
                                <input
                                    type="number"
                                    value={data.peMainstream}
                                    onChange={(e) => onChange('peMainstream', e.target.value)}
                                    className="flex-1 p-2 border border-gray-300 rounded text-sm"
                                    placeholder="Qtd PE"
                                />
                                <span className="text-xs font-bold text-gray-400 w-16 text-right">Vale 6 pts</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const TabPrecificacao = ({ data, onChange }) => {
            return (
                <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <p className="text-sm font-medium text-gray-700 mb-4">
                        Todos os produtos HEINEKEN estão precificados corretamente?
                    </p>
                    <div className="flex gap-4">
                        <button
                            onClick={() => onChange(true)}
                            className={`flex-1 py-2 rounded-lg font-bold border ${data ? 'bg-[#008200] text-white border-[#008200]' : 'bg-white text-gray-500 border-gray-300'}`}
                        >
                            SIM
                        </button>
                        <button
                            onClick={() => onChange(false)}
                            className={`flex-1 py-2 rounded-lg font-bold border ${!data ? 'bg-red-500 text-white border-red-500' : 'bg-white text-gray-500 border-gray-300'}`}
                        >
                            NÃO
                        </button>
                    </div>
                    <p className="text-center mt-4 font-bold text-gray-600">
                        {data ? '5 Pontos' : '0 Pontos'}
                    </p>
                </div>
            );
        };

        const RegistrationView = ({ 
            storeName, setStoreName, 
            fds, setFds, 
            storeType, setStoreType, 
            onComplete, onInstall 
        }) => {
            const isValid = storeName.trim().length > 0 && fds.trim().length > 0 && storeType;

            return (
                <div className="fixed inset-0 z-[100] bg-black/90 flex flex-col items-center justify-center p-4 bg-[url('https://images.unsplash.com/photo-1577908953930-58c0378077c5?q=80&w=2670&auto=format&fit=crop')] bg-cover bg-center">
                    <div className="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
                    
                    <div className="relative z-10 w-full max-w-sm flex flex-col gap-5 [@media(max-height:700px)]:gap-2 animate-in fade-in zoom-in duration-500">
                        <button
                            onClick={() => {
                                setStoreName('');
                                setFds('');
                                setStoreType(null);
                            }}
                            className="absolute top-2 right-2 p-2 rounded-full bg-white/5 border border-white/10 text-white/40 backdrop-blur-sm transition-all duration-300 hover:bg-red-900/30 hover:border-red-500/50 hover:text-red-400 hover:shadow-[0_0_15px_rgba(248,113,113,0.3)] hover:scale-110 z-50 group"
                            title="Limpar dados"
                        >
                            <Trash2 size={24} className="transition-transform duration-300 group-hover:rotate-12" />
                        </button>
                        {/* Logo Area */}
                        <div className="text-center mb-2 [@media(max-height:700px)]:mb-0.5">
                            <div className="flex flex-col items-center justify-center">
                                <Star className="w-12 h-12 [@media(max-height:700px)]:w-10 [@media(max-height:700px)]:h-10 text-white fill-current mb-0.5" />

                            </div>
                            <p className="text-gray-300 text-sm [@media(max-height:700px)]:text-xs mt-0.5 font-medium">Simulador de FDS</p>
                        </div>

                        {/* Input Fields */}
                        <div className="space-y-4 [@media(max-height:700px)]:space-y-2">
                            <div className="bg-amber-500/20 border border-amber-500/50 rounded-lg p-2.5 [@media(max-height:700px)]:p-1.5 flex gap-2 items-start">
                                <AlertTriangle className="text-amber-500 shrink-0 mt-0.5" size={18} />
                                <p className="text-amber-200 text-xs [@media(max-height:700px)]:text-[10px] font-medium leading-tight">
                                    <strong className="block text-amber-500 mb-0.5 font-bold uppercase">Atenção</strong>
                                    Preencha os dados corretamente, pois eles definem as metas e resultados da simulação.
                                </p>
                            </div>
                            <div className="bg-white/10 backdrop-blur border border-white/20 rounded-xl p-3.5 [@media(max-height:700px)]:p-2 transition-all focus-within:bg-white/20 focus-within:border-white/40">
                                <label className="block text-xs [@media(max-height:700px)]:text-[10px] font-bold text-green-400 mb-0.5 uppercase tracking-wider">Nome da Loja</label>
                                <input 
                                    type="text" 
                                    value={storeName}
                                    onChange={(e) => setStoreName(e.target.value)}
                                    className="w-full bg-transparent text-white placeholder-white/50 outline-none text-lg [@media(max-height:700px)]:text-base font-medium"
                                    placeholder="Ex: Supermercado Pão de Mel"
                                />
                            </div>

                            <div className="bg-white/10 backdrop-blur border border-white/20 rounded-xl p-3.5 [@media(max-height:700px)]:p-2 transition-all focus-within:bg-white/20 focus-within:border-white/40">
                                <label className="block text-xs [@media(max-height:700px)]:text-[10px] font-bold text-green-400 mb-0.5 uppercase tracking-wider">Nome do Colaborador</label>
                                <input 
                                    type="text" 
                                    value={fds}
                                    onChange={(e) => setFds(e.target.value)}
                                    className="w-full bg-transparent text-white placeholder-white/50 outline-none text-lg [@media(max-height:700px)]:text-base font-medium"
                                    placeholder="Ex: João Silva"
                                />
                            </div>

                            {/* Custom Store Selector for Registration with Dark Theme */}
                            <div className="bg-white/10 backdrop-blur border border-white/20 rounded-xl p-3.5 [@media(max-height:700px)]:p-2">
                                <label className="block text-xs [@media(max-height:700px)]:text-[10px] font-bold text-green-400 mb-2 uppercase tracking-wider">Tipo de Loja</label>
                                <div className="grid grid-cols-4 gap-2">
                                    {[
                                        { id: 'hiper', label: 'Hiper' },
                                        { id: 'super', label: 'Super' },
                                        { id: 'mini', label: 'Mini' },
                                        { id: 'cc', label: 'C&C' }
                                    ].map(type => (
                                        <button
                                            key={type.id}
                                            onClick={() => setStoreType(type.id)}
                                            className={`py-2.5 [@media(max-height:700px)]:py-1.5 rounded-lg text-xs font-bold transition-all border ${
                                                storeType === type.id
                                                    ? 'bg-[#008200] text-white border-[#008200] shadow-[0_0_15px_rgba(0,130,0,0.5)]'
                                                    : 'bg-white/5 text-gray-400 border-white/10 hover:bg-white/10'
                                            }`}
                                        >
                                            {type.label}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Action Button */}
                        <button 
                            type="button"
                            onClick={onComplete}
                            disabled={!isValid}
                            className={`
                                w-full py-4 [@media(max-height:700px)]:py-2.5 rounded-full font-bold text-lg [@media(max-height:700px)]:text-base uppercase tracking-wider shadow-lg transition-all transform
                                ${isValid 
                                    ? 'bg-[#8bf024] text-[#006900] hover:scale-105 hover:bg-[#9bf53b] hover:shadow-[0_0_20px_rgba(139,240,36,0.4)] cursor-pointer' 
                                    : 'bg-gray-500/50 text-gray-400 cursor-not-allowed grayscale'}
                            `}
                        >
                            Acessar Simulador
                        </button>

                        <button 
                            type="button"
                            onClick={onInstall}
                            className="w-full py-2.5 rounded-full font-bold text-sm [@media(max-height:700px)]:text-xs uppercase tracking-wider text-white/70 hover:text-white hover:bg-white/10 transition-all flex items-center justify-center gap-2"
                        >
                            <Download size={18} />
                            Instalar App
                        </button>

                        <div className="text-center mt-1 [@media(max-height:700px)]:mt-0">
                            <p className="text-white/40 text-[10px]">Desenvolvido por Pedro Lameirão</p>
                        </div>
                    </div>
                </div>
            );
        };

        const AuditoriaTabs = ({ 
            activeTab, onTabChange, 
            presencaData, onPresencaChange, storeType,
            allData, riData, CATEGORIES, activeCategory, onSelectCategory, onUpdateWorld, onUpdateProduct, onUpdateRiWorld, onUpdateRiProduct,
            activePosicionamentoTab, setActivePosicionamentoTab, // New Props
            checklistData, onChecklistChange,
            visibilidadeData, onVisibilidadeChange,
            precificacaoData, onPrecificacaoChange,
            auditoriaScore,
            onCopyList, onDownloadPDF, isCapturing 
        }) => {
            const tabs = [
                { id: 'presenca', label: 'Presença', icon: LayoutGrid },
                { id: 'posicionamento', label: 'Posic.', icon: Target },
                { id: 'visibilidade', label: 'Promo.', icon: Megaphone },
                { id: 'precificacao', label: 'Preço', icon: Tag }
            ];

            return (
                <div className="bg-white rounded-xl shadow-sm border border-gray-100 mb-6 overflow-hidden">
                    <div className="bg-gray-100 p-1 rounded-xl flex gap-1 m-2">
                        {tabs.map(tab => {
                            const Icon = tab.icon;
                            const isActive = activeTab === tab.id;
                            return (
                                <button
                                    key={tab.id}
                                    onClick={() => onTabChange(tab.id)}
                                    className={`flex-1 flex items-center justify-center gap-1 py-2 rounded-lg text-xs md:text-sm font-bold transition-all ${
                                        isActive
                                            ? 'bg-white text-[#008200] shadow-sm ring-1 ring-black/5'
                                            : 'text-gray-500 hover:text-gray-700 hover:bg-gray-200/50'
                                    }`}
                                >
                                    <Icon size={16} />
                                    {tab.label}
                                </button>
                            );
                        })}
                    </div>
                    <div className="p-4">
                        {activeTab === 'presenca' && (
                            <TabPresenca 
                                data={presencaData} 
                                storeType={storeType} 
                                onChange={onPresencaChange} 
                            />
                        )}
                        {activeTab === 'posicionamento' && (
                            <TabPosicionamento 
                                allData={allData}
                                riData={riData}
                                CATEGORIES={CATEGORIES}
                                activeCategory={activeCategory}
                                onSelectCategory={onSelectCategory}
                                onUpdateWorld={onUpdateWorld}
                                onUpdateProduct={onUpdateProduct}
                                onUpdateRiWorld={onUpdateRiWorld}
                                onUpdateRiProduct={onUpdateRiProduct}
                                activeSubTab={activePosicionamentoTab}
                                setActiveSubTab={setActivePosicionamentoTab}
                                checklistData={checklistData}
                                onChecklistChange={onChecklistChange}
                                auditoriaScore={auditoriaScore}
                                onCopyList={onCopyList}
                                onDownloadPDF={onDownloadPDF}
                                isCapturing={isCapturing}
                            />
                        )}
                        {activeTab === 'visibilidade' && (
                            <TabVisibilidade 
                                data={visibilidadeData} 
                                onChange={onVisibilidadeChange} 
                            />
                        )}
                        {activeTab === 'precificacao' && (
                            <TabPrecificacao 
                                data={precificacaoData} 
                                onChange={onPrecificacaoChange} 
                            />
                        )}
                    </div>
                </div>
            );
        };



            const ReportTablePage1 = ({ allData, globalData, date, time, storeName, fds, auditoriaData, auditoriaScore, storeType, isRiMode }) => {
                let headerBg = "bg-red-600";
                let scoreDesc = "Crítico! Ação imediata necessária.";
                
                if (auditoriaScore.total >= 70) {
                    headerBg = "bg-[#008200]";
                    scoreDesc = "Excelente! Execução dentro do padrão.";
                } else if (auditoriaScore.total >= 30) {
                    headerBg = "bg-amber-500";
                    scoreDesc = "Atenção! Oportunidades de melhoria.";
                }

                // COMPACT MODE FOR RI CALCULATOR (Mobile/PDF Optimized)
                if (isRiMode) {
                    return (
                        <div className="bg-white p-6 w-[1280px] font-sans text-gray-900 border border-gray-300 relative min-h-[1800px] h-auto flex flex-col">
                            {/* COMPACT HEADER */}
                            <div className="border-b-4 border-[#008200] pb-4 mb-4 flex justify-between items-end">
                                <div>
                                    <h1 className="text-4xl font-bold text-[#008200] uppercase tracking-tighter">Relatório RI (Detalhado)</h1>
                                    <p className="text-xl text-gray-600 font-semibold mt-1">HEINEKEN BRASIL - SIMULADOR FDS</p>
                                </div>
                                <div className="text-right text-xl text-gray-600 font-medium">
                                    <p>{date} - {time}</p>
                                </div>
                            </div>

                            {/* COMPACT STORE INFO STRIP */}
                            <div className="bg-gray-50 rounded-lg border border-gray-200 p-4 mb-4 flex justify-between items-center text-xl">
                                <div>
                                    <span className="text-gray-500 font-bold text-sm uppercase block">Loja / Tipo</span>
                                    <span className="font-bold text-gray-900">{storeName || '-'} ({storeType?.toUpperCase() || '-'})</span>
                                </div>
                                <div className="text-right">
                                    <span className="text-gray-500 font-bold text-sm uppercase block">Colaborador</span>
                                    <span className="font-bold text-gray-900">{fds || '-'}</span>
                                </div>
                            </div>

                            {/* COMPACT SCOREBOARD STRIP */}
                            <div className="mb-6 rounded-xl overflow-hidden shadow-sm border border-gray-300 flex text-white">
                                <div className={`${headerBg} p-4 w-1/4 flex flex-col justify-center items-center text-center`}>
                                    <span className="text-sm font-bold uppercase opacity-80">Nota Final</span>
                                    <span className="text-5xl font-black">{auditoriaScore.total}</span>
                                </div>
                                <div className="flex-1 bg-gray-800 grid grid-cols-4 divide-x divide-gray-700 items-center">
                                    <div className="p-2 text-center">
                                        <span className="block text-xs text-gray-400 uppercase font-bold">Presença</span>
                                        <span className="block text-3xl font-bold">{auditoriaScore.presenca}</span>
                                    </div>
                                    <div className="p-2 text-center">
                                        <span className="block text-xs text-gray-400 uppercase font-bold">Posic.</span>
                                        <span className="block text-3xl font-bold">{auditoriaScore.posicionamento}</span>
                                    </div>
                                    <div className="p-2 text-center">
                                        <span className="block text-xs text-gray-400 uppercase font-bold">Promo</span>
                                        <span className="block text-3xl font-bold">{auditoriaScore.visibilidade}</span>
                                    </div>
                                    <div className="p-2 text-center">
                                        <span className="block text-xs text-gray-400 uppercase font-bold">Preço</span>
                                        <span className="block text-3xl font-bold">{auditoriaScore.precificacao}</span>
                                    </div>
                                </div>
                            </div>

                            {/* COMPACT CATEGORY GRID */}
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                {Object.entries(CATEGORIES).map(([key, config]) => {
                                    if (key === 'nab' || key === 'rtd' || key === 'outros' || key === 'economy') return null;
                                    const catData = allData[key];
                                    const worldCm = parseFloat(catData.world) || 0;
                                    
                                    let catTotalHnk = 0;
                                    config.products.forEach(brand => {
                                        const skus = RI_SKU_MAPPING[brand] || [];
                                        skus.forEach(sku => {
                                            catTotalHnk += (parseFloat((catData.skus || {})[sku]) || 0);
                                        });
                                    });
                                    
                                    const catShare = worldCm > 0 ? ((catTotalHnk / worldCm) * 100).toFixed(1) : 0;
                                    const isMet = config.target ? parseFloat(catShare) >= config.target : true;
                                    const missingCm = config.target ? ((worldCm * config.target / 100) - catTotalHnk).toFixed(1) : 0;

                                    return (
                                        <div key={key} className="border border-gray-300 rounded-lg overflow-hidden shadow-sm flex flex-col">
                                            {/* Header */}
                                            <div className={`${config.headerColor} px-3 py-2 flex justify-between items-center`}>
                                                <span className="text-lg font-bold uppercase">{config.title}</span>
                                                <div className="flex gap-3 text-sm font-bold">
                                                    {config.target && <span className="opacity-90">Meta: {config.target}%</span>}
                                                    <span className="bg-white/20 px-1.5 rounded">Real: {catShare}%</span>
                                                </div>
                                            </div>
                                            
                                            {/* Table */}
                                            <div className="flex-1 bg-white">
                                                <table className="w-full text-lg">
                                                    <thead>
                                                        <tr className="bg-gray-100/50 border-b border-gray-200 text-gray-600 text-sm uppercase">
                                                            <th className="px-3 py-1 text-left font-bold">Produto / SKU</th>
                                                            <th className="px-3 py-1 text-center font-bold w-24">CM</th>
                                                            <th className="px-3 py-1 text-center font-bold w-20">%</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="divide-y divide-gray-100">
                                                        {config.products.flatMap((brand, bIdx) => {
                                                            const skus = RI_SKU_MAPPING[brand] || [];
                                                            const filledSkus = skus.map(sku => ({
                                                                name: sku,
                                                                val: parseFloat((catData.skus || {})[sku]) || 0
                                                            })).filter(item => item.val > 0);

                                                            if (filledSkus.length === 0) return [];

                                                            return filledSkus.map((item, sIdx) => {
                                                                const share = worldCm > 0 ? ((item.val / worldCm) * 100).toFixed(1) : 0;
                                                                const isFirst = sIdx === 0;
                                                                return (
                                                                    <tr key={`${bIdx}-${sIdx}`} className="hover:bg-gray-50">
                                                                        <td className="px-3 py-1 border-r border-dashed border-gray-100">
                                                                            {isFirst && (
                                                                                <div className="text-xs font-bold text-gray-400 uppercase leading-none mt-1 mb-0.5 tracking-wider">
                                                                                    {brand}
                                                                                </div>
                                                                            )}
                                                                            <div className="text-base font-medium text-gray-800 leading-tight">
                                                                                {item.name}
                                                                            </div>
                                                                        </td>
                                                                        <td className="px-2 py-1 text-center text-base text-gray-700 bg-gray-50/30 align-middle">
                                                                            {item.val}
                                                                        </td>
                                                                        <td className="px-2 py-1 text-center text-base font-bold text-gray-600 align-middle">
                                                                            {share}%
                                                                        </td>
                                                                    </tr>
                                                                );
                                                            });
                                                        })}
                                                        {config.products.every(brand => {
                                                            const skus = RI_SKU_MAPPING[brand] || [];
                                                            return skus.every(sku => !(parseFloat((catData.skus || {})[sku]) > 0));
                                                        }) && (
                                                            <tr>
                                                                <td colSpan="3" className="px-3 py-4 text-center text-gray-400 text-base italic">
                                                                    Nenhum item preenchido
                                                                </td>
                                                            </tr>
                                                        )}
                                                    </tbody>
                                                    <tfoot className="bg-gray-50 border-t border-gray-200">
                                                        <tr className="text-base bg-gray-100">
                                                            <td className="px-3 py-2 text-right font-bold text-gray-500">Mundo: {worldCm}cm</td>
                                                            <td className="px-2 py-2 text-center font-bold text-gray-900">{catTotalHnk}</td>
                                                            <td className={`px-2 py-2 text-center font-bold ${isMet ? 'text-[#008200]' : 'text-red-500'}`}>
                                                                {isMet ? 'OK' : 'GAP'}
                                                            </td>
                                                        </tr>
                                                        {!isMet && config.target && (
                                                            <tr className="bg-red-50 border-t border-red-100">
                                                                <td colSpan="3" className="px-3 py-2 text-center text-red-700 font-bold text-sm">
                                                                    <span className="flex items-center justify-center gap-2">
                                                                        <AlertTriangle size={14} />
                                                                        Faltam {missingCm} cm para atingir a meta
                                                                    </span>
                                                                </td>
                                                            </tr>
                                                        )}
                                                    </tfoot>
                                                </table>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>

                             {/* COMPACT FOOTER */}
                            <div className="mt-auto pt-4 border-t border-gray-200 flex justify-between items-center text-gray-500 text-sm">
                                <div>
                                    <span className="font-bold">TOTAL HEINEKEN:</span> {globalData.hnk}cm
                                    <span className="mx-2">|</span>
                                    <span className="font-bold">TOTAL MUNDO:</span> {globalData.world}cm
                                </div>
                                <div className="text-xl font-black text-[#008200]">
                                    SHARE GERAL: {globalData.share}%
                                </div>
                            </div>
                        </div>
                    );
                }

                // DEFAULT LAYOUT (MANUAL CALCULATOR) - Preserved exact legacy style
                return (
                    <div className="bg-white p-8 w-[1280px] font-sans text-gray-900 border border-gray-300 relative min-h-[1800px] h-auto flex flex-col justify-between">
                        <div>
                            <div className="border-b-8 border-[#008200] pb-6 mb-8 flex justify-between items-end">
                                <div>
                                    <h1 className="text-6xl font-bold text-[#008200] uppercase tracking-tighter">Relatório de Execução</h1>
                                    <p className="text-3xl text-gray-600 font-semibold mt-2">HEINEKEN BRASIL - EXECUÇÃO PERFEITA</p>
                                </div>
                                <div className="text-right text-3xl text-gray-600">
                                    <p>{date}</p>
                                    <p>{time}</p>
                                </div>
                            </div>

                            <div className="mb-8 grid grid-cols-3 gap-6">
                                <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                                    <span className="text-xl font-bold text-gray-500 uppercase block mb-2">Loja</span>
                                    <span className="text-4xl font-bold text-gray-900">{storeName || '-'}</span>
                                </div>
                                <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                                    <span className="text-xl font-bold text-gray-500 uppercase block mb-2">Tipo de Loja</span>
                                    <span className="text-4xl font-bold text-gray-900 uppercase">{storeType || '-'}</span>
                                </div>
                                <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                                    <span className="text-xl font-bold text-gray-500 uppercase block mb-2">Colaborador</span>
                                    <div className="flex items-baseline gap-2">
                                        <span className="text-4xl font-bold text-gray-900">{fds || '-'}</span>
                                    </div>
                                </div>
                            </div>

                            {/* AUDITORIA FDS SECTION */}
                            <div className="mb-8 border border-gray-400 rounded-xl overflow-hidden shadow-sm">
                                <div className={`${headerBg} text-white p-10 flex flex-col justify-center items-center text-center font-bold uppercase gap-4`}>
                                    <div className="flex justify-between w-full items-center px-4">
                                        <span className="text-4xl">Auditoria FDS</span>
                                        <span className="text-8xl">{auditoriaScore.total} <span className="text-4xl opacity-80">/ 100</span></span>
                                    </div>
                                    <span className="text-3xl font-medium opacity-90 normal-case mt-4">{scoreDesc}</span>
                                </div>
                                <div className="grid grid-cols-4 divide-x divide-gray-300 bg-gray-50 border-gray-300 h-[200px] items-center">
                                    <div className="p-6 text-center h-full flex flex-col justify-center">
                                        <span className="block text-2xl font-bold text-gray-600 uppercase mb-3">Presença</span>
                                        <span className="block text-6xl font-black text-gray-900">{auditoriaScore.presenca}</span>
                                    </div>
                                    <div className="p-6 text-center h-full flex flex-col justify-center">
                                        <span className="block text-2xl font-bold text-gray-600 uppercase mb-3">Posicionamento</span>
                                        <span className="block text-6xl font-black text-gray-900">{auditoriaScore.posicionamento}</span>
                                    </div>
                                    <div className="p-6 text-center h-full flex flex-col justify-center">
                                        <span className="block text-2xl font-bold text-gray-600 uppercase mb-3">Promoção</span>
                                        <span className="block text-6xl font-black text-gray-900">{auditoriaScore.visibilidade}</span>
                                    </div>
                                    <div className="p-6 text-center h-full flex flex-col justify-center">
                                        <span className="block text-2xl font-bold text-gray-600 uppercase mb-3">Preço</span>
                                        <span className="block text-6xl font-black text-gray-900">{auditoriaScore.precificacao}</span>
                                    </div>
                                </div>
                            </div>

                            <div className="grid grid-cols-2 gap-8 mb-8">
                                {Object.entries(CATEGORIES).map(([key, config]) => {
                                    const catData = allData[key];
                                    const worldCm = parseFloat(catData.world) || 0;
                                    
                                    let catTotalHnk = 0;
                                    config.products.forEach(p => catTotalHnk += (parseFloat(catData.products[p]) || 0));
                                    
                                    const catShare = worldCm > 0 ? ((catTotalHnk / worldCm) * 100).toFixed(1) : 0;
                                    const isMet = config.target ? parseFloat(catShare) >= config.target : true;

                                    return (
                                        <div key={key} className="border border-gray-400 rounded-xl overflow-hidden shadow-sm">
                                            <div className={`${config.headerColor} p-5 flex flex-col gap-3 font-bold uppercase`}>
                                                <div className="flex justify-between items-center">
                                                    <span className="text-3xl">{config.title}</span>
                                                    <div className="flex gap-6 text-xl">
                                                        {config.target && <span>Meta: {config.target}%</span>}
                                                        <span>Atingido: {catShare}%</span>
                                                    </div>
                                                </div>
                                                {config.target && (parseFloat(catShare) < config.target) && (
                                                    <div className="bg-white/20 p-3 rounded text-center text-xl mt-2">
                                                        Faltam <strong>{((worldCm * config.target / 100) - catTotalHnk).toFixed(1)} cm para a meta</strong>
                                                    </div>
                                                )}
                                            </div>
                                            
                                            <table className="w-full text-2xl">
                                                <thead>
                                                    <tr className="bg-gray-100 border-b border-gray-300 text-gray-700">
                                                        <th className="p-4 text-left w-1/2">Produto</th>
                                                        <th className="p-4 text-center">Exec.</th>
                                                        <th className="p-4 text-center">Share</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-gray-200">
                                                    {config.products.map((prod, idx) => {
                                                        const val = parseFloat(catData.products[prod]) || 0;
                                                        const share = worldCm > 0 ? ((val / worldCm) * 100).toFixed(1) : 0;
                                                        return (
                                                            <tr key={idx} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                                                <td className="p-4 font-medium text-gray-900">{prod}</td>
                                                                <td className="p-4 text-center text-gray-900">{val} cm</td>
                                                                <td className="p-4 text-center font-bold text-gray-600">{share}%</td>
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                                <tfoot className="bg-gray-50 font-bold border-t border-gray-300">
                                                    <tr>
                                                        <td className="p-4 text-right text-gray-600">MUNDO: {worldCm}cm</td>
                                                        <td className="p-4 text-center text-gray-900">{catTotalHnk} cm</td>
                                                        <td className={`p-4 text-center ${isMet ? 'text-[#008200] bg-green-50' : 'text-red-600 bg-red-50'}`}>
                                                            {isMet ? 'OK' : 'GAP'}
                                                        </td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    );
                                })}
                            </div>

                            <div className="bg-gray-900 text-white p-8 flex justify-between items-center border-t-8 border-[#008200] rounded-xl shadow-lg">
                                <div>
                                    <p className="text-xl text-gray-400 uppercase tracking-widest">Resultado Consolidado</p>
                                    <p className="font-black text-5xl mt-2">SHARE CERVEJA</p>
                                </div>
                                <div className="text-right">
                                    <span className="text-7xl font-black text-[#008200]">{globalData.share}%</span>
                                    <p className="text-xl text-gray-400 mt-2">Total HNK: {globalData.hnk}cm / Total Mundo: {globalData.world}cm</p>
                                </div>
                            </div>
                        </div>
                        
                        <div className="text-center text-gray-400 pb-4">
                            Continua na próxima página...
                        </div>
                    </div>
                );
            };

            const ReportTablePage2 = ({ date, time, auditoriaData }) => {
                return (
                    <div className="bg-white p-8 w-[1280px] font-sans text-gray-900 border border-gray-300 min-h-[1800px]">
                        <div className="border-b-4 border-gray-200 pb-4 mb-8 flex justify-between items-end">
                             <h2 className="text-4xl font-bold text-gray-400 uppercase tracking-tighter">Detalhamento</h2>
                             <div className="text-right text-xl text-gray-400">
                                {date} - {time}
                            </div>
                        </div>

                        <div className="p-8 bg-gray-50 rounded-xl border border-gray-200 mb-8 shadow-sm">
                            <h4 className="text-3xl font-bold text-gray-600 uppercase mb-8 border-b border-gray-300 pb-4">Detalhamento da Loja</h4>
                            <div className="grid grid-cols-2 gap-12 text-2xl leading-relaxed">
                                <div>
                                    <p className="font-bold text-gray-900 mb-4 uppercase text-lg tracking-wider">Presença (Mix Obrigatório)</p>
                                    <ul className="list-disc pl-6 space-y-3 text-gray-800">
                                        {Object.entries(auditoriaData.presenca).map(([prod, state]) => {
                                            if (!state.gondola && !state.gelada) return null;
                                            return (
                                                <li key={prod}>
                                                    <span className="font-semibold">{prod}</span>: 
                                                    {state.gondola ? ' Gôndola' : ''}
                                                    {state.gondola && state.gelada ? ' + ' : ''}
                                                    {state.gelada ? ' Gelada' : ''}
                                                </li>
                                            );
                                        })}
                                        {Object.keys(auditoriaData.presenca).length === 0 && <li className="text-gray-500 italic">Nenhum item marcado</li>}
                                    </ul>
                                </div>
                                <div>
                                    <p className="font-bold text-gray-900 mb-4 uppercase text-lg tracking-wider">Pontos Extras & Preço</p>
                                    <ul className="space-y-3 text-gray-800">
                                        <li className="font-bold text-gray-900 text-lg uppercase">Checklist Posicionamento:</li>
                                        {POSICIONAMENTO_CHECKLIST.map(item => {
                                            if (!auditoriaData.posicionamentoChecklist?.[item.id]) return null;
                                            return (
                                                <li key={item.id} className="flex items-start gap-3 pl-4">
                                                    <span className="text-green-600 font-bold text-xl">?</span>
                                                    <span>{item.label} <strong>({item.points} pts)</strong></span>
                                                </li>
                                            );
                                        })}
                                        
                                        <li className="mt-6 pt-4 border-t border-gray-300 font-bold text-lg uppercase text-gray-900">
                                            Promoção (Total Pes: {auditoriaData.visibilidade.totalPes || 0})
                                        </li>
                                        <li className="pl-4">Craft: {auditoriaData.visibilidade.peCraft || 0} PE (Meta: {
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 5 ? '-' : '1'
                                        })</li>
                                        <li className="pl-4">Premium: {auditoriaData.visibilidade.pePremium || 0} PE (Meta: {
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 5 ? '1' :
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 10 ? '2' :
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 15 ? '3' :
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 20 ? '5' : '6'
                                        })</li>
                                        <li className="pl-4">Mainstream: {auditoriaData.visibilidade.peMainstream || 0} PE (Meta: {
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 5 ? '1' :
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 10 ? '1' :
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 15 ? '2' :
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 20 ? '2' : '3'
                                        })</li>
                                        <li className="pt-4 mt-2 border-t border-gray-300 flex justify-between items-center text-xl">
                                            <span>Preço Correto?</span>
                                            <span className={`font-bold px-3 py-1 rounded ${auditoriaData.precificacao ? 'text-green-700 bg-green-100' : 'text-red-700 bg-red-100'}`}>
                                                {auditoriaData.precificacao ? 'SIM' : 'NÃO'}
                                            </span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

const PRICE_RULER_DATA_CC = [
            // --- CRAFT ---
            // EISENBAHN ESTILOS
            { brand: "EISENBAHN WEIZENBIER", sku: "LONG NECK", price: 6.79, promo: 6.79 },
            { brand: "EISENBAHN PALE ALE", sku: "LONG NECK", price: 6.79, promo: 6.79 },
            { brand: "EISENBAHN IPA", sku: "LONG NECK", price: 6.79, promo: 6.79 },
            { brand: "EISENBAHN SESSION IPA", sku: "LONG NECK", price: 6.79, promo: 6.79 },
            { brand: "EISENBAHN PALE ALE", sku: "LATA 350", price: 5.69, promo: 5.09 },
            { brand: "EISENBAHN IPA", sku: "LATA 350", price: 5.69, promo: 5.09 },
            { brand: "EISENBAHN SESSION IPA", sku: "LATA 350", price: 5.69, promo: 5.09 },

            // BADEN BADEN
            { brand: "BADEN BADEN WITBIER", sku: "LATA 350", price: 6.09, promo: 5.39 },
            { brand: "BADEN BADEN AMBER", sku: "LATA 350", price: 6.09, promo: 5.39 },
            { brand: "BADEN BADEN IPA", sku: "LATA 350", price: 6.09, promo: 5.39 },
            { brand: "BADEN BADEN CRYSTAL", sku: "LATA 350", price: 6.09, promo: 5.39 },
            { brand: "BADEN BADEN PEACH", sku: "LATA 350", price: 6.09, promo: 5.39 },
            { brand: "BADEN BADEN GOLDEN", sku: "LATA 350", price: 6.09, promo: 5.39 },
            { brand: "BADEN BADEN WITBIER", sku: "600 ML DESC", price: 14.19, promo: 14.19 },
            { brand: "BADEN BADEN IPA", sku: "600 ML DESC", price: 14.19, promo: 14.19 },
            { brand: "BADEN BADEN CRYSTAL", sku: "600 ML DESC", price: 14.19, promo: 14.19 },
            { brand: "BADEN BADEN PEACH", sku: "600 ML DESC", price: 14.19, promo: 14.19 },
            { brand: "BADEN BADEN GOLDEN", sku: "600 ML DESC", price: 14.19, promo: 14.19 },

            // LAGUNITAS
            { brand: "LAGUNITAS", sku: "LATA 350", price: 8.99, promo: 6.99 },
            { brand: "LAGUNITAS", sku: "LONG NECK", price: 10.99, promo: 10.99 },
            { brand: "LAGUNITAS DAY TIME", sku: "LATA 350", price: 8.99, promo: 6.99 },
            { brand: "LAGUNITAS DAY TIME", sku: "LONG NECK", price: 10.99, promo: 10.99 },

            // BLUE MOON
            { brand: "BLUE MOON", sku: "LATA 350", price: 8.99, promo: 6.99 },
            { brand: "BLUE MOON", sku: "LONG NECK", price: 10.99, promo: 10.99 },

            // --- PREMIUM ---
            // HEINEKEN
            { brand: "HEINEKEN", sku: "SHOT 250", price: 5.29, promo: 4.99 },
            { brand: "HEINEKEN", sku: "LATA 269", price: 4.59, promo: 3.99 },
            { brand: "HEINEKEN", sku: "LATA 350", price: 5.69, promo: 5.29 },
            { brand: "HEINEKEN", sku: "LATA 473", price: 6.59, promo: 6.09 },
            { brand: "HEINEKEN", sku: "LONG NECK", price: 6.99, promo: 6.59 },
            { brand: "HEINEKEN", sku: "600 ML DESC", price: 13.49, promo: 13.49 },
            { brand: "HEINEKEN", sku: "DRAUGHT KEG", price: 113.99, promo: 113.99 },

            // HEINEKEN 0.0
            { brand: "HEINEKEN 0.0", sku: "LATA 269", price: 4.59, promo: 3.99 },
            { brand: "HEINEKEN 0.0", sku: "LATA 350", price: 5.69, promo: 5.29 },
            { brand: "HEINEKEN 0.0", sku: "LONG NECK", price: 6.99, promo: 6.59 },
            
            // HEINEKEN SPRITZ
            { brand: "HEINEKEN SPRITZ", sku: "LONG NECK", price: 6.99, promo: 6.99 },

            // EISENBAHN PILSEN
            { brand: "EISENBAHN PILSEN", sku: "LATA 269", price: 3.09, promo: 3.09 },
            { brand: "EISENBAHN PILSEN", sku: "LATA 350", price: 3.99, promo: 3.99 },
            { brand: "EISENBAHN PILSEN", sku: "LATA 473", price: 4.79, promo: 4.79 },
            { brand: "EISENBAHN PILSEN", sku: "LONG NECK", price: 5.09, promo: 4.19 },
            { brand: "EISENBAHN PILSEN", sku: "600 ML DESC", price: 10.39, promo: 10.39 },

            // EISENBAHN UNFILTERED
            { brand: "EISENBAHN UNFILTERED", sku: "LATA 350", price: 3.99, promo: 3.99 },
            { brand: "EISENBAHN UNFILTERED", sku: "LATA 473", price: 4.79, promo: 4.79 },
            { brand: "EISENBAHN UNFILTERED", sku: "LONG NECK", price: 5.09, promo: 4.19 },

            // SOL PREMIUM
            { brand: "SOL PREMIUM", sku: "LONG NECK", price: 5.19, promo: 4.79 },
            { brand: "SOL PREMIUM", sku: "600 ML DESC", price: 8.99, promo: 8.99 },
            { brand: "SOL PREMIUM 0.0%", sku: "LONG NECK", price: 5.19, promo: 4.79 },

            // AMSTEL ULTRA
            { brand: "AMSTEL ULTRA", sku: "LATA 269", price: 3.99, promo: 3.49 },
            { brand: "AMSTEL ULTRA", sku: "LONG NECK", price: 4.79, promo: 4.79 },

            // --- MAINSTREAM ---
            // AMSTEL
            { brand: "AMSTEL", sku: "LATA 269", price: 3.29, promo: 3.09 },
            { brand: "AMSTEL", sku: "LATA 350", price: 3.89, promo: 3.69 },
            { brand: "AMSTEL", sku: "LATA 473", price: 4.89, promo: 4.69 },
            { brand: "AMSTEL", sku: "LONG NECK", price: 4.69, promo: 4.49 },
            { brand: "AMSTEL", sku: "600 ML DESC", price: 10.09, promo: 10.09 },
            
            // DEVASSA
            { brand: "DEVASSA", sku: "LATA 269", price: 2.79, promo: 2.79 },
            { brand: "DEVASSA", sku: "LATA 350", price: 3.29, promo: 3.09 },
            { brand: "DEVASSA", sku: "LATA 473", price: 3.99, promo: 3.79 },
            
            // TIGER
            { brand: "TIGER", sku: "LATA 269", price: 2.95, promo: 2.75 },
            { brand: "TIGER", sku: "LATA 350", price: 3.49, promo: 3.29 },
            { brand: "TIGER", sku: "LATA 473", price: 3.99, promo: 3.79 },
            
            // ECONOMY
            { brand: "SCHIN", sku: "LATA 269", price: 2.39, promo: 2.39 },
            { brand: "SCHIN", sku: "LATA 350", price: 2.85, promo: 2.85 },
            { brand: "SCHIN", sku: "LATA 473", price: 3.29, promo: 3.29 },
            
            { brand: "KAISER", sku: "LATA 350", price: 2.85, promo: 2.85 },
            { brand: "KAISER", sku: "LATA 473", price: 3.29, promo: 3.29 },
            
            { brand: "BAVARIA", sku: "LATA 350", price: 2.69, promo: 2.69 },
            { brand: "BAVARIA", sku: "LATA 473", price: 3.19, promo: 3.19 },
            
            { brand: "GLACIAL", sku: "LATA 350", price: 2.69, promo: 2.69 },
            { brand: "GLACIAL", sku: "LATA 473", price: 3.19, promo: 3.19 },

            // --- NAB ---
            // FYS TÔNICA
            { brand: "FYS TONICA", sku: "LATA 350", price: 2.99, promo: 2.69 },
            { brand: "FYS TONICA ZERO", sku: "LATA 350", price: 2.99, promo: 2.69 },

            // FYS REFRIGERANTES
            { brand: "FYS LIMÃO SICILIANO", sku: "LATA 350", price: 2.79, promo: 2.49 },
            { brand: "FYS LIMÃO SICILIANO ZERO", sku: "LATA 350", price: 2.79, promo: 2.49 },
            { brand: "FYS GUARANÁ", sku: "LATA 350", price: 2.79, promo: 2.49 },
            { brand: "FYS GUARANÁ ZERO", sku: "LATA 350", price: 2.79, promo: 2.49 },
            { brand: "FYS LARANJA", sku: "LATA 350", price: 2.79, promo: 2.49 },
            { brand: "FYS LARANJA ZERO", sku: "LATA 350", price: 2.79, promo: 2.49 },
            
            // ITUBAINA
            { brand: "ITUBAINA", sku: "LATA 350", price: 2.89, promo: 2.59 },
            { brand: "ITUBAINA", sku: "LONG NECK", price: 3.39, promo: 3.39 },
            { brand: "ITUBAINA", sku: "PET 500ML", price: 3.49, promo: 3.19 },
            
            // SKINKA
            { brand: "SKINKA", sku: "PET 450ML", price: 2.99, promo: 2.99 },

            // CLASH'D
            { brand: "CLASHD", sku: "LATA 269", price: 4.59, promo: 3.99 },

            // --- RTD ---
            // AMSTEL VIBES
            { brand: "AMSTEL VIBES LEMON", sku: "LATA 269", price: 5.69, promo: 4.59 },
            { brand: "AMSTEL VIBES STRAWMELLON", sku: "LATA 269", price: 5.69, promo: 4.59 }
        ];

const PRICE_RULER_DATA_VAREJO = [
            // --- CRAFT ---
            // EISENBAHN ESTILOS
            { brand: "EISENBAHN WEIZENBIER", sku: "LONG NECK", price: 7.19, promo: 7.19 },
            { brand: "EISENBAHN PALE ALE", sku: "LONG NECK", price: 7.19, promo: 7.19 },
            { brand: "EISENBAHN IPA", sku: "LONG NECK", price: 7.19, promo: 7.19 },
            { brand: "EISENBAHN SESSION IPA", sku: "LONG NECK", price: 7.19, promo: 7.19 },
            { brand: "EISENBAHN PALE ALE", sku: "LATA 350", price: 5.99, promo: 5.39 },
            { brand: "EISENBAHN IPA", sku: "LATA 350", price: 5.99, promo: 5.39 },
            { brand: "EISENBAHN SESSION IPA", sku: "LATA 350", price: 5.99, promo: 5.39 },

            // BADEN BADEN
            { brand: "BADEN BADEN WITBIER", sku: "LATA 350", price: 6.39, promo: 5.69 },
            { brand: "BADEN BADEN AMBER", sku: "LATA 350", price: 6.39, promo: 5.69 },
            { brand: "BADEN BADEN IPA", sku: "LATA 350", price: 6.39, promo: 5.69 },
            { brand: "BADEN BADEN CRYSTAL", sku: "LATA 350", price: 6.39, promo: 5.69 },
            { brand: "BADEN BADEN PEACH", sku: "LATA 350", price: 6.39, promo: 5.69 },
            { brand: "BADEN BADEN GOLDEN", sku: "LATA 350", price: 6.39, promo: 5.69 },
            { brand: "BADEN BADEN WITBIER", sku: "600 ML DESC", price: 14.99, promo: 14.99 },
            { brand: "BADEN BADEN IPA", sku: "600 ML DESC", price: 14.99, promo: 14.99 },
            { brand: "BADEN BADEN CRYSTAL", sku: "600 ML DESC", price: 14.99, promo: 14.99 },
            { brand: "BADEN BADEN PEACH", sku: "600 ML DESC", price: 14.99, promo: 14.99 },
            { brand: "BADEN BADEN GOLDEN", sku: "600 ML DESC", price: 14.99, promo: 14.99 },

            // LAGUNITAS
            { brand: "LAGUNITAS", sku: "LATA 350", price: 9.49, promo: 7.39 },
            { brand: "LAGUNITAS", sku: "LONG NECK", price: 11.59, promo: 11.59 },
            { brand: "LAGUNITAS DAY TIME", sku: "LATA 350", price: 9.49, promo: 7.39 },
            { brand: "LAGUNITAS DAY TIME", sku: "LONG NECK", price: 11.59, promo: 11.59 },

            // BLUE MOON
            { brand: "BLUE MOON", sku: "LATA 350", price: 9.49, promo: 7.39 },
            { brand: "BLUE MOON", sku: "LONG NECK", price: 11.59, promo: 11.59 },

            // --- PREMIUM ---
            // HEINEKEN
            { brand: "HEINEKEN", sku: "SHOT 250", price: 5.59, promo: 5.29 },
            { brand: "HEINEKEN", sku: "LATA 269", price: 4.79, promo: 4.19 },
            { brand: "HEINEKEN", sku: "LATA 350", price: 5.99, promo: 5.59 },
            { brand: "HEINEKEN", sku: "LATA 473", price: 7.29, promo: 6.79 },
            { brand: "HEINEKEN", sku: "LONG NECK", price: 6.99, promo: 6.59 },
            { brand: "HEINEKEN", sku: "600 ML DESC", price: 13.49, promo: 13.49 },
            { brand: "HEINEKEN", sku: "DRAUGHT KEG", price: 119.99, promo: 119.99 },

            // HEINEKEN 0.0
            { brand: "HEINEKEN 0.0", sku: "LATA 269", price: 4.79, promo: 4.19 },
            { brand: "HEINEKEN 0.0", sku: "LATA 350", price: 5.99, promo: 5.59 },
            { brand: "HEINEKEN 0.0", sku: "LONG NECK", price: 6.99, promo: 6.59 },
            
            // HEINEKEN SPRITZ
            { brand: "HEINEKEN SPRITZ", sku: "LONG NECK", price: 6.99, promo: 6.99 },

            // EISENBAHN PILSEN
            { brand: "EISENBAHN PILSEN", sku: "LATA 269", price: 3.19, promo: 3.19 },
            { brand: "EISENBAHN PILSEN", sku: "LATA 350", price: 4.19, promo: 4.19 },
            { brand: "EISENBAHN PILSEN", sku: "LATA 473", price: 5.29, promo: 5.29 },
            { brand: "EISENBAHN PILSEN", sku: "LONG NECK", price: 5.39, promo: 4.49 },
            { brand: "EISENBAHN PILSEN", sku: "600 ML DESC", price: 10.39, promo: 10.39 },

            // EISENBAHN UNFILTERED
            { brand: "EISENBAHN UNFILTERED", sku: "LATA 350", price: 4.19, promo: 4.19 },
            { brand: "EISENBAHN UNFILTERED", sku: "LATA 473", price: 5.29, promo: 5.29 },
            { brand: "EISENBAHN UNFILTERED", sku: "LONG NECK", price: 5.39, promo: 4.49 },

            // SOL PREMIUM
            { brand: "SOL PREMIUM", sku: "LONG NECK", price: 5.49, promo: 5.09 },
            { brand: "SOL PREMIUM", sku: "600 ML DESC", price: 9.49, promo: 9.49 },
            { brand: "SOL PREMIUM 0.0%", sku: "LONG NECK", price: 5.49, promo: 5.09 },

            // AMSTEL ULTRA
            { brand: "AMSTEL ULTRA", sku: "LATA 269", price: 4.19, promo: 3.69 },
            { brand: "AMSTEL ULTRA", sku: "LONG NECK", price: 4.99, promo: 4.99 },

            // --- MAINSTREAM ---
            // AMSTEL
            { brand: "AMSTEL", sku: "LATA 269", price: 3.49, promo: 3.29 },
            { brand: "AMSTEL", sku: "LATA 350", price: 4.09, promo: 3.89 },
            { brand: "AMSTEL", sku: "LATA 473", price: 5.49, promo: 5.29 },
            { brand: "AMSTEL", sku: "LONG NECK", price: 4.99, promo: 4.79 },
            { brand: "AMSTEL", sku: "600 ML DESC", price: 10.09, promo: 10.09 },

            // DEVASSA
            { brand: "DEVASSA", sku: "LATA 269", price: 2.89, promo: 2.89 },
            { brand: "DEVASSA", sku: "LATA 350", price: 3.49, promo: 3.29 },
            { brand: "DEVASSA", sku: "LATA 473", price: 4.49, promo: 4.29 },
            
            // TIGER
            { brand: "TIGER", sku: "LATA 269", price: 3.09, promo: 2.89 },
            { brand: "TIGER", sku: "LATA 350", price: 3.69, promo: 3.49 },
            { brand: "TIGER", sku: "LATA 473", price: 4.49, promo: 4.29 },

            // ECONOMY
            { brand: "SCHIN", sku: "LATA 269", price: 2.49, promo: 2.49 },
            { brand: "SCHIN", sku: "LATA 350", price: 2.99, promo: 2.99 },
            { brand: "SCHIN", sku: "LATA 473", price: 3.69, promo: 3.69 },
            
            { brand: "KAISER", sku: "LATA 350", price: 2.99, promo: 2.99 },
            { brand: "KAISER", sku: "LATA 473", price: 3.69, promo: 3.69 },
            
            { brand: "BAVARIA", sku: "LATA 350", price: 2.79, promo: 2.79 },
            { brand: "BAVARIA", sku: "LATA 473", price: 3.59, promo: 3.59 },
            
            { brand: "GLACIAL", sku: "LATA 350", price: 2.79, promo: 2.79 },
            { brand: "GLACIAL", sku: "LATA 473", price: 3.59, promo: 3.59 },

            // --- NAB ---
            // FYS TÔNICA
            { brand: "FYS TONICA", sku: "LATA 350", price: 3.19, promo: 2.89 },
            { brand: "FYS TONICA ZERO", sku: "LATA 350", price: 3.19, promo: 2.89 },

            // FYS REFRIGERANTES
            { brand: "FYS LIMÃO SICILIANO", sku: "LATA 350", price: 2.99, promo: 2.59 },
            { brand: "FYS LIMÃO SICILIANO ZERO", sku: "LATA 350", price: 2.99, promo: 2.59 },
            { brand: "FYS GUARANÁ", sku: "LATA 350", price: 2.99, promo: 2.59 },
            { brand: "FYS GUARANÁ ZERO", sku: "LATA 350", price: 2.99, promo: 2.59 },
            { brand: "FYS LARANJA", sku: "LATA 350", price: 2.99, promo: 2.59 },
            { brand: "FYS LARANJA ZERO", sku: "LATA 350", price: 2.99, promo: 2.59 },
            
            // ITUBAINA
            { brand: "ITUBAINA", sku: "LATA 350", price: 3.09, promo: 2.69 },
            { brand: "ITUBAINA", sku: "LONG NECK", price: 3.59, promo: 3.59 },
            { brand: "ITUBAINA", sku: "PET 500ML", price: 3.69, promo: 3.69 },
            
            // SKINKA
            { brand: "SKINKA", sku: "PET 450ML", price: 3.19, promo: 3.19 },

            // CLASH'D
            { brand: "CLASHD", sku: "LATA 269", price: 4.89, promo: 4.29 },

            // --- RTD ---
            // AMSTEL VIBES
            { brand: "AMSTEL VIBES LEMON", sku: "LATA 269", price: 5.99, promo: 4.79 },
            { brand: "AMSTEL VIBES STRAWMELLON", sku: "LATA 269", price: 5.99, promo: 4.79 }
        ];

        const VALIDITY_DATA_LIST = [
            // --- CRAFT ---
            // EISENBAHN ESTILOS
            { brand: "EISENBAHN WEIZENBIER", sku: "LONG NECK" },
            { brand: "EISENBAHN PALE ALE", sku: "LONG NECK" },
            { brand: "EISENBAHN PALE ALE", sku: "LATA 350ml" },
            { brand: "EISENBAHN IPA", sku: "LONG NECK" },
            { brand: "EISENBAHN IPA", sku: "LATA 350ml" },
            { brand: "EISENBAHN SESSION IPA", sku: "LONG NECK" },
            { brand: "EISENBAHN SESSION IPA", sku: "LATA 350ml" },

            // BADEN BADEN
            { brand: "BADEN BADEN WITBIER", sku: "LATA 350ml" },
            { brand: "BADEN BADEN WITBIER", sku: "GARRAFA 600ml" },
            { brand: "BADEN BADEN AMBER", sku: "LATA 350ml" },
            { brand: "BADEN BADEN IPA", sku: "LATA 350ml" },
            { brand: "BADEN BADEN IPA", sku: "GARRAFA 600ml" },
            { brand: "BADEN BADEN CRYSTAL", sku: "LATA 350ml" },
            { brand: "BADEN BADEN CRYSTAL", sku: "GARRAFA 600ml" },
            { brand: "BADEN BADEN PEACH", sku: "LATA 350ml" },
            { brand: "BADEN BADEN PEACH", sku: "GARRAFA 600ml" },
            { brand: "BADEN BADEN GOLDEN", sku: "LATA 350ml" },
            { brand: "BADEN BADEN GOLDEN", sku: "GARRAFA 600ml" },

            // PRAYA (Classica)
            { brand: "PRAYA", sku: "CLASSICA 355ml" },
            { brand: "PRAYA", sku: "CLASSICA 600ml" },

            // LAGUNITAS
            { brand: "LAGUNITAS", sku: "LONG NECK" },
            { brand: "LAGUNITAS", sku: "LATA 350ml" },

            // BLUE MOON
            { brand: "BLUE MOON", sku: "LONG NECK" },
            { brand: "BLUE MOON", sku: "LATA 350ml" },

            // --- PREMIUM ---
            // HEINEKEN
            { brand: "HEINEKEN", sku: "SHOT 250ml" },
            { brand: "HEINEKEN", sku: "LATA 269ml" },
            { brand: "HEINEKEN", sku: "LATA 350ml" },
            { brand: "HEINEKEN", sku: "LATA 473ml" },
            { brand: "HEINEKEN", sku: "LONG NECK 330ml" },
            { brand: "HEINEKEN", sku: "GARRAFA 600ml" },
            { brand: "HEINEKEN", sku: "KEG 5L" },

            // HEINEKEN 0.0
            { brand: "HEINEKEN 0.0", sku: "LATA 269ml" },
            { brand: "HEINEKEN 0.0", sku: "LATA 350ml" },
            { brand: "HEINEKEN 0.0", sku: "LONG NECK 330ml" },

            // EISENBAHN PILSEN
            { brand: "EISENBAHN PILSEN", sku: "LATA 269ml" },
            { brand: "EISENBAHN PILSEN", sku: "LATA 350ml" },
            { brand: "EISENBAHN PILSEN", sku: "LATA 473ml" },
            { brand: "EISENBAHN PILSEN", sku: "LONG NECK" },
            { brand: "EISENBAHN PILSEN", sku: "GARRAFA 600ml" },

            // EISENBAHN UNFILTERED
            { brand: "EISENBAHN UNFILTERED", sku: "LATA 350ml" },
            { brand: "EISENBAHN UNFILTERED", sku: "LATA 473ml" },
            { brand: "EISENBAHN UNFILTERED", sku: "LONG NECK" },

            // SOL
            { brand: "SOL PREMIUM", sku: "LONG NECK" },
            { brand: "SOL PREMIUM", sku: "GARRAFA 600ml" },
            { brand: "SOL PREMIUM 0.0%", sku: "LONG NECK" },

            // PRAYA (Lager)
            { brand: "PRAYA", sku: "LAGER 355ml" },

            // AMSTEL ULTRA
            { brand: "AMSTEL ULTRA", sku: "LATA 269ml" },
            { brand: "AMSTEL ULTRA", sku: "LONG NECK" },

            // --- MAINSTREAM ---
            // AMSTEL
            { brand: "AMSTEL", sku: "LATA 269ml" },
            { brand: "AMSTEL", sku: "LATA 350ml" },
            { brand: "AMSTEL", sku: "LATA 473ml" },
            { brand: "AMSTEL", sku: "LONG NECK" },
            { brand: "AMSTEL", sku: "GARRAFA 600ml" },

            // --- NAB ---
            // FYS
            { brand: "FYS", sku: "LIMÃO SICILIANO 350ml" },
            { brand: "FYS", sku: "LIMÃO SICILIANO ZERO 350ml" },
            { brand: "FYS", sku: "GUARANÁ DA AMAZÔNIA 350ml" },
            { brand: "FYS", sku: "GUARANÁ DA AMAZÔNIA ZERO 350ml" },
            { brand: "FYS", sku: "LARANJA PERA 350ml" },
            { brand: "FYS", sku: "LARANJA PERA ZERO 350ml" },
            { brand: "FYS TÔNICA", sku: "ÁGUA TÔNICA 350ml" },
            { brand: "FYS TÔNICA", sku: "ÁGUA TÔNICA ZERO 350ml" },
            
             // CLASH'D
            { brand: "CLASHD", sku: "LIMÃO, MORANGO E GENGIBRE 269ml" },
            { brand: "CLASHD", sku: "FRUTAS VERMELHAS E HIBISCO 269ml" },
            { brand: "CLASHD", sku: "MAÇÃ, CANELA E BAUNILHA 269ml" },

            // MAMBA WATER
            { brand: "MAMBA WATER", sku: "LATA 350ml" },
            { brand: "MAMBA WATER", sku: "LATA 350ml COM GÁS" },

            // BAER-MATE
            { brand: "BAER-MATE", sku: "GARRAFA 350ml" },
            { brand: "BAER-MATE", sku: "LATA 269ml" },
            { brand: "BAER-MATCHA", sku: "GARRAFA 350ml" },

            // --- RTD ---
            // AMSTEL VIBES
            { brand: "AMSTEL VIBES", sku: "LEMON (LIMÃO) 269ml" },
            { brand: "AMSTEL VIBES", sku: "STRAWMELLON 269ml" }
        ];

        const SKU_TO_SCORE_GROUP = {
            "BADEN BADEN IPA LATA 350ml": "Baden Baden IPA Lata 350ml OU Vidro 600ml",
            "BADEN BADEN IPA GARRAFA 600ml": "Baden Baden IPA Lata 350ml OU Vidro 600ml",
            "BADEN BADEN WITBIER LATA 350ml": "Baden Baden Witbier Lata 350ml OU Vidro 600ml",
            "BADEN BADEN WITBIER GARRAFA 600ml": "Baden Baden Witbier Lata 350ml OU Vidro 600ml",
            "BADEN BADEN CRYSTAL LATA 350ml": "Baden Baden Pilsen Cristal Lata 350ml OU Vidro 600ml",
            "BADEN BADEN CRYSTAL GARRAFA 600ml": "Baden Baden Pilsen Cristal Lata 350ml OU Vidro 600ml",
            "BADEN BADEN AMBER LATA 350ml": "Baden Baden Amber Lata 350ml",
            "EISENBAHN IPA LATA 350ml": "Eisenbahn IPA Lata 350ml OU Vidro 355ml",
            "EISENBAHN IPA LONG NECK": "Eisenbahn IPA Lata 350ml OU Vidro 355ml",
            "EISENBAHN PALE ALE LATA 350ml": "Eisenbahn Pale Ale Lata 350ml OU Vidro 355ml",
            "EISENBAHN PALE ALE LONG NECK": "Eisenbahn Pale Ale Lata 350ml OU Vidro 355ml",
            "EISENBAHN SESSION IPA LATA 350ml": "Eisenbahn Session Ipa Lata 350ml OU Vidro 355ml",
            "EISENBAHN SESSION IPA LONG NECK": "Eisenbahn Session Ipa Lata 350ml OU Vidro 355ml",
            "EISENBAHN WEIZENBIER LATA 350ml": "Eisenbahn Weizenbier Vidro 355ml",
            "EISENBAHN WEIZENBIER LONG NECK": "Eisenbahn Weizenbier Vidro 355ml",
            "LAGUNITAS LONG NECK": "Lagunitas IPA Lata 350ml OU Vidro 355ml",
            "LAGUNITAS LATA 350ml": "Lagunitas IPA Lata 350ml OU Vidro 355ml",
            "LAGUNITAS DAY TIME LATA 350ml": "Lagunitas Day Time Lata 350ml",
            "LAGUNITAS DAY TIME LONG NECK": "Lagunitas Day Time Vidro 355ml",
            "BLUE MOON LONG NECK": "Blue Moon Lata 350ml ou Vidro 355ml",
            "BLUE MOON LATA 350ml": "Blue Moon Lata 350ml ou Vidro 355ml",
            "PRAYA CLASSICA 355ml": "Praya Classica 355ml OU Classica 600ml",
            "PRAYA CLASSICA 600ml": "Praya Classica 355ml OU Classica 600ml",
            "PRAYA LAGER 355ml": "Praya Lager 355ml",
            "EISENBAHN PILSEN LONG NECK": "Eisenbahn Pilsen Vidro 355ml OU Unfiltered 355ml",
            "EISENBAHN UNFILTERED LONG NECK": "Eisenbahn Pilsen Vidro 355ml OU Unfiltered 355ml",
            "EISENBAHN PILSEN LATA 473ml": "Eisenbahn Pilsen Lata 473ml OU Unfiltered 350ml",
            "EISENBAHN UNFILTERED LATA 350ml": "Eisenbahn Pilsen Lata 473ml OU Unfiltered 350ml",
            "HEINEKEN LATA 350ml": "Heineken Lager Lata 350ml",
            "HEINEKEN LATA 269ml": "Heineken Lager Vidro 250ml OU Lata 269ml",
            "HEINEKEN SHOT 250ml": "Heineken Lager Vidro 250ml OU Lata 269ml",
            "HEINEKEN LATA 473ml": "Heineken Lager Lata 473ml",
            "HEINEKEN LONG NECK 330ml": "Heineken Lager Vidro 330ml",
            "HEINEKEN 0.0 LATA 350ml": "Heineken Pilsen Zero Lata 350ml OU 269ml",
            "HEINEKEN 0.0 LATA 269ml": "Heineken Pilsen Zero Lata 350ml OU 269ml",
            "HEINEKEN 0.0 LONG NECK 330ml": "Heineken Pilsen Zero Vidro 330ml",
            "SOL PREMIUM LONG NECK": "Sol Pilsen Vidro 330ml",
            "AMSTEL ULTRA LONG NECK": "Amstel Ultra Vidro 275ml OU Lata 269ml",
            "AMSTEL ULTRA LATA 269ml": "Amstel Ultra Vidro 275ml OU Lata 269ml",
            "AMSTEL LATA 269ml": "Amstel Lager Lata 269ml",
            "AMSTEL LATA 350ml": "Amstel Lager Lata 350ml",
            "AMSTEL LATA 473ml": "Amstel Lager Lata 473ml",
            "AMSTEL LONG NECK": "Amstel Lager Vidro 355ml",
        };

        const getScoreGroup = (product) => {
            if (SKU_TO_SCORE_GROUP[product]) return SKU_TO_SCORE_GROUP[product];
            if (product.includes("FYS TÔNICA")) return "Fys Tônica Lata 350ml (Regular/Zero)";
            if (product.includes("FYS")) return "Fys (Todos sabores/variações, exceto Tônica)";
            return null;
        };

        const ValidadeReport = ({ data, storeName, fds, date, time }) => {
            return (
                <div className="bg-white p-8 w-[1280px] font-sans text-gray-800 border border-gray-300">
                    <div className="border-b-8 border-blue-600 pb-6 mb-8 flex justify-between items-end">
                        <div>
                            <h1 className="text-6xl font-bold text-blue-600 uppercase tracking-tighter">Relatório de Validade</h1>
                            <p className="text-3xl text-gray-500 font-semibold mt-2">Controle de Vencimentos - Heineken Brasil</p>
                        </div>
                        <div className="text-right text-3xl text-gray-500">
                            <p>{date}</p>
                            <p>{time}</p>
                        </div>
                    </div>

                    <div className="mb-8 grid grid-cols-2 gap-6">
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <span className="text-xl font-bold text-gray-500 uppercase block mb-2">Loja</span>
                            <span className="text-4xl font-bold text-gray-800">{storeName || '-'}</span>
                        </div>
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <span className="text-xl font-bold text-gray-500 uppercase block mb-2">Colaborador</span>
                            <span className="text-4xl font-bold text-gray-800">{fds || '-'}</span>
                        </div>
                    </div>

                    <table className="w-full text-2xl border-collapse">
                        <thead>
                            <tr className="bg-gray-100 border-b-4 border-gray-300 text-gray-600 uppercase">
                                <th className="p-4 text-left">Produto</th>
                                <th className="p-4 text-center">Qtd</th>
                                <th className="p-4 text-center">Vencimento</th>
                                <th className="p-4 text-center">Dias Restantes</th>
                                <th className="p-4 text-center">Status</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y-2 divide-gray-200">
                            {VALIDITY_DATA_LIST.map((item, idx) => {
                                const key = `${item.brand} - ${item.sku}`;
                                const itemData = data[key] || {};
                                const expirationDate = itemData.date;
                                
                                if (!expirationDate) return null;

                                const daysRemaining = Math.ceil((new Date(expirationDate) - new Date()) / (1000 * 60 * 60 * 24));
                                let statusColor = "bg-green-100 text-green-800";
                                let statusText = "OK";

                                if (daysRemaining < 0) {
                                    statusColor = "bg-red-100 text-red-800";
                                    statusText = "VENCIDO";
                                } else if (daysRemaining <= 30) {
                                    statusColor = "bg-amber-100 text-amber-800";
                                    statusText = "CRÍTICO";
                                }

                                return (
                                    <tr key={idx} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                        <td className="p-4 font-medium text-gray-800">{item.brand} {item.sku}</td>
                                        <td className="p-4 text-center font-bold">{itemData.quantity || '-'}</td>
                                        <td className="p-4 text-center">{new Date(expirationDate).toLocaleDateString('pt-BR')}</td>
                                        <td className="p-4 text-center font-bold">{daysRemaining} dias</td>
                                        <td className="p-4 text-center">
                                            <span className={`px-4 py-2 rounded-full font-bold text-xl ${statusColor}`}>
                                                {statusText}
                                            </span>
                                        </td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
            );
        };

        const ValidadeView = ({ data, onChange, onDownload, onDownloadPNG, onCopyList }) => {
            const [searchTerm, setSearchTerm] = useState('');

            const filteredList = VALIDITY_DATA_LIST.filter(item => {
                const searchLower = searchTerm.toLowerCase();
                const fullText = `${item.brand} ${item.sku}`.toLowerCase();
                return fullText.includes(searchLower);
            });

            return (
                <div className="space-y-6">
                    <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                        <div className="flex flex-col justify-between items-center gap-4 mb-4 flex-wrap">
                            <h2 className="text-lg font-bold text-gray-800 flex items-center gap-2">
                                <RefreshCw className="text-blue-500" />
                                Controle de Validade
                            </h2>
                            <div className="flex gap-2 w-full">
                                <div className="relative flex-1">
                                    <input 
                                        type="text" 
                                        placeholder="Buscar produto..." 
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                                    />
                                    <Search className="absolute left-3 top-2.5 text-gray-400 w-4 h-4" />
                                </div>
                                <button
                                    onClick={onCopyList}
                                    className="flex items-center gap-2 bg-gray-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-gray-700 transition-colors shadow-sm text-xs"
                                    title="Copiar Lista de Validade"
                                >
                                    <ClipboardCopy size={16} />
                                </button>
                                <button
                                    onClick={onDownload}
                                    className="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700 transition-colors shadow-sm text-xs"
                                >
                                    PDF
                                </button>
                                <button
                                    onClick={onDownloadPNG}
                                    className="flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-600 transition-colors shadow-sm text-xs"
                                >
                                    PNG
                                </button>
                            </div>
                        </div>

                        <DownloadHelperCard />

                        <div className="grid grid-cols-1 gap-3">
                            {filteredList.map((item, idx) => {
                                const key = `${item.brand} - ${item.sku}`;
                                const itemData = data[key] || {};
                                const expirationDate = itemData.date || '';
                                const quantity = itemData.quantity || '';
                                let daysRemaining = null;
                                let statusColor = "text-gray-500";

                                if (expirationDate) {
                                    daysRemaining = Math.ceil((new Date(expirationDate) - new Date()) / (1000 * 60 * 60 * 24));
                                    if (daysRemaining < 30) statusColor = "text-red-600 font-bold";
                                    else if (daysRemaining <= 45) statusColor = "text-amber-600 font-bold";
                                    else statusColor = "text-green-600 font-bold";
                                }

                                return (
                                    <div key={idx} className="p-4 rounded-lg border border-gray-200 bg-gray-50">
                                        <div className="flex flex-col justify-between gap-4">
                                            <div className="flex-1 min-w-0">
                                                <span className="font-bold text-gray-800 block">{item.brand}</span>
                                                <span className="text-xs text-gray-500 break-words">{item.sku}</span>
                                            </div>
                                            <div className="flex items-center gap-4">
                                                {daysRemaining !== null && (
                                                    <span className={`text-sm ${statusColor}`}>
                                                        {daysRemaining} dias
                                                    </span>
                                                )}
                                                <div className="flex flex-col">
                                                    <label className="text-[10px] font-bold text-gray-500 uppercase mb-1">Qtd (UN)</label>
                                                    <input
                                                        type="number"
                                                        value={quantity}
                                                        onChange={(e) => onChange(key, 'quantity', e.target.value)}
                                                        className="p-2 border border-gray-300 rounded text-sm w-20 focus:ring-1 focus:ring-blue-500 outline-none"
                                                        placeholder="0"
                                                    />
                                                </div>
                                                <div className="flex flex-col w-32 sm:w-auto">
                                                    <label className="text-[10px] font-bold text-gray-500 uppercase mb-1">Validade</label>
                                                    <input
                                                        type="date"
                                                        value={expirationDate}
                                                        onChange={(e) => onChange(key, 'date', e.target.value)}
                                                        className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 outline-none"
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        const PriceRulerReport = ({ data, rulerData, storeName, fds, date, time }) => {
            return (
                <div className="bg-white p-8 w-[1280px] font-sans text-gray-800 border border-gray-300">
                    <div className="border-b-8 border-green-600 pb-6 mb-8 flex justify-between items-end">
                        <div>
                            <h1 className="text-6xl font-bold text-green-600 uppercase tracking-tighter">Relatório de Régua de Preço</h1>
                            <p className="text-3xl text-gray-500 font-semibold mt-2">Auditoria de Preços - Heineken Brasil</p>
                        </div>
                        <div className="text-right text-3xl text-gray-500">
                            <p>{date}</p>
                            <p>{time}</p>
                        </div>
                    </div>

                    <div className="mb-8 grid grid-cols-2 gap-6">
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <span className="text-xl font-bold text-gray-500 uppercase block mb-2">Loja</span>
                            <span className="text-4xl font-bold text-gray-800">{storeName || '-'}</span>
                        </div>
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <span className="text-xl font-bold text-gray-500 uppercase block mb-2">Colaborador</span>
                            <span className="text-4xl font-bold text-gray-800">{fds || '-'}</span>
                        </div>
                    </div>

                    <table className="w-full text-2xl border-collapse">
                        <thead>
                            <tr className="bg-gray-100 border-b-4 border-gray-300 text-gray-600 uppercase">
                                <th className="p-4 text-left">Produto</th>
                                <th className="p-4 text-center">Preço Régua</th>
                                <th className="p-4 text-center">Preço Loja</th>
                                <th className="p-4 text-center">Status</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y-2 divide-gray-200">
                            {rulerData.map((item, idx) => {
                                const key = `${item.brand} - ${item.sku}`;
                                const entry = data[key] || {};
                                const priceStore = entry.price;
                                const pricePromo = entry.promo;
                                
                                if (!priceStore && !pricePromo) return null;

                                let status = "OK";
                                let statusColor = "bg-green-100 text-green-800";
                                
                                // Validation Logic
                                if (priceStore) {
                                    if (parseFloat(priceStore) !== item.price) {
                                        status = "FORA DA RÉGUA";
                                        statusColor = "bg-red-100 text-red-800";
                                    }
                                }
                                if (pricePromo) {
                                    if (parseFloat(pricePromo) !== item.promo) {
                                        status = "FORA DA RÉGUA (PROMO)";
                                        statusColor = "bg-red-100 text-red-800";
                                    }
                                }

                                if (status === "OK") return null;

                                return (
                                    <tr key={idx} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                        <td className="p-4 font-medium text-gray-800">{item.brand} {item.sku}</td>
                                        <td className="p-4 text-center">
                                            <div className="flex flex-col">
                                                <span className="text-gray-500 text-xl">Reg: R$ {item.price.toFixed(2).replace('.', ',')}</span>
                                                <span className="text-gray-500 text-xl">Promo: R$ {item.promo.toFixed(2).replace('.', ',')}</span>
                                            </div>
                                        </td>
                                        <td className="p-4 text-center font-bold">
                                            {priceStore && <div>Reg: R$ {parseFloat(priceStore).toFixed(2).replace('.', ',')}</div>}
                                            {pricePromo && <div>Promo: R$ {parseFloat(pricePromo).toFixed(2).replace('.', ',')}</div>}
                                        </td>
                                        <td className="p-4 text-center">
                                            <span className={`px-4 py-2 rounded-full font-bold text-xl ${statusColor}`}>
                                                {status}
                                            </span>
                                        </td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
            );
        };

        const PriceRulerView = ({ data, rulerData, onChange, onDownload, onDownloadPNG, onCopyList }) => {
            const [searchTerm, setSearchTerm] = useState('');

            const filteredRulerData = rulerData.filter(item => {
                const searchLower = searchTerm.toLowerCase();
                const fullText = `${item.brand} ${item.sku}`.toLowerCase();
                return fullText.includes(searchLower);
            });

            const formatCurrency = (value) => {
                if (!value) return '';
                return parseFloat(value).toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            };

            const handleCurrencyChange = (key, field, value) => {
                const digits = value.replace(/\D/g, '');
                if (!digits) {
                    onChange(key, field, '');
                    return;
                }
                const number = (parseInt(digits, 10) / 100).toFixed(2);
                onChange(key, field, number);
            };

            return (
                <div className="space-y-6">
                    <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                        <div className="flex flex-col md:flex-row justify-between items-center gap-4 mb-4 flex-wrap">
                            <h2 className="text-lg font-bold text-gray-800 flex items-center gap-2">
                                <Tag className="text-green-600" />
                                Régua de Preço
                            </h2>
                            <div className="flex gap-2 w-full md:w-auto">
                                <div className="relative flex-1">
                                    <input 
                                        type="text" 
                                        placeholder="Buscar produto..." 
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500 outline-none"
                                    />
                                    <Search className="absolute left-3 top-2.5 text-gray-400 w-4 h-4" />
                                </div>
                                <button
                                    onClick={onCopyList}
                                    className="flex items-center gap-2 bg-gray-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-gray-700 transition-colors shadow-sm text-xs"
                                    title="Copiar Lista de Divergências"
                                >
                                    <ClipboardCopy size={16} />
                                </button>
                                <button
                                    onClick={onDownload}
                                    className="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700 transition-colors shadow-sm text-xs"
                                >
                                    PDF
                                </button>
                                <button
                                    onClick={onDownloadPNG}
                                    className="flex items-center gap-2 bg-green-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-600 transition-colors shadow-sm text-xs"
                                >
                                    PNG
                                </button>
                            </div>
                        </div>

                        <DownloadHelperCard />

                        <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r shadow-sm">
                            <div className="flex items-center">
                                <Info className="h-5 w-5 text-blue-500 mr-2" />
                                <p className="text-sm text-blue-700 font-bold">
                                    Só preencher o preço promocional caso esteja.
                                </p>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 gap-3">
                            {filteredRulerData.map((item, idx) => {
                                const key = `${item.brand} - ${item.sku}`;
                                const entry = data[key] || {};
                                
                                const isStorePriceWrong = entry.price && parseFloat(entry.price) !== item.price;
                                const isPromoPriceWrong = entry.promo && parseFloat(entry.promo) !== item.promo;

                                return (
                                    <div key={idx} className="p-4 rounded-lg border border-gray-200 bg-gray-50">
                                        <div className="flex flex-col gap-3">
                                            <div className="flex justify-between items-start">
                                                <div>
                                                    <span className="font-bold text-gray-800 block">{item.brand}</span>
                                                    <span className="text-xs text-gray-500">{item.sku}</span>
                                                </div>
                                                <div className="text-right text-xs text-gray-500">
                                                    <div>Régua: <span className="font-bold">R$ {item.price.toFixed(2).replace('.', ',')}</span></div>
                                                    <div>Promo: <span className="font-bold">R$ {item.promo.toFixed(2).replace('.', ',')}</span></div>
                                                </div>
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label className="text-[10px] font-bold text-gray-500 uppercase block mb-1">PREÇO LOJA</label>
                                                    <input
                                                        type="text"
                                                        inputMode="numeric"
                                                        value={formatCurrency(entry.price)}
                                                        onChange={(e) => handleCurrencyChange(key, 'price', e.target.value)}
                                                        className={`w-full p-2 border rounded text-sm outline-none ${isStorePriceWrong ? 'border-red-500 bg-red-50 text-red-700' : 'border-gray-300 focus:border-green-500'}`}
                                                        placeholder="0,00"
                                                    />
                                                    {isStorePriceWrong && <span className="text-[10px] text-red-500 font-bold">Fora da Régua</span>}
                                                </div>
                                                <div>
                                                    <label className="text-[10px] font-bold text-gray-500 uppercase block mb-1">PROMO LOJA</label>
                                                    <input
                                                        type="text"
                                                        inputMode="numeric"
                                                        value={formatCurrency(entry.promo)}
                                                        onChange={(e) => handleCurrencyChange(key, 'promo', e.target.value)}
                                                        className={`w-full p-2 border rounded text-sm outline-none ${isPromoPriceWrong ? 'border-red-500 bg-red-50 text-red-700' : 'border-gray-300 focus:border-green-500'}`}
                                                        placeholder="0,00"
                                                    />
                                                    {isPromoPriceWrong && <span className="text-[10px] text-red-500 font-bold">Fora da Régua</span>}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        const RupturasReport = ({ data, storeType, storeName, fds, date, time }) => {
            const totalPotentialPoints = Object.values(SCORES_PRESENCA).reduce((acc, scores) => {
                const s = scores[storeType] || { gondola: 0, gelada: 0 };
                return acc + s.gondola + s.gelada;
            }, 0);

            // Calculate total lost points based on Score Groups (OR logic)
            const totalLostPoints = Object.keys(SCORES_PRESENCA).reduce((acc, scoreGroup) => {
                // Find all SKUs that belong to this score group
                const groupSkus = VALIDITY_DATA_LIST.filter(item => {
                    const product = `${item.brand} ${item.sku}`;
                    return getScoreGroup(product) === scoreGroup;
                });

                // If no SKUs found for this group (shouldn't happen if mapping is complete), skip
                if (groupSkus.length === 0) return acc;

                // Check if ALL items in this group are 'ruptura' OR 'n_cadastrado'
                const allLost = groupSkus.every(item => {
                    const product = `${item.brand} ${item.sku}`;
                    const status = data[product];
                    return status === 'ruptura' || status === 'n_cadastrado';
                });

                if (allLost) {
                    const scores = SCORES_PRESENCA[scoreGroup][storeType] || { gondola: 0, gelada: 0 };
                    return acc + scores.gondola + scores.gelada;
                }

                return acc;
            }, 0);

            const ruptureCount = Object.values(data).filter(s => s === 'ruptura').length;
            const lowVolumeCount = Object.values(data).filter(s => s === 'baixo_volume').length;

            return (
                <div className="bg-white p-8 w-[1280px] font-sans text-gray-800 border border-gray-300">
                    <div className="border-b-8 border-red-600 pb-6 mb-8 flex justify-between items-end">
                        <div>
                            <h1 className="text-6xl font-bold text-red-600 uppercase tracking-tighter">Relatório de Rupturas</h1>
                            <p className="text-3xl text-gray-500 font-semibold mt-2">Gestão de Disponibilidade - Heineken Brasil</p>
                        </div>
                        <div className="text-right text-3xl text-gray-500">
                            <p>{date}</p>
                            <p>{time}</p>
                        </div>
                    </div>

                    <div className="mb-8 grid grid-cols-3 gap-6">
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <span className="text-xl font-bold text-gray-500 uppercase block mb-2">Loja</span>
                            <span className="text-4xl font-bold text-gray-800">{storeName || '-'}</span>
                        </div>
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <span className="text-xl font-bold text-gray-500 uppercase block mb-2">Tipo de Loja</span>
                            <span className="text-4xl font-bold text-gray-800 uppercase">{storeType || '-'}</span>
                        </div>
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <span className="text-xl font-bold text-gray-500 uppercase block mb-2">Colaborador</span>
                            <span className="text-4xl font-bold text-gray-800">{fds || '-'}</span>
                        </div>
                    </div>

                    <div className="grid grid-cols-3 gap-6 mb-8">
                        <div className="bg-red-50 p-6 rounded-xl border border-red-200 text-center">
                            <span className="text-xl font-bold text-red-600 uppercase block mb-2">Itens em Ruptura</span>
                            <span className="text-6xl font-bold text-red-700">{ruptureCount}</span>
                        </div>
                        <div className="bg-amber-50 p-6 rounded-xl border border-amber-200 text-center">
                            <span className="text-xl font-bold text-amber-600 uppercase block mb-2">Baixo Volume</span>
                            <span className="text-6xl font-bold text-amber-700">{lowVolumeCount}</span>
                        </div>
                        <div className="bg-gray-800 p-6 rounded-xl border border-gray-700 text-center text-white">
                            <span className="text-xl font-bold text-gray-400 uppercase block mb-2">Pontos Perdidos</span>
                            <span className="text-6xl font-bold">{totalLostPoints} <span className="text-3xl text-gray-500">/ {totalPotentialPoints}</span></span>
                        </div>
                    </div>

                    <div className="grid grid-cols-3 gap-6">
                        {VALIDITY_DATA_LIST.map((item, idx) => {
                            const product = `${item.brand} ${item.sku}`;
                            const status = data[product] || 'ok';
                            
                            // Calculate if points are actually lost for this specific item
                            const scoreGroup = getScoreGroup(product);
                            let isLost = false;
                            
                            if ((status === 'ruptura' || status === 'n_cadastrado') && scoreGroup) {
                                // Check if any other item in the same group is AVAILABLE (not ruptura AND not n_cadastrado)
                                const groupSkus = VALIDITY_DATA_LIST.filter(i => getScoreGroup(`${i.brand} ${i.sku}`) === scoreGroup);
                                const anyAvailable = groupSkus.some(i => {
                                    const p = `${i.brand} ${i.sku}`;
                                    const s = data[p];
                                    return s !== 'ruptura' && s !== 'n_cadastrado';
                                });
                                // If NO item is available, then points are lost
                                isLost = !anyAvailable;
                            }

                            // Filter out OK items and Not Registered items
                            if (status === 'ok' || status === 'n_cadastrado') return null;



                            const currentScores = (scoreGroup && SCORES_PRESENCA[scoreGroup] && SCORES_PRESENCA[scoreGroup][storeType]) || { gondola: 0, gelada: 0 };
                            const potentialPoints = currentScores.gondola + currentScores.gelada;
                            const lostPoints = isLost ? potentialPoints : 0;

                            let statusColor = "bg-green-100 text-green-800 border-green-200";
                            let statusText = "OK";
                            if (status === 'ruptura') {
                                statusColor = "bg-red-100 text-red-800 border-red-200";
                                statusText = "RUPTURA";
                            } else if (status === 'baixo_volume') {
                                statusColor = "bg-amber-100 text-amber-800 border-amber-200";
                                statusText = "BAIXO VOL.";
                            } else if (status === 'n_cadastrado') {
                                statusColor = "bg-gray-100 text-gray-800 border-gray-200";
                                statusText = "N/ CADAST.";
                            }

                            return (
                                <div key={product} className={`p-4 rounded-xl border ${statusColor} flex flex-col justify-between h-full`}>
                                    <div className="mb-4">
                                        <span className="font-bold text-gray-800 text-3xl leading-tight block mb-2">{item.brand}</span>
                                        <span className="text-xl text-gray-600 block">{item.sku}</span>
                                    </div>
                                    <div className="flex justify-between items-end mt-2">
                                        <span className={`px-4 py-2 rounded-lg text-xl font-bold uppercase ${
                                            status === 'ok' ? 'bg-green-200' : 
                                            status === 'ruptura' ? 'bg-red-200' : 
                                            status === 'baixo_volume' ? 'bg-amber-200' :
                                            'bg-gray-300'
                                        }`}>
                                            {statusText}
                                        </span>

                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const RupturasView = ({ storeType, data, onChange, onDownload, onDownloadPNG, onCopyList }) => {
            const [searchTerm, setSearchTerm] = useState('');

            const filteredList = VALIDITY_DATA_LIST.filter(item => {
                const searchLower = searchTerm.toLowerCase();
                const fullText = `${item.brand} ${item.sku}`.toLowerCase();
                return fullText.includes(searchLower);
            });

            return (
                <div className="space-y-6">
                    <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                         <div className="flex flex-col md:flex-row justify-between items-center gap-4 mb-4 flex-wrap">
                            <h2 className="text-lg font-bold text-gray-800 flex items-center gap-2">
                                <AlertTriangle className="text-red-500" />
                                Controle de Rupturas
                            </h2>
                            <div className="flex gap-2 w-full md:w-auto">
                                <div className="relative flex-1">
                                    <input 
                                        type="text" 
                                        placeholder="Buscar produto..." 
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-red-500 outline-none"
                                    />
                                    <Search className="absolute left-3 top-2.5 text-gray-400 w-4 h-4" />
                                </div>
                                <button
                                    onClick={onCopyList}
                                    className="flex items-center gap-2 bg-gray-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-gray-700 transition-colors shadow-sm text-xs"
                                    title="Copiar Lista de Rupturas"
                                >
                                    <ClipboardCopy size={16} />
                                </button>
                                <button
                                    onClick={onDownload}
                                    className="flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-red-700 transition-colors shadow-sm text-xs"
                                >
                                    PDF
                                </button>
                                <button
                                    onClick={onDownloadPNG}
                                    className="flex items-center gap-2 bg-red-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-red-600 transition-colors shadow-sm text-xs"
                                >
                                    PNG
                                </button>
                            </div>
                        </div>

                        <DownloadHelperCard />

                        <div className="bg-amber-50 border-l-4 border-amber-500 p-4 rounded-r shadow-sm">
                            <div className="flex items-center">
                                <AlertTriangle className="h-5 w-5 text-amber-500 mr-2" />
                                <p className="text-sm text-amber-700 font-bold">
                                    Atenção ao preencher, não colocar itens não cadastrados na rede como ruptura
                                </p>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 gap-3">
                            {filteredList.map((item) => {
                                const product = `${item.brand} ${item.sku}`;
                                const scoreGroup = getScoreGroup(product);
                                const currentScores = (scoreGroup && SCORES_PRESENCA[scoreGroup] && SCORES_PRESENCA[scoreGroup][storeType]) || { gondola: 0, gelada: 0 };
                                const potentialPoints = currentScores.gondola + currentScores.gelada;
                                const status = data[product] || 'ok';

                                return (
                                    <div key={product} className={`p-3 rounded-lg border transition-all ${
                                        status === 'ruptura' ? 'bg-red-50 border-red-200' : 
                                        status === 'baixo_volume' ? 'bg-amber-50 border-amber-200' : 
                                        status === 'n_cadastrado' ? 'bg-gray-100 border-gray-300' :
                                        'bg-gray-50 border-gray-200'
                                    }`}>
                                        <div className="flex flex-col gap-3">
                                            <div>
                                                <span className="font-bold text-gray-800 block uppercase text-sm leading-tight break-words">{product}</span>

                                            </div>
                                            
                                            <div className="grid grid-cols-4 gap-2">
                                                <button
                                                    onClick={() => onChange(product, 'ok')}
                                                    className={`py-2 rounded text-[10px] sm:text-xs font-bold border transition-all ${
                                                        status === 'ok' 
                                                            ? 'bg-green-600 text-white border-green-600 shadow-sm' 
                                                            : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'
                                                    }`}
                                                >
                                                    OK
                                                </button>
                                                <button
                                                    onClick={() => onChange(product, 'baixo_volume')}
                                                    className={`py-2 rounded text-[10px] sm:text-xs font-bold border transition-all ${
                                                        status === 'baixo_volume' 
                                                            ? 'bg-amber-500 text-white border-amber-500 shadow-sm' 
                                                            : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'
                                                    }`}
                                                >
                                                    BAIXO VOL.
                                                </button>
                                                <button
                                                    onClick={() => onChange(product, 'ruptura')}
                                                    className={`py-2 rounded text-[10px] sm:text-xs font-bold border transition-all ${
                                                        status === 'ruptura' 
                                                            ? 'bg-red-600 text-white border-red-600 shadow-sm' 
                                                            : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'
                                                    }`}
                                                >
                                                    RUPTURA
                                                </button>
                                                <button
                                                    onClick={() => onChange(product, 'n_cadastrado')}
                                                    className={`py-2 rounded text-[10px] sm:text-xs font-bold border transition-all ${
                                                        status === 'n_cadastrado' 
                                                            ? 'bg-gray-600 text-white border-gray-600 shadow-sm' 
                                                            : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'
                                                    }`}
                                                >
                                                    N/ CADAST.
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        // --- HOOKS CUSTOMIZADOS ---
        function useStickyState(defaultValue, key) {
            const [value, setValue] = useState(() => {
                try {
                    const stickyValue = window.localStorage.getItem(key);
                    return stickyValue !== null
                        ? JSON.parse(stickyValue)
                        : defaultValue;
                } catch (error) {
                    console.warn(`Error reading localStorage key "${key}":`, error);
                    return defaultValue;
                }
            });
            useEffect(() => {
                try {
                    window.localStorage.setItem(key, JSON.stringify(value));
                } catch (error) {
                    console.warn(`Error writing localStorage key "${key}":`, error);
                }
            }, [key, value]);
            return [value, setValue];
        }

        // Scroll To Top Component
        const ScrollToTopButton = () => {
            const [isVisible, setIsVisible] = React.useState(false);

            React.useEffect(() => {
                const toggleVisibility = () => {
                    if (window.pageYOffset > 300) {
                        setIsVisible(true);
                    } else {
                        setIsVisible(false);
                    }
                };

                window.addEventListener("scroll", toggleVisibility);

                return () => window.removeEventListener("scroll", toggleVisibility);
            }, []);

            const scrollToTop = () => {
                window.scrollTo({
                    top: 0,
                    behavior: "smooth"
                });
            };

            if (!isVisible) {
                return null;
            }

            return (
                <div className="fixed bottom-0 left-0 right-0 z-50 flex justify-center pointer-events-none">
                    <div className="w-full max-w-md relative">
                         <button
                            onClick={scrollToTop}
                            className="absolute bottom-20 right-4 bg-gray-600 text-white p-3 rounded-full shadow-lg hover:bg-gray-800 transition-all opacity-80 hover:opacity-100 flex items-center justify-center w-12 h-12 pointer-events-auto"
                            aria-label="Voltar ao topo"
                        >
                            <ChevronUp size={24} />
                        </button>
                    </div>
                </div>
            );
        };

        const ScoreRulesGuide = () => {
             const [showGuide, setShowGuide] = useState(true);
             if(!showGuide) return null;
             
             return (
                <div className="bg-orange-50 border-l-4 border-orange-500 shadow-md p-3 rounded-r-lg relative animate-in fade-in slide-in-from-top-2 mb-4">
                        <button 
                        onClick={() => setShowGuide(false)}
                        className="absolute top-2 right-2 text-orange-300 hover:text-orange-500"
                    >
                        <X size={14} />
                    </button>
                    <div className="flex gap-3 items-center pr-5">
                        <div className="p-1.5 bg-orange-100 rounded-full shrink-0 animate-pulse">
                            <AlertTriangle className="text-orange-600" size={16} />
                        </div>
                        <div>
                            <p className="text-[11px] font-bold text-orange-900 uppercase tracking-wide leading-tight mb-0.5">
                                Importante
                            </p>
                            <p className="text-[11px] text-orange-800 leading-tight">
                                A nota e os relatórios (PDF/Cópia) mudam conforme a <strong>Calculadora (Manual ou RI)</strong> selecionada na tela.
                            </p>
                        </div>
                    </div>
                </div>
             );
        };

        const App = () => {
            // --- DATA STATES (STICKY) ---
            const [allData, setAllData] = useStickyState({
                ...(() => {
                    const initial = {};
                    Object.keys(CATEGORIES).forEach(key => initial[key] = { world: '', products: {} });
                    return initial;
                })()
            }, 'sovi_heineken_allData');

            const [riData, setRiData] = useStickyState({
                ...(() => {
                    const initial = {};
                    Object.keys(CATEGORIES).forEach(key => initial[key] = { world: '', products: {}, skus: {} });
                    return initial;
                })()
            }, 'sovi_heineken_riData');
            
            const [storeName, setStoreName] = useStickyState('', 'sovi_heineken_storeName');
            const [fds, setFds] = useStickyState('', 'sovi_heineken_fds');
            const [storeType, setStoreType] = useStickyState('mini', 'sovi_heineken_storeType');
            const [activeCategory, setActiveCategory] = useStickyState('premium', 'sovi_heineken_activeCategory');
            
            const [rupturasData, setRupturasData] = useStickyState({}, 'sovi_heineken_rupturasData');
            const [validityData, setValidityData] = useStickyState({}, 'sovi_heineken_validityData');
            const [priceRulerData, setPriceRulerData] = useStickyState({}, 'sovi_heineken_priceRulerData');

            // --- UI STATES (NON-STICKY) ---
            const [activeView, setActiveView] = useState('simulador');
            const [isRegistered, setIsRegistered] = useState(false); 
            const [showCreditsModal, setShowCreditsModal] = useState(false);
            const [deferredPrompt, setDeferredPrompt] = useState(null);
            const [showInstallModal, setShowInstallModal] = useState(false);
            const [isIOS, setIsIOS] = useState(false);
            const [installPlatform, setInstallPlatform] = useState('ios');

            // --- AUDITORIA STATE ---
            const [activeAuditoriaTab, setActiveAuditoriaTab] = useStickyState('presenca', 'sovi_heineken_activeAuditoriaTab');
            const [activePosicionamentoTab, setActivePosicionamentoTab] = useStickyState('checklist', 'sovi_heineken_activePosicionamentoTab');
            const [auditoriaData, setAuditoriaData] = useStickyState({
                presenca: {}, 
                posicionamentoChecklist: {},
                visibilidade: {
                    totalPes: '',
                    peCraft: '',
                    pePremium: '',
                    peMainstream: ''
                },
                precificacao: false
            }, 'sovi_heineken_auditoriaData');

            // ... (useEffect hooks kept same)
            useEffect(() => {
                const handler = (e) => {
                    e.preventDefault();
                    setDeferredPrompt(e);
                };
                window.addEventListener('beforeinstallprompt', handler);
                const isIos = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
                setIsIOS(isIos);
                return () => window.removeEventListener('beforeinstallprompt', handler);
            }, []);

            useEffect(() => {
                setAllData(prev => {
                    if (!prev) return prev;
                    const next = { ...prev };
                    let changed = false;
                    Object.keys(CATEGORIES).forEach(key => {
                        if (!next[key]) {
                            next[key] = { world: '', products: {} };
                            changed = true;
                        }
                    });
                    return changed ? next : prev;
                });

                setAuditoriaData(prev => {
                    const defaultVis = { totalPes: '', peCraft: '', pePremium: '', peMainstream: '' };
                    if (!prev) return {
                        presenca: {}, 
                        posicionamentoChecklist: {},
                        visibilidade: defaultVis,
                        precificacao: false
                    };
                    const next = { ...prev };
                    let changed = false;
                    if (!next.visibilidade) { next.visibilidade = defaultVis; changed = true; }
                    if (!next.presenca) { next.presenca = {}; changed = true; }
                    if (!next.posicionamentoChecklist) { next.posicionamentoChecklist = {}; changed = true; }
                    return changed ? next : prev;
                });

                if (activeCategory && !CATEGORIES[activeCategory]) {
                     setActiveCategory(Object.keys(CATEGORIES)[0]);
                }
            }, []);

            const handleInstallClick = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    setDeferredPrompt(null);
                } else if (isIOS) {
                    setInstallPlatform('ios');
                    setShowInstallModal(true);
                } else {
                   setInstallPlatform('generic');
                   setShowInstallModal(true);
                }
            };
            
            const rupturasReportRef = useRef(null);
            const validityReportRef = useRef(null);
            const priceRulerReportRef = useRef(null);
            const reportPage1Ref = useRef(null);
            const reportPage2Ref = useRef(null);

            const reportRef = useRef(null);
            const [isCapturing, setIsCapturing] = useState(false);

            const handleUpdateWorld = (catKey, val) => {
                setAllData(prev => ({
                    ...prev,
                    [catKey]: { ...prev[catKey], world: val }
                }));
            };

            const handleUpdateProduct = (catKey, prodName, val) => {
                setAllData(prev => ({
                    ...prev,
                    [catKey]: {
                        ...prev[catKey],
                        products: { ...prev[catKey].products, [prodName]: val }
                    }
                }));
            };

            const handleUpdateRiWorld = (catKey, val) => {
                setRiData(prev => ({
                    ...prev,
                    [catKey]: { ...prev[catKey], world: val }
                }));
            };

            const handleUpdateRiProduct = (catKey, skuName, val) => {
                setRiData(prev => ({
                    ...prev,
                    [catKey]: {
                        ...prev[catKey],
                        skus: { ...prev[catKey].skus, [skuName]: val }
                    }
                }));
            };

            // AUDITORIA HANDLERS
            const handleUpdateAuditoriaPresenca = (product, type, value) => {
                setAuditoriaData(prev => ({
                    ...prev,
                    presenca: {
                        ...prev.presenca,
                        [product]: {
                            ...prev.presenca[product],
                            [type]: value
                        }
                    }
                }));
            };

            const handleUpdateAuditoriaVisibilidade = (field, value) => {
                setAuditoriaData(prev => ({
                    ...prev,
                    visibilidade: {
                        ...prev.visibilidade,
                        [field]: value
                    }
                }));
            };

            const handleUpdateAuditoriaPrecificacao = (value) => {
                setAuditoriaData(prev => ({ ...prev, precificacao: value }));
            };

            const handleUpdateAuditoriaPosicionamentoChecklist = (id, checked) => {
                setAuditoriaData(prev => ({ ...prev, posicionamentoChecklist: { ...prev.posicionamentoChecklist, [id]: checked } }));
            };

            const handleRupturasChange = (product, status) => {
                setRupturasData(prev => ({ ...prev, [product]: status }));
            };

            const handleValidityChange = (key, field, value) => {
                setValidityData(prev => ({ ...prev, [key]: { ...prev[key], [field]: value } }));
            };

            const handlePriceRulerChange = (key, field, value) => {
                setPriceRulerData(prev => ({ ...prev, [key]: { ...prev[key], [field]: value } }));
            };

            const handleReset = () => {
                if(window.confirm("Deseja limpar todos os dados inseridos?")) {
                    const reset = {};
                    Object.keys(CATEGORIES).forEach(key => reset[key] = { world: '', products: {} });
                    setAllData(reset);
                    setStoreName('');
                    setFds('');
                    setAuditoriaData({
                        presenca: {},
                        visibilidade: { totalPes: '', peCraft: '', pePremium: '', peMainstream: '' },
                        precificacao: false
                    });
                    setStoreType('hiper');
                    setRupturasData({});
                    setValidityData({});
                    setPriceRulerData({});
                }
            };

            const calculateGlobalShare = () => {
                let totalHnk = 0;
                let totalWorld = 0;

                if (!allData) return { share: '0.0', hnk: 0, world: 0 };

                Object.entries(allData).forEach(([key, data]) => {
                    if (key === 'nab' || key === 'rtd') return;
                    if (!data) return;

                    const worldCm = parseFloat(data.world) || 0;
                    totalWorld += worldCm;
                    
                    const config = CATEGORIES[key];
                    if (config && config.products && data.products) {
                        config.products.forEach(prod => {
                            totalHnk += (parseFloat(data.products[prod]) || 0);
                        });
                    }
                });

                const share = totalWorld > 0 ? ((totalHnk / totalWorld) * 100).toFixed(1) : '0.0';
                return { share, hnk: totalHnk, world: totalWorld };
            };

            const calculateRiGlobalShare = () => {
                let totalHnk = 0;
                let totalWorld = 0;

                if (!riData) return { share: '0.0', hnk: 0, world: 0 };

                Object.entries(riData).forEach(([key, data]) => {
                    if (key === 'nab' || key === 'rtd' || key === 'outros' || key === 'economy') return;
                    if (!data) return;

                    const worldCm = parseFloat(data.world) || 0;
                    totalWorld += worldCm;
                    
                    const config = CATEGORIES[key];
                    if (config && config.products && data.skus) {
                        config.products.forEach(brand => {
                             const skus = RI_SKU_MAPPING[brand] || [];
                             skus.forEach(sku => {
                                 totalHnk += (parseFloat(data.skus[sku]) || 0);
                             });
                        });
                    }
                });

                const share = totalWorld > 0 ? ((totalHnk / totalWorld) * 100).toFixed(1) : '0.0';
                return { share, hnk: totalHnk, world: totalWorld };
            };

            const globalData = calculateGlobalShare();
            const riGlobalData = calculateRiGlobalShare();

            const calculateAuditoriaScore = () => {
                // 0. Safety Check
                if (!auditoriaData) return { presenca: 0, posicionamento: 0, visibilidade: 0, precificacao: 0, total: 0 };

                // 1. PRESENÇA
                let scorePresenca = 0;
                if (auditoriaData.presenca) {
                    Object.entries(SCORES_PRESENCA).forEach(([product, scores]) => {
                        const productState = auditoriaData.presenca[product];
                        if (productState) {
                            const typeScores = scores[storeType] || { gondola: 0, gelada: 0 };
                            if (productState.gondola) scorePresenca += typeScores.gondola;
                            if (productState.gelada) scorePresenca += typeScores.gelada;
                        }
                    });
                }

                // 2. POSICIONAMENTO (SOVI)
                let scorePosicionamento = 0;
                
                // Helper to calculate share for a category
                const getCatShare = (catKey) => {
                    // Decide which data source to use based on active tab
                    // If in RI tab, use RI data. Otherwise (Checklist/Manual), use Manual data.
                    const dataSource = activePosicionamentoTab === 'ri' ? riData : allData;
                    const catData = dataSource[catKey];

                    if (!catData || !catData.products) return 0;

                    const worldCm = parseFloat(catData.world) || 0;
                    const config = CATEGORIES[catKey];
                    
                    if (!config) return 0;
                    
                    let catTotalHnk = 0;
                    if (activePosicionamentoTab === 'ri') {
                         config.products.forEach(brand => {
                            const skus = RI_SKU_MAPPING[brand] || [];
                            skus.forEach(sku => {
                                catTotalHnk += (parseFloat((catData.skus || {})[sku]) || 0);
                            });
                        });
                    } else {
                        config.products.forEach(prod => {
                            catTotalHnk += (parseFloat(catData.products[prod]) || 0);
                        });
                    }
                    
                    return worldCm > 0 ? (catTotalHnk / worldCm) * 100 : 0;
                };

                // Premium Rule: >= 57% -> +9 pts
                if (getCatShare('premium') >= 57) scorePosicionamento += 9;
                
                // Craft Rule: >= 53% -> +8 pts
                if (getCatShare('craft') >= 53) scorePosicionamento += 8;

                // Mainstream Rule: >= 25% -> +8 pts
                if (getCatShare('mainstream') >= 25) scorePosicionamento += 8;
                
                // Checklist Score
                if (auditoriaData.posicionamentoChecklist) {
                    let checklistScore = 0;
                    const checklistItems = POSICIONAMENTO_CHECKLIST || [];
                    checklistItems.forEach(item => {
                         if (auditoriaData.posicionamentoChecklist[item.id]) {
                             checklistScore += item.points;
                         }
                    });
                    scorePosicionamento += checklistScore;
                }

                // 3. VISIBILIDADE
                let scoreVisibilidade = 0;
                const { totalPes, peCraft, pePremium, peMainstream } = auditoriaData.visibilidade || {};
                
                if (totalPes !== '' && totalPes !== undefined) {
                    const totalPesVal = parseInt(totalPes);

                    // Determine targets based on Total Feet Range
                    let targetCraft = 0;
                    let targetPremium = 0;
                    let targetMainstream = 0;

                    if (totalPesVal <= 5) {
                        targetCraft = 0;
                        targetPremium = 1;
                        targetMainstream = 1;
                    } else if (totalPesVal >= 6 && totalPesVal <= 10) {
                        targetCraft = 1;
                        targetPremium = 2;
                        targetMainstream = 1;
                    } else if (totalPesVal >= 11 && totalPesVal <= 15) {
                        targetCraft = 1;
                        targetPremium = 3;
                        targetMainstream = 2;
                    } else if (totalPesVal >= 16 && totalPesVal <= 20) {
                        targetCraft = 1;
                        targetPremium = 5;
                        targetMainstream = 2;
                    } else if (totalPesVal >= 21) {
                        targetCraft = 1;
                        targetPremium = 6;
                        targetMainstream = 3;
                    }

                    // Calculate Score - Only if input is provided
                    if (peCraft !== '' && parseInt(peCraft) >= targetCraft) scoreVisibilidade += 6; // Craft (6 pts)
                    if (pePremium !== '' && parseInt(pePremium) >= targetPremium) scoreVisibilidade += 8; // Premium (8 pts)
                    if (peMainstream !== '' && parseInt(peMainstream) >= targetMainstream) scoreVisibilidade += 6; // Mainstream (6 pts)
                }

                // 4. PRECIFICAÇÃO
                const scorePrecificacao = auditoriaData.precificacao ? 5 : 0;

                return {
                    presenca: scorePresenca,
                    posicionamento: scorePosicionamento,
                    visibilidade: scoreVisibilidade,
                    precificacao: scorePrecificacao,
                    total: scorePresenca + scorePosicionamento + scoreVisibilidade + scorePrecificacao
                };
            };



            const handleDownloadPDF = async () => {
                if (!window.html2canvas || !window.jspdf) {
                    alert("As ferramentas de captura ainda estão carregando. Tente novamente em alguns segundos.");
                    return;
                }
                
                setIsCapturing(true);
                try {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    // Capture Page 1
                    const canvas1 = await window.html2canvas(reportPage1Ref.current, {
                        scale: 3, 
                        backgroundColor: "#ffffff",
                        logging: false,
                        useCORS: true
                    });

                    // Capture Page 2
                    const canvas2 = await window.html2canvas(reportPage2Ref.current, {
                        scale: 3, 
                        backgroundColor: "#ffffff",
                        logging: false,
                        useCORS: true
                    });
                    
                    const imgData1 = canvas1.toDataURL('image/jpeg', 0.95);
                    const imgData2 = canvas2.toDataURL('image/jpeg', 0.95);

                    const pdf = new window.jspdf.jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4',
                        compress: true
                    });

                    // Page 1
                    const imgProps1 = pdf.getImageProperties(imgData1);
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    const ratio1 = Math.min(pdfWidth / imgProps1.width, pdfHeight / imgProps1.height);
                    const imgWidth1 = imgProps1.width * ratio1;
                    const imgHeight1 = imgProps1.height * ratio1;
                    const imgX1 = (pdfWidth - imgWidth1) / 2;
                    pdf.addImage(imgData1, 'JPEG', imgX1, 0, imgWidth1, imgHeight1);

                    // Page 2
                    pdf.addPage();
                    const imgProps2 = pdf.getImageProperties(imgData2);
                    const ratio2 = Math.min(pdfWidth / imgProps2.width, pdfHeight / imgProps2.height);
                    const imgWidth2 = imgProps2.width * ratio2;
                    const imgHeight2 = imgProps2.height * ratio2;
                    const imgX2 = (pdfWidth - imgWidth2) / 2;
                    pdf.addImage(imgData2, 'JPEG', imgX2, 0, imgWidth2, imgHeight2);
                    
                    const dateStr = new Date().toLocaleDateString('pt-BR').replace(/\//g, '-');
                    pdf.save(`RELATORIO_SOVI_HEINEKEN_${dateStr}.pdf`);
                } catch (err) {
                    console.error(err);
                    alert("Erro ao gerar PDF. Tente novamente.");
                } finally {
                    setIsCapturing(false);
                }
            };

            const handleDownloadRupturasReport = async () => {
                await generatePDF(rupturasReportRef, `RELATORIO_RUPTURAS_HEINEKEN`);
            };

            const handleDownloadValidityReport = async () => {
                await generatePDF(validityReportRef, `RELATORIO_VALIDADE_HEINEKEN`);
            };

            const handleDownloadPriceRulerReport = async () => {
                await generatePDF(priceRulerReportRef, `RELATORIO_REGUA_PRECO_HEINEKEN`);
            };

            const handleDownloadRupturasPNG = async () => {
                await generatePNG(rupturasReportRef, `RELATORIO_RUPTURAS_HEINEKEN`);
            };

            const handleDownloadValidityPNG = async () => {
                await generatePNG(validityReportRef, `RELATORIO_VALIDADE_HEINEKEN`);
            };

            const handleDownloadPriceRulerPNG = async () => {
                await generatePNG(priceRulerReportRef, `RELATORIO_REGUA_PRECO_HEINEKEN`);
            };

            const generatePNG = async (ref, filenamePrefix) => {
                if (!window.html2canvas) {
                    alert("As ferramentas de captura ainda estão carregando. Tente novamente em alguns segundos.");
                    return;
                }
                
                setIsCapturing(true);
                try {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    const canvas = await window.html2canvas(ref.current, {
                        scale: 3,
                        backgroundColor: "#ffffff",
                        logging: false,
                        useCORS: true
                    });
                    
                    const dateStr = new Date().toLocaleDateString('pt-BR').replace(/\//g, '-');
                    const link = document.createElement('a');
                    link.download = `${filenamePrefix}_${dateStr}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                } catch (err) {
                    console.error(err);
                    alert("Erro ao gerar imagem. Tente novamente.");
                } finally {
                    setIsCapturing(false);
                }
            };

            const generatePDF = async (ref, filenamePrefix) => {
                if (!window.html2canvas || !window.jspdf) {
                    alert("As ferramentas de captura ainda estão carregando. Tente novamente em alguns segundos.");
                    return;
                }
                
                setIsCapturing(true);
                try {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    const canvas = await window.html2canvas(ref.current, {
                        scale: 3,
                        backgroundColor: "#ffffff",
                        logging: false,
                        useCORS: true
                    });
                    
                    const imgData = canvas.toDataURL('image/jpeg', 0.98);
                    
                    const pdf = new window.jspdf.jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4',
                        compress: true
                    });

                    const imgProps = pdf.getImageProperties(imgData);
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    
                    const imgWidth = imgProps.width;
                    const imgHeight = imgProps.height;
                    
                    const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                    
                    const imgX = (pdfWidth - imgWidth * ratio) / 2;
                    const imgY = 0;

                    pdf.addImage(imgData, 'JPEG', imgX, imgY, imgWidth * ratio, imgHeight * ratio);
                    
                    const dateStr = new Date().toLocaleDateString('pt-BR').replace(/\//g, '-');
                    pdf.save(`${filenamePrefix}_${dateStr}.pdf`);
                } catch (err) {
                    console.error(err);
                    alert("Erro ao gerar PDF. Tente novamente.");
                } finally {
                    setIsCapturing(false);
                }
            };

            const handleDownloadPNG = async () => {
                if (!window.html2canvas) {
                    alert("As ferramentas de captura ainda estão carregando. Tente novamente em alguns segundos.");
                    return;
                }
                
                setIsCapturing(true);
                try {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    const canvas = await window.html2canvas(reportRef.current, {
                        scale: 3,
                        backgroundColor: "#ffffff",
                        logging: false,
                        useCORS: true
                    });
                    
                    const dateStr = new Date().toLocaleDateString('pt-BR').replace(/\//g, '-');
                    const link = document.createElement('a');
                    link.download = `RELATORIO_SOVI_HEINEKEN_${dateStr}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                } catch (err) {
                    console.error(err);
                    alert("Erro ao gerar imagem. Tente novamente.");
                } finally {
                    setIsCapturing(false);
                }
            };




            const auditoriaScore = calculateAuditoriaScore();
            
            const activePriceRulerData = storeType === 'cc' ? PRICE_RULER_DATA_CC : PRICE_RULER_DATA_VAREJO;

            const handleCopyRupturasList = async () => {
                const rupturas = [];
                const baixoVolume = [];
                
                VALIDITY_DATA_LIST.forEach(item => {
                    const key = `${item.brand} ${item.sku}`;
                    const status = rupturasData[key];

                    if (status === 'ruptura') {
                        rupturas.push(item);
                    } else if (status === 'baixo_volume') {
                        baixoVolume.push(item);
                    }
                });

                if (rupturas.length === 0 && baixoVolume.length === 0) {
                    alert("Nenhuma item marcado como ruptura ou baixo volume.");
                    return;
                }

                // Calculate Total Lost Points
                let totalLostPoints = 0;
                const processedGroups = new Set();

                // Check all items marked as 'ruptura' to find affected groups
                rupturas.forEach(item => {
                    const key = `${item.brand} ${item.sku}`;
                    const scoreGroup = getScoreGroup(key);

                    if (scoreGroup && !processedGroups.has(scoreGroup)) {
                        // Check if ALL items in this group are missing (ruptura or n_cadastrado)
                        const groupSkus = VALIDITY_DATA_LIST.filter(i => getScoreGroup(`${i.brand} ${i.sku}`) === scoreGroup);
                        
                        // Check if there is ANY available item in the group (not rupture AND not n_cadastrado)
                        const anyAvailable = groupSkus.some(i => {
                            const p = `${i.brand} ${i.sku}`;
                            const s = rupturasData[p];
                            return s !== 'ruptura' && s !== 'n_cadastrado';
                        });
                        
                        // If NO item is available, the points are lost
                        if (!anyAvailable) {
                            const groupScores = SCORES_PRESENCA[scoreGroup];
                            if (groupScores) {
                                const scores = groupScores[storeType] || { gondola: 0, gelada: 0 };
                                totalLostPoints += (scores.gondola + scores.gelada);
                            }
                            processedGroups.add(scoreGroup);
                        }
                    }
                });

                const groupByBrand = (items) => {
                    return items.reduce((acc, item) => {
                        let brandGroup = item.brand.split(' ')[0];
                        if (item.brand.includes('AMSTEL')) brandGroup = 'Amstel';
                        if (item.brand.includes('HEINEKEN')) brandGroup = 'Heineken';
                        if (item.brand.includes('EISENBAHN')) brandGroup = 'Eisenbahn';
                        if (item.brand.includes('BADEN')) brandGroup = 'Baden Baden';
                        if (item.brand.includes('SOL')) brandGroup = 'Sol';
                        if (item.brand.includes('LAGUNITAS')) brandGroup = 'Lagunitas';
                        if (item.brand.includes('BLUE MOON')) brandGroup = 'Blue Moon';
                        if (item.brand.includes('DEVASSA')) brandGroup = 'Devassa';
                        if (item.brand.includes('TIGER')) brandGroup = 'Tiger';
                        if (item.brand.includes('SCHIN')) brandGroup = 'Schin';
                        if (item.brand.includes('KAISER')) brandGroup = 'Kaiser';
                        if (item.brand.includes('BAVARIA')) brandGroup = 'Bavaria';
                        if (item.brand.includes('GLACIAL')) brandGroup = 'Glacial';
                        if (item.brand.includes('ITUBAINA')) brandGroup = 'Itubaina';
                        if (item.brand.includes('SKINKA')) brandGroup = 'Skinka';
                        if (item.brand.includes('CLASHD')) brandGroup = "Clash'd";
                        if (item.brand.includes('FYS')) brandGroup = 'Fys';

                        if (!acc[brandGroup]) acc[brandGroup] = [];
                        acc[brandGroup].push(item);
                        return acc;
                    }, {});
                };

                const groupedRupturas = groupByBrand(rupturas);
                const groupedBaixoVolume = groupByBrand(baixoVolume);

                let text = '';

                // --- SEÇÃO RUPTURAS ---
                if (rupturas.length > 0) {
                    text += `🔴 Itens em Ruptura ${storeName || ''} (${rupturas.length} itens)\n`;
                    text += `Produtos faltando (Ruptura).\n`;
                    
                    if (totalLostPoints > 0) {
                        text += `Pontos perdidos por ausência de item obrigatório: ${totalLostPoints} pts\n`;
                    }
                    text += '\n'; // Extra spacing

                    Object.keys(groupedRupturas).forEach(brand => {
                        text += `${brand}\n`;
                        groupedRupturas[brand].forEach(item => {
                            let displayName = `${item.brand} ${item.sku}`;
                            const brandUpper = brand.toUpperCase();
                            displayName = displayName.replace(brandUpper, '').trim();
                            if (!displayName) displayName = item.sku;
                            displayName = displayName.replace(/\s+/g, ' ');

                            text += ` · ${displayName}\n`;
                        });
                    });
                     text += '\n';
                }

                // --- SEÇÃO BAIXO VOLUME ---
                if (baixoVolume.length > 0) {
                    text += `🟡 Baixo Volume (${baixoVolume.length} itens)\n`;
                    text += `Produtos com estoque crítico.\n`;

                    Object.keys(groupedBaixoVolume).forEach(brand => {
                        text += `${brand}\n`;
                        groupedBaixoVolume[brand].forEach(item => {
                            let displayName = `${item.brand} ${item.sku}`;
                            const brandUpper = brand.toUpperCase();
                            displayName = displayName.replace(brandUpper, '').trim();
                            if (!displayName) displayName = item.sku;
                            displayName = displayName.replace(/\s+/g, ' ');

                            text += ` · ${displayName}\n`;
                        });
                    });
                }

                try {
                    await navigator.clipboard.writeText(text);
                    alert("Lista copiada com sucesso!");
                } catch (err) {
                    console.error('Failed to copy: ', err);
                    alert("Erro ao copiar.");
                }
            };

            const handleCopyValidityList = async () => {
                const criticos = []; // Red: < 30 days
                const atencao = [];  // Orange: 30-45 days

                VALIDITY_DATA_LIST.forEach(item => {
                    const key = `${item.brand} - ${item.sku}`;
                    const productData = validityData[key] || {};
                    const expirationDate = productData.date;
                    const quantity = productData.quantity || '0';
                    
                    if (expirationDate) {
                        const daysRemaining = Math.ceil((new Date(expirationDate) - new Date()) / (1000 * 60 * 60 * 24));
                        
                        const itemWithDate = { ...item, daysRemaining, expirationDate, quantity };

                        if (daysRemaining < 30) {
                            criticos.push(itemWithDate);
                        } else if (daysRemaining <= 45) {
                            atencao.push(itemWithDate);
                        }
                    }
                });

                if (criticos.length === 0 && atencao.length === 0) {
                    alert("Nenhum item com validade crítica (< 30 dias) ou próxima (30-45 dias).");
                    return;
                }

                const groupByBrand = (items) => {
                    return items.reduce((acc, item) => {
                        let brandGroup = item.brand.split(' ')[0];
                        if (item.brand.includes('AMSTEL')) brandGroup = 'Amstel';
                        if (item.brand.includes('HEINEKEN')) brandGroup = 'Heineken';
                        if (item.brand.includes('EISENBAHN')) brandGroup = 'Eisenbahn';
                        if (item.brand.includes('BADEN')) brandGroup = 'Baden Baden';
                        if (item.brand.includes('SOL')) brandGroup = 'Sol';
                        if (item.brand.includes('LAGUNITAS')) brandGroup = 'Lagunitas';
                        if (item.brand.includes('BLUE MOON')) brandGroup = 'Blue Moon';
                        if (item.brand.includes('DEVASSA')) brandGroup = 'Devassa';
                        if (item.brand.includes('TIGER')) brandGroup = 'Tiger';
                        if (item.brand.includes('SCHIN')) brandGroup = 'Schin';
                        if (item.brand.includes('KAISER')) brandGroup = 'Kaiser';
                        if (item.brand.includes('BAVARIA')) brandGroup = 'Bavaria';
                        if (item.brand.includes('GLACIAL')) brandGroup = 'Glacial';
                        if (item.brand.includes('ITUBAINA')) brandGroup = 'Itubaina';
                        if (item.brand.includes('SKINKA')) brandGroup = 'Skinka';
                        if (item.brand.includes('CLASHD')) brandGroup = "Clash'd";
                        if (item.brand.includes('FYS')) brandGroup = 'Fys';

                        if (!acc[brandGroup]) acc[brandGroup] = [];
                        acc[brandGroup].push(item);
                        return acc;
                    }, {});
                };

                const groupedCriticos = groupByBrand(criticos);
                const groupedAtencao = groupByBrand(atencao);

                let text = `⚠️ Controle de Validade ${storeName || ''}\n\n`;

                if (criticos.length > 0) {
                    text += `🔴 Vencimento Crítico (< 30 dias) (${criticos.length} itens)\n`;
                    Object.keys(groupedCriticos).forEach(brand => {
                        text += `${brand}\n`;
                        groupedCriticos[brand].forEach(item => {
                            let displayName = `${item.brand} ${item.sku}`;
                            const brandUpper = brand.toUpperCase();
                            displayName = displayName.replace(brandUpper, '').trim();
                            if (!displayName) displayName = item.sku;
                            displayName = displayName.replace(/\s+/g, ' ');
                            
                            const dateStr = new Date(item.expirationDate).toLocaleDateString('pt-BR');
                            text += ` · ${displayName} (Qtd: ${item.quantity} UN.) - Venc: ${dateStr} (${item.daysRemaining} dias)\n`;
                        });
                    });
                    text += '\n';
                }

                if (atencao.length > 0) {
                    text += `🟡 Validade Próxima (30-45 dias) (${atencao.length} itens)\n`;
                    Object.keys(groupedAtencao).forEach(brand => {
                        text += `${brand}\n`;
                        groupedAtencao[brand].forEach(item => {
                            let displayName = `${item.brand} ${item.sku}`;
                            const brandUpper = brand.toUpperCase();
                            displayName = displayName.replace(brandUpper, '').trim();
                            if (!displayName) displayName = item.sku;
                            displayName = displayName.replace(/\s+/g, ' ');

                            const dateStr = new Date(item.expirationDate).toLocaleDateString('pt-BR');
                            text += ` · ${displayName} (Qtd: ${item.quantity} UN.) - Venc: ${dateStr} (${item.daysRemaining} dias)\n`;
                        });
                    });
                }

                try {
                    await navigator.clipboard.writeText(text);
                    alert("Lista de validade copiada com sucesso!");
                } catch (err) {
                    console.error('Failed to copy: ', err);
                    alert("Erro ao copiar.");
                }
            };

            const handleCopyPriceRulerList = async () => {
                const discrepancies = [];
                
                activePriceRulerData.forEach(item => {
                    const key = `${item.brand} - ${item.sku}`;
                    const entry = priceRulerData[key] || {};
                    const priceStore = entry.price;
                    const pricePromo = entry.promo;

                    if (!priceStore && !pricePromo) return;

                    let hasDiscrepancy = false;
                    let discrepancyType = [];

                    if (priceStore && parseFloat(priceStore) !== item.price) {
                        hasDiscrepancy = true;
                        discrepancyType.push('Reg');
                    }
                    if (pricePromo && parseFloat(pricePromo) !== item.promo) {
                        hasDiscrepancy = true;
                        discrepancyType.push('Promo');
                    }

                    if (hasDiscrepancy) {
                        discrepancies.push({
                            ...item,
                            priceStore,
                            pricePromo,
                            discrepancyType
                        });
                    }
                });

                if (discrepancies.length === 0) {
                    alert("Nenhuma divergência encontrada para copiar.");
                    return;
                }

                const grouped = discrepancies.reduce((acc, item) => {
                    let brandGroup = item.brand.split(' ')[0];
                    if (item.brand.includes('AMSTEL')) brandGroup = 'Amstel';
                    if (item.brand.includes('HEINEKEN')) brandGroup = 'Heineken';
                    if (item.brand.includes('EISENBAHN')) brandGroup = 'Eisenbahn';
                    if (item.brand.includes('BADEN')) brandGroup = 'Baden Baden';
                    if (item.brand.includes('SOL')) brandGroup = 'Sol';
                    if (item.brand.includes('LAGUNITAS')) brandGroup = 'Lagunitas';
                    if (item.brand.includes('BLUE MOON')) brandGroup = 'Blue Moon';
                    if (item.brand.includes('DEVASSA')) brandGroup = 'Devassa';
                    if (item.brand.includes('TIGER')) brandGroup = 'Tiger';
                    if (item.brand.includes('SCHIN')) brandGroup = 'Schin';
                    if (item.brand.includes('KAISER')) brandGroup = 'Kaiser';
                    if (item.brand.includes('BAVARIA')) brandGroup = 'Bavaria';
                    if (item.brand.includes('GLACIAL')) brandGroup = 'Glacial';
                    if (item.brand.includes('ITUBAINA')) brandGroup = 'Itubaina';
                    if (item.brand.includes('SKINKA')) brandGroup = 'Skinka';
                    if (item.brand.includes('CLASHD')) brandGroup = "Clash'd";
                    if (item.brand.includes('FYS')) brandGroup = 'Fys';

                    if (!acc[brandGroup]) acc[brandGroup] = [];
                    acc[brandGroup].push(item);
                    return acc;
                }, {});

                let text = `⚠️ Loja: ${storeName || 'Loja sem nome'}\n\n$ Itens Fora da Régua (Divergência de Preço)\nComparativo entre o preço sugerido (Régua) e o preço praticado na loja.\n\n`;

                Object.keys(grouped).forEach(brand => {
                    text += `${brand}\n`;
                    grouped[brand].forEach(item => {
                        let displayName = `${item.brand} ${item.sku}`;
                        const brandUpper = brand.toUpperCase();
                        displayName = displayName.replace(brandUpper, '').trim();
                        if (!displayName) displayName = item.sku;
                        displayName = displayName.replace(/\s+/g, ' ');

                        const formatPrice = (p) => p ? `R$ ${parseFloat(p).toFixed(2).replace('.', ',')}` : '-';

                        if (item.discrepancyType.includes('Reg')) {
                            // · [SKU]: Preço Loja R$ [Value] (Régua R$ [Value]) — Status: Fora da Régua
                            text += `· ${displayName}: Preço Loja ${formatPrice(item.priceStore)} (Régua ${formatPrice(item.price)}) — Status: Fora da Régua\n`;
                        }
                        if (item.discrepancyType.includes('Promo')) {
                            // · [SKU]: Preço Loja Promo R$ [Value] (Régua Promo R$ [Value]) — Status: Fora da Régua (Promo)
                            text += `· ${displayName}: Preço Loja Promo ${formatPrice(item.pricePromo)} (Régua Promo ${formatPrice(item.promo)}) — Status: Fora da Régua (Promo)\n`;
                        }
                    });
                    text += '\n'; 
                });

                try {
                    await navigator.clipboard.writeText(text);
                    alert("Lista de divergências copiada para a área de transferência!");
                } catch (err) {
                    console.error('Failed to copy: ', err);
                    alert("Erro ao copiar. Permissão negada?");
                }
            };

            const handleCopySimulatorList = async () => {
                const calculatorName = activePosicionamentoTab === 'ri' ? 'Calculadora RI' : 'Calculadora Manual';
                if (!window.confirm(`Você está prestes a copiar o resumo usando a ${calculatorName}. Deseja continuar?`)) {
                    return;
                }

                const dataSource = activePosicionamentoTab === 'ri' ? riData : allData;

                const getCatShare = (catKey) => {
                    const catData = dataSource[catKey];
                    if (!catData) return 0;
                    const worldCm = parseFloat(catData.world) || 0;
                    const config = CATEGORIES[catKey];

                    if (!config) return 0;
                    
                    let catTotalHnk = 0;
                    
                    if (activePosicionamentoTab === 'ri') {
                         // RI Mode: Sum from SKUs via Brand Mapping
                        if (config.products) {
                            config.products.forEach(brand => {
                                const skus = RI_SKU_MAPPING[brand] || [];
                                skus.forEach(sku => {
                                    catTotalHnk += (parseFloat((catData.skus || {})[sku]) || 0);
                                });
                            });
                        }
                    } else {
                        // Manual Mode: Direct Products Sum
                        if (config.products && catData.products) {
                            config.products.forEach(prod => {
                                catTotalHnk += (parseFloat(catData.products[prod]) || 0);
                            });
                        }
                    }

                    return worldCm > 0 ? (catTotalHnk / worldCm) * 100 : 0;
                };

                const sharePremium = getCatShare('premium');
                const shareCraft = getCatShare('craft');
                const shareMainstream = getCatShare('mainstream');

                let checklistScore = 0;
                if (auditoriaData.posicionamentoChecklist) {
                    POSICIONAMENTO_CHECKLIST.forEach(item => {
                        if (auditoriaData.posicionamentoChecklist[item.id]) checklistScore += item.points;
                    });
                }

                // Header
                let text = `📊 Simulador FDS - ${storeName || 'Loja'} ${activePosicionamentoTab === 'ri' ? '(Calculadora RI)' : '(Calculadora Manual)'}\n`;
                text += `👤 Colaborador: ${fds || '-'}\n`;
                text += `🏪 Tipo: ${storeType ? storeType.toUpperCase() : '-'}\n\n`;

                // Placar
                const parts = auditoriaScore || { presenca: 0, posicionamento: 0, visibilidade: 0, precificacao: 0, total: 0 };
                text += `⭐ Placar Geral: ${parts.total}/100\n`;
                text += `(Presença: ${parts.presenca}, Posic: ${parts.posicionamento}, Promo: ${parts.visibilidade}, Preço: ${parts.precificacao})\n\n`;

                // Presença
                text += `✅ Presença\n`;
                if (auditoriaData.presenca) {
                    Object.entries(SCORES_PRESENCA).forEach(([product, scores]) => {
                        const productState = auditoriaData.presenca[product] || { gondola: false, gelada: false };
                        const currentScores = scores[storeType] || { gondola: 0, gelada: 0 };
                        
                        if (productState.gondola || productState.gelada) {
                            let line = `· ${product}: `;
                            const p = [];
                            if (productState.gondola) p.push(`Gôndola (+${currentScores.gondola})`);
                            if (productState.gelada) p.push(`Gelada (+${currentScores.gelada})`);
                            line += p.join(' / ') + '\n';
                            text += line;
                        }
                    });
                }
                text += `\n`;

                // Posicionamento
                text += `📏 Posicionamento\n`;
                // Recalculate points for display reference (or use logic if simple)
                // We know the rules: Premium>=57 -> 9, Craft>=53 -> 8, Mainstream>=25 -> 8
                const ptsPremium = sharePremium >= 57 ? 9 : 0;
                const ptsCraft = shareCraft >= 53 ? 8 : 0;
                const ptsMainstream = shareMainstream >= 25 ? 8 : 0;



                text += `· Premium: ${ptsPremium} pontos ${ptsPremium > 0 ? 'por bater a meta' : 'meta não atingida'} (Share: ${sharePremium.toFixed(1)}% / Meta 57%)\n`;
                // List filled items for Premium
                // List filled items for Premium
                if (activePosicionamentoTab === 'ri') {
                     CATEGORIES['premium'].products.forEach(brand => {
                        let brandHasValue = false;
                        const skus = RI_SKU_MAPPING[brand] || [];
                        const skuDetails = [];

                        skus.forEach(sku => {
                             const val = parseFloat((dataSource['premium']?.skus || {})[sku]) || 0;
                             if (val > 0) {
                                 brandHasValue = true;
                                 const worldCm = parseFloat(dataSource['premium'].world) || 1;
                                 const share = ((val / worldCm) * 100).toFixed(1);
                                 skuDetails.push(`   - ${sku}: ${val}cm (${share}%)`);
                             }
                        });
                        
                        if (brandHasValue) {
                            text += `  - ${brand}:\n`;
                            skuDetails.forEach(detail => text += `${detail}\n`);
                        }
                    });
                } else if (dataSource['premium'] && dataSource['premium'].products) {
                    CATEGORIES['premium'].products.forEach(prod => {
                        const val = parseFloat(dataSource['premium'].products[prod]);
                        if (val > 0) {
                            const worldCm = parseFloat(dataSource['premium'].world) || 1;
                            const share = ((val / worldCm) * 100).toFixed(1);
                            text += `  - ${prod}: ${val}cm (${share}%)\n`;
                        }
                    });
                }

                text += `· Craft: ${ptsCraft} pontos ${ptsCraft > 0 ? 'por bater a meta' : 'meta não atingida'} (Share: ${shareCraft.toFixed(1)}% / Meta 53%)\n`;
                // List filled items for Craft
                if (activePosicionamentoTab === 'ri') {
                     CATEGORIES['craft'].products.forEach(brand => {
                        let brandHasValue = false;
                        const skus = RI_SKU_MAPPING[brand] || [];
                        const skuDetails = [];

                        skus.forEach(sku => {
                             const val = parseFloat((dataSource['craft']?.skus || {})[sku]) || 0;
                             if (val > 0) {
                                 brandHasValue = true;
                                 const worldCm = parseFloat(dataSource['craft'].world) || 1;
                                 const share = ((val / worldCm) * 100).toFixed(1);
                                 skuDetails.push(`   - ${sku}: ${val}cm (${share}%)`);
                             }
                        });
                        
                        if (brandHasValue) {
                            text += `  - ${brand}:\n`;
                            skuDetails.forEach(detail => text += `${detail}\n`);
                        }
                    });
                } else if (dataSource['craft'] && dataSource['craft'].products) {
                    CATEGORIES['craft'].products.forEach(prod => {
                        const val = parseFloat(dataSource['craft'].products[prod]);
                        if (val > 0) {
                            const worldCm = parseFloat(dataSource['craft'].world) || 1;
                            const share = ((val / worldCm) * 100).toFixed(1);
                            text += `  - ${prod}: ${val}cm (${share}%)\n`;
                        }
                    });
                }

                text += `· Mainstream: ${ptsMainstream} pontos ${ptsMainstream > 0 ? 'por bater a meta' : 'meta não atingida'} (Share: ${shareMainstream.toFixed(1)}% / Meta 25%)\n`;
                // List filled items for Mainstream
                if (activePosicionamentoTab === 'ri') {
                     CATEGORIES['mainstream'].products.forEach(brand => {
                        let brandHasValue = false;
                        const skus = RI_SKU_MAPPING[brand] || [];
                        const skuDetails = [];

                        skus.forEach(sku => {
                             const val = parseFloat((dataSource['mainstream']?.skus || {})[sku]) || 0;
                             if (val > 0) {
                                 brandHasValue = true;
                                 const worldCm = parseFloat(dataSource['mainstream'].world) || 1;
                                 const share = ((val / worldCm) * 100).toFixed(1);
                                 skuDetails.push(`   - ${sku}: ${val}cm (${share}%)`);
                             }
                        });
                        
                        if (brandHasValue) {
                            text += `  - ${brand}:\n`;
                            skuDetails.forEach(detail => text += `${detail}\n`);
                        }
                    });
                } else if (dataSource['mainstream'] && dataSource['mainstream'].products) {
                    CATEGORIES['mainstream'].products.forEach(prod => {
                        const val = parseFloat(dataSource['mainstream'].products[prod]);
                        if (val > 0) {
                            const worldCm = parseFloat(dataSource['mainstream'].world) || 1;
                            const share = ((val / worldCm) * 100).toFixed(1);
                            text += `  - ${prod}: ${val}cm (${share}%)\n`;
                        }
                    });
                }
                const finalShare = activePosicionamentoTab === 'ri' ? riGlobalData.share : globalData.share;
                text += `\n🍺 Share Total Cerveja: ${finalShare}%\n`;
                text += `· Checklist: ${checklistScore} pts\n\n`;

                // Visibilidade
                text += `👁️ Visibilidade\n`;
                const visData = auditoriaData.visibilidade || {};
                const totalPes = parseInt(visData.totalPes) || 0;
                // Determine targets (logic duplicated for display context)
                let tPremium=0, tCraft=0, tMainstream=0;
                if(totalPes<=5){ tPremium=1; tMainstream=1; }
                else if(totalPes<=10){ tCraft=1; tPremium=2; tMainstream=1; }
                else if(totalPes<=15){ tCraft=1; tPremium=3; tMainstream=2; }
                else if(totalPes<=20){ tCraft=1; tPremium=5; tMainstream=2; }
                else { tCraft=1; tPremium=6; tMainstream=3; }

                const peCraft = parseInt(visData.peCraft) || 0;
                const pePrem = parseInt(visData.pePremium) || 0;
                const peMain = parseInt(visData.peMainstream) || 0;

                text += `· Total Pés: ${totalPes}\n`;
                text += `· Craft: ${peCraft >= tCraft && tCraft > 0 ? 6 : 0} pts (${peCraft} PE / Meta ${tCraft})\n`;
                text += `· Premium: ${pePrem >= tPremium && tPremium > 0 ? 8 : 0} pts (${pePrem} PE / Meta ${tPremium})\n`;
                text += `· Mainstream: ${peMain >= tMainstream && tMainstream > 0 ? 6 : 0} pts (${peMain} PE / Meta ${tMainstream})\n\n`;

                // Precificação
                text += `💲 Precificação\n`;
                text += `· ${auditoriaData.precificacao ? 'Correta (+5 pts)' : 'Incorreta (0 pts)'}`;

                try {
                    await navigator.clipboard.writeText(text);
                    alert("Resumo copiado com sucesso!");
                } catch (err) {
                    console.error('Failed to copy: ', err);
                    alert("Erro ao copiar.");
                }
            };

            if (!isRegistered) {
                return (
                    <RegistrationView 
                        storeName={storeName} 
                        setStoreName={setStoreName}
                        fds={fds} 
                        setFds={setFds}
                        storeType={storeType} 
                        setStoreType={setStoreType}
                        onComplete={(e) => {
                            if (e) e.preventDefault();
                            setIsRegistered(true);
                        }}
                        onInstall={handleInstallClick}
                    />
                );
            }

            return (
                <div className="max-w-md mx-auto bg-gray-50 min-h-screen shadow-2xl relative pb-20 font-sans text-gray-800">
                    <header className="sticky top-0 w-full bg-[#008200]/95 backdrop-blur-md text-white px-4 py-3 shadow-lg z-50">
                        <div className="flex justify-between items-center max-w-md mx-auto">
                            <div className="flex items-center gap-2">
                                <div className="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center shadow-inner">
                                    <Star className="fill-current text-white" size={16} />
                                </div>
                            </div>
                            
                            {/* Mode Toggle Button */}
                            <button
                                onClick={() => {
                                    const newMode = activePosicionamentoTab === 'share' ? 'ri' : 'share';
                                    setActivePosicionamentoTab(newMode);
                                    if (activeAuditoriaTab !== 'posicionamento') {
                                        setActiveAuditoriaTab('posicionamento');
                                    }
                                }}
                                className={`
                                    px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider shadow-lg transform transition-all duration-300 active:scale-95
                                    ${activePosicionamentoTab === 'share' 
                                        ? 'bg-white text-[#008200] ring-2 ring-[#006000]/20' 
                                        : 'bg-blue-600 text-white ring-2 ring-blue-400/50'
                                    }
                                `}
                            >
                                {activePosicionamentoTab === 'share' ? 'Manual' : 'RI'}
                            </button>
                            
                            <div className="flex bg-black/20 rounded-full p-1 backdrop-blur-sm border border-white/10 shadow-inner">
                                <button 
                                    onClick={() => setIsRegistered(false)} 
                                    className="p-2 text-white/90 hover:text-white hover:bg-white/10 rounded-full transition-all active:scale-95" 
                                    title="Sair / Alterar Loja"
                                >
                                    <LogOut size={16} />
                                </button>
                                <div className="w-px bg-white/20 mx-0.5 my-1.5"></div>
                                <button 
                                    onClick={() => setShowCreditsModal(true)} 
                                    className="p-2 text-white/90 hover:text-white hover:bg-white/10 rounded-full transition-all active:scale-95" 
                                    title="Sobre"
                                >
                                    <Info size={16} />
                                </button>
                                <div className="w-px bg-white/20 mx-0.5 my-1.5"></div>
                                <button 
                                    onClick={handleReset} 
                                    className="p-2 text-white/90 hover:text-white hover:bg-white/10 rounded-full transition-all active:scale-95" 
                                    title="Reiniciar"
                                >
                                    <RefreshCw size={16} />
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Credits Modal */}
                    {showCreditsModal && (
                        <div className="fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in duration-200">
                            <div className="bg-white rounded-2xl shadow-2xl max-w-sm w-full overflow-hidden transform transition-all scale-100">
                                <div className="bg-[#008200] p-6 text-center relative">
                                    <button 
                                        onClick={() => setShowCreditsModal(false)}
                                        className="absolute top-4 right-4 text-white/70 hover:text-white"
                                    >
                                        <IconBase width={24} height={24}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></IconBase>
                                    </button>
                                    <div className="w-16 h-16 bg-white rounded-full mx-auto flex items-center justify-center mb-3 shadow-lg">
                                        <Star className="text-[#008200] fill-current" size={32} />
                                    </div>
                                    <h2 className="text-2xl font-black text-white tracking-tight">SIMULADOR FDS</h2>
                                    <p className="text-green-100 text-sm font-medium">Versão 2.0</p>
                                </div>
                                <div className="p-6 text-center">
                                    <p className="text-gray-500 text-xs uppercase tracking-widest font-bold mb-4">Desenvolvido com ❤️ por</p>
                                    
                                    <div className="space-y-3">
                                        <div className="bg-gray-50 p-3 rounded-xl border border-gray-100">
                                            <p className="font-bold text-gray-800 text-lg">Pedro Lameirão</p>
                                            <p className="text-xs text-gray-400">Promotor de Trade</p>
                                        </div>
                                    </div>

                                    <div className="mt-6 pt-6 border-t border-gray-100">
                                        <p className="text-xs text-gray-400 font-medium">Heineken Brasil • Trade Marketing</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Install/Tutorial Modal */}
                    {showInstallModal && (
                        <div className="fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in duration-200">
                            <div className="bg-white rounded-2xl shadow-2xl max-w-sm w-full overflow-hidden transform transition-all scale-100">
                                <div className="bg-[#008200] p-6 text-center relative">
                                    <button 
                                        onClick={() => setShowInstallModal(false)}
                                        className="absolute top-4 right-4 text-white/70 hover:text-white"
                                    >
                                        <IconBase width={24} height={24}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></IconBase>
                                    </button>
                                    <h2 className="text-2xl font-black text-white tracking-tight">INSTALAR APP</h2>
                                    <p className="text-green-100 text-sm font-medium">Adicione à sua tela inicial</p>
                                </div>
                                
                                <div className="p-6 space-y-6">
                                    {installPlatform === 'ios' ? (
                                        <>
                                            <div className="flex items-start gap-4">
                                                <div className="bg-gray-100 p-2 rounded-lg shrink-0">
                                                    <img src="tutorial_install_1.jpg" className="w-8 h-8 object-contain" alt="Compartilhar" />
                                                </div>
                                                <div>
                                                    <p className="font-bold text-gray-800">1. Toque em Compartilhar</p>
                                                    <p className="text-sm text-gray-500">Na barra inferior do navegador.</p>
                                                </div>
                                            </div>
                                            <div className="flex items-start gap-4">
                                                <div className="bg-gray-100 p-2 rounded-lg shrink-0">
                                                    <img src="tutorial_install_2.jpg" className="w-8 h-8 object-contain" alt="Adicionar" />
                                                </div>
                                                <div>
                                                    <p className="font-bold text-gray-800">2. Adicionar à Tela de Início</p>
                                                    <p className="text-sm text-gray-500">Role para baixo e selecione esta opção.</p>
                                                </div>
                                            </div>
                                        </>
                                    ) : (
                                        <>
                                             <div className="flex items-start gap-4">
                                                <div className="bg-gray-100 p-2 rounded-lg shrink-0 flex items-center justify-center w-12 h-12">
                                                    <IconBase className="text-gray-600"><circle cx="12" cy="5" r="1.5"></circle><circle cx="12" cy="12" r="1.5"></circle><circle cx="12" cy="19" r="1.5"></circle></IconBase>
                                                </div>
                                                <div>
                                                    <p className="font-bold text-gray-800">1. Abra o Menu</p>
                                                    <p className="text-sm text-gray-500">Toque nos três pontinhos do navegador.</p>
                                                </div>
                                            </div>
                                            <div className="flex items-start gap-4">
                                                <div className="bg-gray-100 p-2 rounded-lg shrink-0 flex items-center justify-center w-12 h-12">
                                                    <IconBase className="text-gray-600"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></IconBase>
                                                </div>
                                                <div>
                                                    <p className="font-bold text-gray-800">2. Instalar Aplicativo</p>
                                                    <p className="text-sm text-gray-500">Ou "Adicionar à tela inicial".</p>
                                                </div>
                                            </div>
                                        </>
                                    )}
                                </div>
                                <div className="p-6 pt-0">
                                    <button 
                                        onClick={() => setShowInstallModal(false)}
                                        className="w-full py-3 bg-gray-100 font-bold text-gray-600 rounded-xl hover:bg-gray-200 transition-colors"
                                    >
                                        Entendi
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    <main className="max-w-md mx-auto p-4">
                        {/* Navigation Bar */}
                        {/* Enhanced Navigation Bar */}
                        {/* Enhanced Navigation Bar */}

                        {/* Enhanced Navigation Bar */}
                        <div className="bg-white p-2 rounded-2xl shadow-lg border border-gray-100 mb-6 grid grid-cols-4 gap-2">
                            {[
                                { id: 'simulador', label: 'Simulador', icon: LayoutGrid, color: 'bg-[#008200]', activeColor: 'ring-[#008200]' },
                                { id: 'rupturas', label: 'Rupturas', icon: AlertTriangle, color: 'bg-red-600', activeColor: 'ring-red-600' },
                                { id: 'validade', label: 'Validade', icon: Calendar, color: 'bg-blue-600', activeColor: 'ring-blue-600' },
                                { id: 'regua', label: 'Preço', icon: Tag, color: 'bg-green-600', activeColor: 'ring-green-600' },
                                { id: 'treinamento', label: 'Treinamento', icon: Presentation, color: 'bg-purple-600', activeColor: 'ring-purple-600' }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveView(tab.id)}
                                    className={`
                                        py-3 px-1 rounded-xl text-[10px] font-bold transition-all flex flex-col items-center justify-center gap-2 truncate
                                        ${tab.id === 'simulador' ? 'col-span-4 text-base py-4 px-2' : ''}
                                        ${activeView === tab.id
                                            ? `${tab.color} text-white shadow-lg scale-105 ring-2 ring-offset-2 ${tab.activeColor}`
                                            : 'bg-gray-50 text-gray-500 hover:bg-gray-100 hover:scale-105'}
                                    `}
                                >
                                    <tab.icon size={tab.id === 'simulador' ? 24 : 18} className={activeView === tab.id ? 'animate-bounce' : ''} />
                                    {tab.label}
                                </button>
                            ))}
                        </div>



                        {/* Restored Simulador View */}
                        {activeView === 'simulador' && (
                            <>
                                <AuditoriaScorecard 
                                scores={auditoriaScore} 
                                totalScore={auditoriaScore.total}
                                activeTab={activePosicionamentoTab}
                                onCopyList={handleCopySimulatorList}
                                onDownloadPDF={handleDownloadPDF}
                                isCapturing={isCapturing}
                            />

                                <AuditoriaTabs 
                                    activeTab={activeAuditoriaTab} 
                                    onTabChange={setActiveAuditoriaTab}
                                    presencaData={auditoriaData?.presenca || {}}
                                    onPresencaChange={handleUpdateAuditoriaPresenca}
                                    storeType={storeType}
                                    allData={allData || {}}
                                    riData={riData || {}}
                                    CATEGORIES={CATEGORIES}
                                    activeCategory={activeCategory}
                                    onSelectCategory={setActiveCategory}
                                    onUpdateWorld={handleUpdateWorld}
                                    onUpdateProduct={handleUpdateProduct}
                                    onUpdateRiWorld={handleUpdateRiWorld}
                                    onUpdateRiProduct={handleUpdateRiProduct}
                                    
                                    activePosicionamentoTab={activePosicionamentoTab}
                                    setActivePosicionamentoTab={setActivePosicionamentoTab}

                                    checklistData={auditoriaData?.posicionamentoChecklist || {}}
                                    onChecklistChange={handleUpdateAuditoriaPosicionamentoChecklist}
                                    visibilidadeData={auditoriaData?.visibilidade || {}}
                                    onVisibilidadeChange={handleUpdateAuditoriaVisibilidade}
                                    precificacaoData={auditoriaData?.precificacao || false}
                                    onPrecificacaoChange={handleUpdateAuditoriaPrecificacao}
                                    auditoriaScore={auditoriaScore}
                                    onCopyList={handleCopySimulatorList}
                                    onDownloadPDF={handleDownloadPDF}
                                    isCapturing={isCapturing}
                                />
                            </>
                        )}

                        {activeView === 'rupturas' && (
                            <RupturasView 
                                storeType={storeType}
                                data={rupturasData}
                                onChange={handleRupturasChange}
                                onDownload={handleDownloadRupturasReport}
                                onDownloadPNG={handleDownloadRupturasPNG}
                                onCopyList={handleCopyRupturasList}
                            />
                        )}

                        {activeView === 'validade' && (
                            <ValidadeView 
                                data={validityData}
                                onChange={handleValidityChange}
                                onDownload={handleDownloadValidityReport}
                                onDownloadPNG={handleDownloadValidityPNG}
                                onCopyList={handleCopyValidityList}
                            />
                        )}

                        {activeView === 'regua' && (
                            <PriceRulerView 
                                data={priceRulerData}
                                rulerData={activePriceRulerData}
                                onChange={handlePriceRulerChange}
                                onDownload={handleDownloadPriceRulerReport}
                                onDownloadPNG={handleDownloadPriceRulerPNG}
                                onCopyList={handleCopyPriceRulerList}
                            />
                        )}

                        {activeView === 'treinamento' && (
                            <TreinamentoApp 
                                onNavigateBack={() => setActiveView('simulador')} 
                                deferredPrompt={deferredPrompt}
                                installPlatform={installPlatform}
                                setShowInstallModal={setShowInstallModal}
                            />
                        )}
                        <ScrollToTopButton />
                    </main>

                    {/* Hidden Report for Capture */}
                    <div className="fixed top-0 left-0 -z-50 opacity-0 pointer-events-none">
                        <div ref={rupturasReportRef}>
                            <RupturasReport 
                                data={rupturasData}
                                storeType={storeType}
                                storeName={storeName}
                                fds={fds}
                                date={new Date().toLocaleDateString('pt-BR')}
                                time={new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}
                            />
                        </div>
                        <div ref={validityReportRef}>
                            <ValidadeReport 
                                data={validityData}
                                storeName={storeName}
                                fds={fds}
                                date={new Date().toLocaleDateString('pt-BR')}
                                time={new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}
                            />
                        </div>
                        <div ref={priceRulerReportRef}>
                            <PriceRulerReport 
                                data={priceRulerData}
                                rulerData={activePriceRulerData}
                                storeName={storeName}
                                fds={fds}
                                date={new Date().toLocaleDateString('pt-BR')}
                                time={new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}
                            />
                        </div>
                            <div ref={reportPage1Ref}>
                                <ReportTablePage1 
                                    date={new Date().toLocaleDateString('pt-BR')}
                                    time={new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}
                                    storeName={storeName}
                                    fds={fds}
                                    auditoriaScore={auditoriaScore}
                                    storeType={storeType}
                                    auditoriaData={auditoriaData}
                                    allData={activePosicionamentoTab === 'ri' ? riData : allData} 
                                    globalData={activePosicionamentoTab === 'ri' ? riGlobalData : globalData}
                                    isRiMode={activePosicionamentoTab === 'ri'}
                                />
                            </div>
                        <div ref={reportPage2Ref}>
                             <ReportTablePage2 
                                date={new Date().toLocaleDateString('pt-BR')}
                                time={new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}
                                auditoriaData={auditoriaData}
                            />
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then((registration) => {
              console.log('ServiceWorker registration successful with scope: ', registration.scope);
            })
            .catch((err) => {
              console.log('ServiceWorker registration failed: ', err);
            });
        });
      }
    </script>
</body>
</html>
