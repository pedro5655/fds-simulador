<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador FDS - Heineken Brasil</title>
    <link rel="icon" type="image/png" href="favicon.png">
    
    <!-- Social Media Meta Tags -->
    <meta property="og:image" content="https://pedro5655.github.io/fds-simulador/social-banner.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:title" content="Simulador FDS">
    <meta property="og:description" content="Fotografia de Sucesso - Otimize sua execução no ponto de venda.">
    
    <!-- React e ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para entender JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- html2canvas para gerar a imagem -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- jsPDF para gerar o PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body { -webkit-font-smoothing: antialiased; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ÍCONES SVG ---
        const IconBase = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Star = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </IconBase>
        );
        const RefreshCw = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                <path d="M21 3v5h-5"></path>
                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                <path d="M8 16H3v5"></path>
            </IconBase>
        );
        const ChevronDown = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><polyline points="6 9 12 15 18 9"></polyline></IconBase>
        );
        const ChevronUp = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}><polyline points="18 15 12 9 6 15"></polyline></IconBase>
        );
        const CheckCircle = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </IconBase>
        );
        const AlertCircle = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </IconBase>
        );
        const Globe = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
            </IconBase>
        );
        const TrendingUp = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </IconBase>
        );
        const AlertTriangle = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </IconBase>
        );
        const ImageIcon = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
            </IconBase>
        );
        const ArrowRight = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
            </IconBase>
        );
        const LayoutGrid = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
            </IconBase>
        );
        const Target = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <circle cx="12" cy="12" r="10"></circle>
                <circle cx="12" cy="12" r="6"></circle>
                <circle cx="12" cy="12" r="2"></circle>
            </IconBase>
        );
        const Megaphone = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <path d="m3 11 18-5v12L3 14v-3z"></path>
                <path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"></path>
            </IconBase>
        );
        const Tag = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                <line x1="7" y1="7" x2="7.01" y2="7"></line>
            </IconBase>
        );
        const Store = ({ size = 24, className = "" }) => (
            <IconBase className={className} width={size} height={size}>
                <path d="M3 21h18v-8a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v8z"></path>
                <path d="M21 10l-1.5-6.5a2 2 0 0 0-2-1.5h-11a2 2 0 0 0-2 1.5L3 10"></path>
                <path d="M10 14v4"></path>
                <path d="M14 14v4"></path>
            </IconBase>
        );

        // --- DADOS E LÃ“GICA ---
        const CATEGORIES = {
            premium: {
                title: "Premium",
                target: 57,
                color: "bg-green-100 border-green-200",
                headerColor: "bg-[#008200] text-white",
                products: [
                    "Heineken Original",
                    "Heineken 0.0",
                    "Eisenbahn Pilsen",
                    "Eisenbahn Unfiltered",
                    "Amstel Ultra",
                    "Sol",
                    "Sol 0.0",
                    "Praya Lager"
                ]
            },
            craft: {
                title: "Craft (Artesanais)",
                target: 53,
                color: "bg-amber-50 border-amber-200",
                headerColor: "bg-amber-600 text-white",
                products: [
                    "Eisenbahn (Estilos)",
                    "Baden Baden (Estilos)",
                    "Praya Clássica",
                    "Lagunitas",
                    "Blue Moon"
                ]
            },
            mainstream: {
                title: "Mainstream",
                target: 25,
                color: "bg-blue-50 border-blue-200",
                headerColor: "bg-blue-600 text-white",
                products: [
                    "Amstel",
                    "Devassa",
                    "Tiger"
                ]
            },
            economy: {
                title: "Economy",
                target: null,
                color: "bg-gray-50 border-gray-200",
                headerColor: "bg-gray-500 text-white",
                products: [
                    "Kaiser",
                    "Glacial",
                    "Bavária",
                    "Schin"
                ]
            },
            nab: {
                title: "Nab",
                target: null,
                color: "bg-teal-50 border-teal-200",
                headerColor: "bg-teal-600 text-white",
                products: [
                    "Fys Tônica",
                    "Fys: Sabores",
                    "Clash'd",
                    "Mamba Water",
                    "Baer-Mate",
                    "Baer-Matcha"
                ]
            },
            rtd: {
                title: "RTD",
                target: null,
                color: "bg-purple-50 border-purple-200",
                headerColor: "bg-purple-600 text-white",
                products: [
                    "Amstel Vibes"
                ]
            }
        };
        
        const CategoryTabs = ({ categories, activeCategory, onSelect }) => {
            return (
                <div className="flex overflow-x-auto gap-2 p-1 mb-4 pb-2">
                    {Object.entries(categories).map(([key, config]) => (
                        <button
                            key={key}
                            onClick={() => onSelect(key)}
                            className={`
                                whitespace-nowrap px-4 py-2 rounded-full text-sm font-bold transition-all shadow-sm border
                                ${activeCategory === key 
                                    ? `${config.headerColor} border-transparent scale-105 ring-2 ring-offset-1 ring-gray-200` 
                                    : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'}
                            `}
                        >
                            {config.title}
                        </button>
                    ))}
                </div>
            );
        };

        const ProductInput = ({ name, value, onChange, share, totalShelf }) => {
            return (
                <div className="flex items-center justify-between py-3 border-b border-gray-100 last:border-0">
                    <div className="w-1/2 pr-2">
                        <span className="text-sm font-medium text-gray-700 block">{name}</span>
                        <span className="text-[10px] text-gray-400">
                            Share: <strong>{totalShelf > 0 ? share : '0.0'}%</strong>
                        </span>
                    </div>
                    <div className="w-1/2 flex items-center gap-3 justify-end">
                        <input
                            type="number"
                            value={value}
                            onChange={(e) => onChange(e.target.value)}
                            placeholder="0"
                            className="w-20 p-2 text-right bg-white border border-gray-300 rounded text-sm focus:ring-1 focus:ring-[#008200] focus:border-[#008200] outline-none transition-all"
                        />
                        <span className="text-xs text-gray-400 w-4">cm</span>
                    </div>
                </div>
            );
        };

        const SCORES_PRESENCA = {
            "Baden Baden IPA Lata 350ml OU Vidro 600ml": {
                hiper: { gondola: 1.0, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 2.0, gelada: 0.5 },
                cc: { gondola: 2.0, gelada: 0 }
            },
            "Baden Baden Pilsen Cristal Lata 350ml OU Vidro 600ml": {
                hiper: { gondola: 1.0, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 2.0, gelada: 0.5 },
                cc: { gondola: 2.0, gelada: 0 }
            },
            "Baden Baden Witbier Lata 350ml OU Vidro 600ml": {
                hiper: { gondola: 1.0, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 2.0, gelada: 0.5 },
                cc: { gondola: 2.0, gelada: 0 }
            },
            "Blue Moon Lata 350ml ou Vidro 355ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 1.5, gelada: 0.5 },
                cc: { gondola: 1.0, gelada: 0 }
            },
            "Eisenbahn IPA Lata 350ml OU Vidro 355ml": {
                hiper: { gondola: 1.0, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 1.0, gelada: 0.5 },
                cc: { gondola: 1.0, gelada: 0 }
            },
            "Eisenbahn Pale Ale Lata 350ml OU Vidro 355ml": {
                hiper: { gondola: 1.0, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 1.0, gelada: 0.5 },
                cc: { gondola: 1.0, gelada: 0 }
            },
            "Eisenbahn Session Ipa Lata 350ml OU Vidro 355ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 0, gelada: 0 }
            },
            "Eisenbahn Weizenbier Vidro 355ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 0.5, gelada: 0 }
            },
            "Lagunitas IPA Lata 350ml OU Vidro 355ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 1.5, gelada: 0.5 },
                cc: { gondola: 1.0, gelada: 0 }
            },
            "Praya Classica 355ml OU Classica 600ml": {
                hiper: { gondola: 0.5, gelada: 0 },
                super: { gondola: 0.5, gelada: 0 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 0.5, gelada: 0 }
            },
            "Eisenbahn Pilsen Vidro 355ml OU Unfiltered 355ml": {
                hiper: { gondola: 1.5, gelada: 0.5 },
                super: { gondola: 1.5, gelada: 0.5 },
                mini: { gondola: 1.5, gelada: 0.5 },
                cc: { gondola: 2.5, gelada: 0 }
            },
            "Heineken Lager Lata 350ml": {
                hiper: { gondola: 1.5, gelada: 1.0 },
                super: { gondola: 2.0, gelada: 1.0 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 3.0, gelada: 0 }
            },
            "Heineken Lager Vidro 250ml OU Lata 269ml": {
                hiper: { gondola: 1.5, gelada: 1.0 },
                super: { gondola: 2.0, gelada: 1.0 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 3.0, gelada: 0 }
            },
            "Heineken Lager Vidro 330ml": {
                hiper: { gondola: 1.5, gelada: 0.5 },
                super: { gondola: 2.0, gelada: 1.0 },
                mini: { gondola: 3.0, gelada: 1.0 },
                cc: { gondola: 3.0, gelada: 0 }
            },
            "Heineken Pilsen Zero Lata 350ml OU 269ml": {
                hiper: { gondola: 1.5, gelada: 0.5 },
                super: { gondola: 2.0, gelada: 1.0 },
                mini: { gondola: 2.5, gelada: 1.0 },
                cc: { gondola: 2.5, gelada: 0 }
            },
            "Heineken Pilsen Zero Vidro 330ml": {
                hiper: { gondola: 1.5, gelada: 1.0 },
                super: { gondola: 0.5, gelada: 1.0 },
                mini: { gondola: 2.5, gelada: 1.0 },
                cc: { gondola: 2.5, gelada: 0 }
            },
            "Praya Lager 355ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0.5, gelada: 0.5 },
                cc: { gondola: 0.5, gelada: 0 }
            },
            "Sol Pilsen Vidro 330ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0.5, gelada: 0.5 },
                cc: { gondola: 0.5, gelada: 0 }
            },
            "Amstel Ultra Vidro 275ml OU Lata 269ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 0.5, gelada: 0 }
            },
            "Eisenbahn Pilsen Lata 473ml OU Unfiltered 350ml": {
                hiper: { gondola: 1.5, gelada: 0.5 },
                super: { gondola: 1.5, gelada: 0.5 },
                mini: { gondola: 1.5, gelada: 0.5 },
                cc: { gondola: 2.5, gelada: 0 }
            },
            "Heineken Lager Lata 473ml": {
                hiper: { gondola: 1.5, gelada: 1.0 },
                super: { gondola: 2.0, gelada: 1.0 },
                mini: { gondola: 3.0, gelada: 1.0 },
                cc: { gondola: 3.0, gelada: 0 }
            },
            "Amstel Lager Lata 269ml": {
                hiper: { gondola: 0, gelada: 0 },
                super: { gondola: 0, gelada: 0 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 0.5, gelada: 0 }
            },
            "Amstel Lager Lata 350ml": {
                hiper: { gondola: 1.0, gelada: 0.5 },
                super: { gondola: 1.0, gelada: 0.5 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 2.0, gelada: 0 }
            },
            "Amstel Lager Lata 473ml": {
                hiper: { gondola: 1.5, gelada: 1.0 },
                super: { gondola: 1.5, gelada: 1.0 },
                mini: { gondola: 1.5, gelada: 1.0 },
                cc: { gondola: 2.0, gelada: 0 }
            },
            "Amstel Lager Vidro 355ml": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0, gelada: 0 },
                cc: { gondola: 0, gelada: 0 }
            },
            "Fys (Todos sabores/variações, exceto Tônica)": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0.5, gelada: 0.5 },
                cc: { gondola: 0.5, gelada: 0 }
            },
            "Fys Tônica Lata 350ml (Regular/Zero)": {
                hiper: { gondola: 0.5, gelada: 0.5 },
                super: { gondola: 0.5, gelada: 0.5 },
                mini: { gondola: 0.5, gelada: 0.5 },
                cc: { gondola: 0.5, gelada: 0 }
            }
        };

        const POSICIONAMENTO_CHECKLIST = [
            { id: 'estilos_ordenados', label: 'A exposição dos estilos está ordenada com os líquidos mais escuros para os mais claros?', points: 1.0 },
            { id: 'baden_colorado', label: 'Baden Baden está exposta próxima a Colorado?', points: 1.0 },
            { id: 'baden_blue_lagunitas', label: 'Baden Baden, Blue Moon e Lagunitas estão expostas na gôndola de Especiais?', points: 1.0 },
            { id: 'amstel_planograma', label: 'Na gôndola de Mainstream, Amstel segue a ordem de posicionamento conforme planograma?', points: 1.0 },
            { id: 'mainstream_70_30', label: 'Na gôndola de Mainstream, temos 70% dos pacotes fechados nas prateleiras inferiores e 30% expostos em unidades nas prateleiras superiores?', points: 1.0 },
            { id: 'heineken_00_dupla', label: 'Heineken 00 tem dupla exposição (na gôndola de Premium ao lado de Heineken Regular e na gôndola de cervejas sem álcool)?', points: 1.0 },
            { id: 'premium_protecao', label: 'Na gôndola de Premium, ao menos uma marca do nosso portfólio está protegendo a marca Heineken de Spaten?', points: 1.0 },
            { id: 'premium_planograma', label: 'Na gôndola de Premium, nossas marcas seguem a ordem de posicionamento conforme planograma?', points: 1.0 },
            { id: 'praya_abrindo', label: 'Na gôndola de Premium, Praya Lager está abrindo o segmento?', points: 0.5 },
            { id: 'premium_70_30', label: 'Na gôndola de Premium, temos 70% dos pacotes fechados nas prateleiras inferiores e 30% expostos em unidades nas prateleiras superiores?', points: 1.0 },
            { id: 'fys_tonica', label: 'Tônica FYS está posicionada próxima de Schweppes Tônica ou Antarctica Tônica?', points: 0.5 },
            { id: 'extra_amstel', label: 'Ponto extra de Amstel está posicionado na área de churrasco/açougue (caso tenha)?', points: 0.0 },
            { id: 'extra_heineken', label: 'Ponto extra de Heineken está posicionado ao lado do ponto extra de Heineken 0.0 (caso tenha)?', points: 0.0 },
            { id: 'extra_praya', label: 'Ponto extra de Praya Lager está posicionado ao lado do ponto extra de Corona (caso tenha)?', points: 0.0 },
            { id: 'extra_sol', label: 'Ponto extra de Sol está posicionado ao lado do ponto extra de Corona (caso tenha)?', points: 0.0 }
        ];

        const StoreTypeSelector = ({ selected, onSelect }) => {
            const types = [
                { id: 'hiper', label: 'Hiper' },
                { id: 'super', label: 'Super' },
                { id: 'mini', label: 'Mini' },
                { id: 'cc', label: 'C&C' }
            ];

            return (
                <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-6">
                    <h2 className="text-sm font-bold text-gray-400 uppercase mb-3">Tipo de Loja</h2>
                    <div className="flex gap-2">
                        {types.map(type => (
                            <button
                                key={type.id}
                                onClick={() => onSelect(type.id)}
                                className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all border ${
                                    selected === type.id
                                        ? 'bg-[#008200] text-white border-[#008200] shadow-md'
                                        : 'bg-gray-50 text-gray-500 border-gray-200 hover:bg-gray-100'
                                }`}
                            >
                                {type.label}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const ScoreRules = () => (
            <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-6">
                <h3 className="text-sm font-bold text-gray-800 mb-3">Regras de pontuação</h3>
                <div className="space-y-3">
                    <div className="flex items-start gap-3">
                        <div className="relative mt-1">
                            <Store size={20} className="text-gray-800" />
                            <Star size={10} className="absolute -top-1 -right-1 text-[#008200] fill-current" />
                        </div>
                        <div>
                            <span className="block text-sm font-bold text-gray-700">Verde (70% - 100%)</span>
                            <span className="text-xs text-gray-500 leading-tight block">Excelente! Execução dentro do padrão de excelência.</span>
                        </div>
                    </div>
                    <div className="flex items-start gap-3">
                        <div className="relative mt-1">
                            <Store size={20} className="text-gray-800" />
                            <Star size={10} className="absolute -top-1 -right-1 text-amber-400 fill-current" />
                        </div>
                        <div>
                            <span className="block text-sm font-bold text-gray-700">Amarelo (30% - 69.99%)</span>
                            <span className="text-xs text-gray-500 leading-tight block">Atenção! Existem oportunidades de melhoria na execução.</span>
                        </div>
                    </div>
                    <div className="flex items-start gap-3">
                        <div className="relative mt-1">
                            <Store size={20} className="text-gray-800" />
                            <Star size={10} className="absolute -top-1 -right-1 text-red-500 fill-current" />
                        </div>
                        <div>
                            <span className="block text-sm font-bold text-gray-700">Vermelho (0% - 29.99%)</span>
                            <span className="text-xs text-gray-500 leading-tight block">Crítico! A execução está muito abaixo do esperado. Ação imediata necessária.</span>
                        </div>
                    </div>
                </div>
            </div>
        );

        const AuditoriaScorecard = ({ scores, totalScore }) => {
            let scoreColor = "text-red-500";
            let starColor = "text-red-500";
            
            if (totalScore >= 70) {
                scoreColor = "text-[#008200]";
                starColor = "text-[#008200]";
            } else if (totalScore >= 30) {
                scoreColor = "text-amber-500";
                starColor = "text-amber-500";
            }

            return (
                <>
                    <div className="bg-white p-4 rounded-xl shadow-md border border-gray-100 mb-6 sticky top-[72px] z-30">
                        <div className="flex justify-between items-center mb-3">
                            <h2 className="text-sm font-bold text-gray-800 uppercase flex items-center gap-2">
                                <Star className={`w-4 h-4 ${starColor} fill-current`} />
                                Auditoria FDS
                            </h2>
                            <span className={`text-2xl font-bold ${scoreColor}`}>{totalScore} <span className="text-xs text-gray-400 font-normal">/ 100 pts</span></span>
                        </div>
                        <div className="grid grid-cols-4 gap-2 text-center">
                            <div className="bg-gray-50 p-2 rounded border border-gray-100">
                                <span className="block text-[10px] font-bold text-gray-400 uppercase">Presença</span>
                                <span className="block text-lg font-bold text-gray-800">{scores.presenca}</span>
                            </div>
                            <div className="bg-gray-50 p-2 rounded border border-gray-100">
                                <span className="block text-[10px] font-bold text-gray-400 uppercase">Posic.</span>
                                <span className="block text-lg font-bold text-gray-800">{scores.posicionamento}</span>
                            </div>
                            <div className="bg-gray-50 p-2 rounded border border-gray-100">
                                <span className="block text-[10px] font-bold text-gray-400 uppercase">Promo.</span>
                                <span className="block text-lg font-bold text-gray-800">{scores.visibilidade}</span>
                            </div>
                            <div className="bg-gray-50 p-2 rounded border border-gray-100">
                                <span className="block text-[10px] font-bold text-gray-400 uppercase">Preço</span>
                                <span className="block text-lg font-bold text-gray-800">{scores.precificacao}</span>
                            </div>
                        </div>
                    </div>
                    <ScoreRules />
                </>
            );
        };

        const TabPresenca = ({ data, storeType, onChange }) => {
            return (
                <div className="space-y-3">
                    {Object.entries(SCORES_PRESENCA).map(([product, scores]) => {
                        const currentScores = scores[storeType] || { gondola: 0, gelada: 0 };
                        const productState = data[product] || { gondola: false, gelada: false };

                        return (
                            <div key={product} className="bg-gray-50 p-3 rounded-lg border border-gray-200 flex justify-between items-center">
                                <span className="text-sm font-medium text-gray-700 w-1/3">{product}</span>
                                <div className="flex gap-4">
                                    <label className="flex items-center gap-2 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            checked={productState.gondola}
                                            onChange={(e) => onChange(product, 'gondola', e.target.checked)}
                                            className="w-4 h-4 text-[#008200] rounded focus:ring-[#008200]"
                                        />
                                        <div className="flex flex-col">
                                            <span className="text-xs font-bold text-gray-600">Gôndola</span>
                                            <span className="text-[10px] text-gray-400">+{currentScores.gondola} pts</span>
                                        </div>
                                    </label>
                                    <label className="flex items-center gap-2 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            checked={productState.gelada}
                                            onChange={(e) => onChange(product, 'gelada', e.target.checked)}
                                            className="w-4 h-4 text-[#008200] rounded focus:ring-[#008200]"
                                        />
                                        <div className="flex flex-col">
                                            <span className="text-xs font-bold text-gray-600">Gelada</span>
                                            <span className="text-[10px] text-gray-400">+{currentScores.gelada} pts</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        );
                    })}
                </div>
            );
        };



        const CategorySection = ({ categoryKey, config, values, onUpdateWorld, onUpdateProduct, isTabbed, onSelectCategory, allCategories }) => {
            const [isOpen, setIsOpen] = useState(true);

            useEffect(() => {
                if (isTabbed) setIsOpen(true);
            }, [isTabbed, categoryKey]);

            const worldCm = values.world;
            const productValues = values.products;
            const totalShelf = parseFloat(worldCm) || 0;
            
            const hnkTotalVal = config.products.reduce((acc, prod) => {
                return acc + (parseFloat(productValues[prod]) || 0);
            }, 0);

            const isError = hnkTotalVal > totalShelf && totalShelf > 0;
            const totalShare = totalShelf > 0 ? ((hnkTotalVal / totalShelf) * 100).toFixed(1) : 0;
            const isTargetMet = config.target ? parseFloat(totalShare) >= config.target : true;


            const targetCm = config.target ? (totalShelf * config.target) / 100 : 0;
            const missingCm = config.target ? (targetCm - hnkTotalVal).toFixed(1) : 0;
            const isMissing = parseFloat(missingCm) > 0;

            // Navigation Logic
            const currentIndex = allCategories ? allCategories.indexOf(categoryKey) : -1;
            const prevCategory = currentIndex > 0 ? allCategories[currentIndex - 1] : null;
            const nextCategory = currentIndex !== -1 && currentIndex < allCategories.length - 1 ? allCategories[currentIndex + 1] : null;

            return (
                <div className="mb-6 bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden">
                    <div 
                        className={`p-4 flex justify-between items-center text-white transition-colors ${config.headerColor} ${isTabbed ? '' : 'cursor-pointer'}`}
                        onClick={() => !isTabbed && setIsOpen(!isOpen)}
                    >
                        <div className="flex items-center gap-2">
                            <Star className="w-5 h-5 text-red-500 fill-current" />
                            <h2 className="text-lg font-bold uppercase tracking-wider">{config.title}</h2>
                        </div>
                        <div className="flex items-center gap-3">
                            {config.target !== null && (
                                <span className="text-xs font-semibold bg-white/20 px-2 py-1 rounded">
                                    META: {config.target}%
                                </span>
                            )}
                            {isOpen ? (isTabbed ? null : <ChevronUp size={20} />) : <ChevronDown size={20} />}
                        </div>
                    </div>

                    {isOpen && (
                        <div className="p-4">
                            <div className="bg-blue-50 p-4 rounded-lg border border-blue-100 mb-6">
                                <div className="flex justify-between items-center mb-2">
                                    <label className="text-xs font-bold text-blue-800 uppercase flex items-center gap-1">
                                        <Globe size={14} />
                                        Espaço Total da Categoria (Mundo)
                                    </label>
                                </div>
                                <div className="flex items-center gap-2">
                                    <input
                                        type="number"
                                        value={worldCm}
                                        onChange={(e) => onUpdateWorld(e.target.value)}
                                        placeholder="Total da gôndola em cm"
                                        className="w-full p-3 text-lg bg-white border border-blue-200 rounded text-gray-800 focus:ring-2 focus:ring-blue-500 outline-none"
                                    />
                                    <span className="font-bold text-blue-300">cm</span>
                                </div>
                            </div>

                            <div className="mb-6">
                                <h3 className="text-xs font-bold text-gray-400 uppercase mb-3 pl-1">Nossos Produtos (cm)</h3>
                                <div className={`bg-gray-50 rounded-lg p-2 border ${isError ? 'border-red-300' : 'border-gray-200'}`}>
                                    {config.products.map((prod, idx) => {
                                        const val = parseFloat(productValues[prod]) || 0;
                                        const share = totalShelf > 0 ? ((val / totalShelf) * 100).toFixed(1) : 0;
                                        
                                        return (
                                            <ProductInput 
                                                key={idx}
                                                name={prod}
                                                value={productValues[prod] || ''}
                                                onChange={(val) => onUpdateProduct(prod, val)}
                                                share={share}
                                                totalShelf={totalShelf}
                                            />
                                        );
                                    })}
                                </div>
                                {isError && (
                                    <div className="flex items-center gap-1 text-red-500 text-xs mt-1 pl-1">
                                        <AlertTriangle size={12} />
                                        <span>Atenção: A soma dos produtos excede o total do mundo!</span>
                                    </div>
                                )}
                            </div>

                            <div className="border-t-2 border-dashed border-gray-200 pt-4">
                                <div className="flex justify-between items-end">
                                    <div>
                                        <span className="text-sm font-bold text-gray-500 block">SHARE TOTAL</span>
                                        <span className="text-xs text-gray-400">
                                            (Nossos: {hnkTotalVal}cm / Mundo: {totalShelf}cm)
                                        </span>
                                    </div>
                                    <div className={`text-4xl font-bold ${isTargetMet ? 'text-[#008200]' : 'text-red-500'}`}>
                                        {totalShare}%
                                    </div>
                                </div>
                                {config.target && totalShelf > 0 && (
                                    <div className="space-y-2 mt-3">
                                        <div className={`p-2 rounded flex items-center justify-center gap-2 text-sm font-bold ${isTargetMet ? 'bg-green-100 text-[#008200]' : 'bg-red-100 text-red-600'}`}>
                                            {isTargetMet ? <CheckCircle size={18} /> : <AlertCircle size={18} />}
                                            {isTargetMet ? `META DE ${config.target}% ATINGIDA` : `ABAIXO DA META DE ${config.target}%`}
                                        </div>
                                        {isMissing && (
                                            <div className="p-2 rounded flex items-center justify-center gap-2 text-xs font-bold bg-amber-50 text-amber-700 border border-amber-200">
                                                <AlertTriangle size={14} />
                                                <span>Faltam {missingCm} cm para atingir a meta</span>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>

                            {/* Navigation Buttons */}
                            {isTabbed && allCategories && (
                                <div className="flex justify-between mt-6 pt-4 border-t border-gray-100">
                                    {prevCategory ? (
                                        <button
                                            onClick={() => onSelectCategory(prevCategory)}
                                            className="flex items-center gap-2 text-sm font-bold text-gray-500 hover:text-[#008200] transition-colors"
                                        >
                                            <ArrowRight size={16} className="rotate-180" />
                                            Anterior
                                        </button>
                                    ) : <div></div>}
                                    
                                    {nextCategory ? (
                                        <button
                                            onClick={() => onSelectCategory(nextCategory)}
                                            className="flex items-center gap-2 text-sm font-bold text-[#008200] hover:text-[#006000] transition-colors"
                                        >
                                            Próximo
                                            <ArrowRight size={16} />
                                        </button>
                                    ) : <div></div>}
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        const TabPosicionamento = ({ 
            allData, CATEGORIES, activeCategory, onSelectCategory, onUpdateWorld, onUpdateProduct,
            checklistData, onChecklistChange, auditoriaScore 
        }) => {
            // Calculate shares for display
            const getCatShare = (catKey) => {
                const catData = allData[catKey];
                const worldCm = parseFloat(catData.world) || 0;
                const config = CATEGORIES[catKey];
                let catTotalHnk = 0;
                config.products.forEach(prod => {
                    catTotalHnk += (parseFloat(catData.products[prod]) || 0);
                });
                return worldCm > 0 ? (catTotalHnk / worldCm) * 100 : 0;
            };

            const sharePremium = getCatShare('premium');
            const shareCraft = getCatShare('craft');
            const shareMainstream = getCatShare('mainstream');

            const scorePremium = sharePremium >= 57 ? 9 : 0;
            const scoreCraft = shareCraft >= 53 ? 8 : 0;
            const scoreMainstream = shareMainstream >= 25 ? 8 : 0;
            
            let checklistScore = 0;
            POSICIONAMENTO_CHECKLIST.forEach(item => {
                if (checklistData[item.id]) checklistScore += item.points;
            });

            const totalScore = scorePremium + scoreCraft + scoreMainstream + checklistScore;



            return (
                <div className="space-y-6">


                    {/* Score Summary */}
                    <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <h3 className="text-sm font-bold text-gray-700 uppercase mb-3 text-center">Resumo da Pontuação</h3>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div className={`p-3 rounded border ${scorePremium > 0 ? 'bg-green-50 border-green-200' : 'bg-white border-gray-200'}`}>
                                <span className="text-xs text-gray-500 block">Premium (Meta 57%)</span>
                                <span className="font-bold text-lg">{sharePremium.toFixed(1)}%</span>
                                <span className={`text-xs font-bold block ${scorePremium > 0 ? 'text-[#008200]' : 'text-gray-400'}`}>
                                    +{scorePremium} pts
                                </span>
                            </div>
                            <div className={`p-3 rounded border ${scoreCraft > 0 ? 'bg-green-50 border-green-200' : 'bg-white border-gray-200'}`}>
                                <span className="text-xs text-gray-500 block">Craft (Meta 53%)</span>
                                <span className="font-bold text-lg">{shareCraft.toFixed(1)}%</span>
                                <span className={`text-xs font-bold block ${scoreCraft > 0 ? 'text-[#008200]' : 'text-gray-400'}`}>
                                    +{scoreCraft} pts
                                </span>
                            </div>
                            <div className={`p-3 rounded border ${scoreMainstream > 0 ? 'bg-green-50 border-green-200' : 'bg-white border-gray-200'}`}>
                                <span className="text-xs text-gray-500 block">Mainstream (Meta 25%)</span>
                                <span className="font-bold text-lg">{shareMainstream.toFixed(1)}%</span>
                                <span className={`text-xs font-bold block ${scoreMainstream > 0 ? 'text-[#008200]' : 'text-gray-400'}`}>
                                    +{scoreMainstream} pts
                                </span>
                            </div>
                            <div className="p-3 rounded border bg-white border-gray-200">
                                <span className="text-xs text-gray-500 block">Checklist</span>
                                <span className="font-bold text-lg">{checklistScore} pts</span>
                            </div>
                        </div>
                        <div className="text-center bg-[#008200] text-white p-2 rounded font-bold">
                            Total Posicionamento: {totalScore} / 35 pts
                        </div>
                    </div>

                    {/* Calculator Section */}
                    <div>
                        <h2 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <Globe size={20} className="text-[#008200]" />
                            Calculadora de Share
                        </h2>

                        <CategoryTabs 
                            categories={CATEGORIES} 
                            activeCategory={activeCategory} 
                            onSelect={onSelectCategory} 
                        />

                        <div className="min-h-[300px]">
                            {Object.entries(CATEGORIES).map(([key, config]) => {
                                if (key !== activeCategory) return null;
                                return (
                                    <CategorySection 
                                        key={key}
                                        categoryKey={key}
                                        config={config}
                                        values={allData[key]}
                                        onUpdateWorld={(val) => onUpdateWorld(key, val)}
                                        onUpdateProduct={(prod, val) => onUpdateProduct(key, prod, val)}
                                        isTabbed={true}
                                        onSelectCategory={onSelectCategory}
                                        allCategories={Object.keys(CATEGORIES)}
                                    />
                                );
                            })}
                        </div>
                    </div>

                    {/* Checklist Section */}
                    <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
                        <div className="bg-gray-100 p-3 border-b border-gray-200">
                            <h3 className="font-bold text-gray-700 text-sm uppercase">Checklist de Execução</h3>
                        </div>
                        <div className="divide-y divide-gray-100">
                            {POSICIONAMENTO_CHECKLIST.map(item => (
                                <label key={item.id} className="flex items-start gap-3 p-3 hover:bg-gray-50 cursor-pointer transition-colors">
                                    <input
                                        type="checkbox"
                                        checked={checklistData[item.id] || false}
                                        onChange={(e) => onChecklistChange(item.id, e.target.checked)}
                                        className="mt-1 w-5 h-5 text-[#008200] rounded focus:ring-[#008200] shrink-0"
                                    />
                                    <div className="flex-1">
                                        <span className="text-sm text-gray-700 block">{item.label}</span>
                                        <span className="text-[10px] font-bold text-gray-400">Vale {item.points} pts</span>
                                    </div>
                                </label>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const TabVisibilidade = ({ data, onChange }) => {
            const totalPes = parseInt(data.totalPes) || 0;
            
            let targetCraft = 0;
            let targetPremium = 0;
            let targetMainstream = 0;

            if (totalPes <= 5) {
                targetCraft = 0;
                targetPremium = 1;
                targetMainstream = 1;
            } else if (totalPes >= 6 && totalPes <= 10) {
                targetCraft = 1;
                targetPremium = 2;
                targetMainstream = 1;
            } else if (totalPes >= 11 && totalPes <= 15) {
                targetCraft = 1;
                targetPremium = 3;
                targetMainstream = 2;
            } else if (totalPes >= 16 && totalPes <= 20) {
                targetCraft = 1;
                targetPremium = 5;
                targetMainstream = 2;
            } else if (totalPes >= 21) {
                targetCraft = 1;
                targetPremium = 6;
                targetMainstream = 3;
            }

            return (
                <div className="space-y-4">
                    <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <label className="block text-sm font-bold text-blue-800 mb-2 uppercase">
                            Total Pes de Cerveja na Loja
                        </label>
                        <input
                            type="number"
                            value={data.totalPes}
                            onChange={(e) => onChange('totalPes', e.target.value)}
                            className="w-full p-3 text-lg bg-white border border-blue-300 rounded text-gray-800 focus:ring-2 focus:ring-blue-500 outline-none"
                            placeholder="Ex: 12"
                        />
                        <p className="text-xs text-blue-600 mt-2">
                            *Define as metas de Pontos Extras
                        </p>
                    </div>

                    <div className="grid grid-cols-1 gap-4">
                        {/* CRAFT */}
                        <div className="bg-gray-50 p-3 rounded-lg border border-gray-200">
                            <div className="flex justify-between items-center mb-2">
                                <label className="text-sm font-bold text-amber-700 uppercase">Craft (Artesanais)</label>
                                <span className="text-xs font-bold bg-amber-100 text-amber-800 px-2 py-1 rounded">
                                    Meta: {targetCraft} PE
                                </span>
                            </div>
                            <div className="flex items-center gap-2">
                                <input
                                    type="number"
                                    value={data.peCraft}
                                    onChange={(e) => onChange('peCraft', e.target.value)}
                                    className="flex-1 p-2 border border-gray-300 rounded text-sm"
                                    placeholder="Qtd PE"
                                />
                                <span className="text-xs font-bold text-gray-400 w-16 text-right">
                                    Vale 6 pts
                                </span>
                            </div>
                        </div>

                        {/* PREMIUM */}
                        <div className="bg-gray-50 p-3 rounded-lg border border-gray-200">
                            <div className="flex justify-between items-center mb-2">
                                <label className="text-sm font-bold text-[#008200] uppercase">Premium</label>
                                <span className="text-xs font-bold bg-green-100 text-[#008200] px-2 py-1 rounded">
                                    Meta: {targetPremium} PE
                                </span>
                            </div>
                            <div className="flex items-center gap-2">
                                <input
                                    type="number"
                                    value={data.pePremium}
                                    onChange={(e) => onChange('pePremium', e.target.value)}
                                    className="flex-1 p-2 border border-gray-300 rounded text-sm"
                                    placeholder="Qtd PE"
                                />
                                <span className="text-xs font-bold text-gray-400 w-16 text-right">Vale 8 pts</span>
                            </div>
                        </div>

                        {/* MAINSTREAM */}
                        <div className="bg-gray-50 p-3 rounded-lg border border-gray-200">
                            <div className="flex justify-between items-center mb-2">
                                <label className="text-sm font-bold text-blue-700 uppercase">Mainstream</label>
                                <span className="text-xs font-bold bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                    Meta: {targetMainstream} PE
                                </span>
                            </div>
                            <div className="flex items-center gap-2">
                                <input
                                    type="number"
                                    value={data.peMainstream}
                                    onChange={(e) => onChange('peMainstream', e.target.value)}
                                    className="flex-1 p-2 border border-gray-300 rounded text-sm"
                                    placeholder="Qtd PE"
                                />
                                <span className="text-xs font-bold text-gray-400 w-16 text-right">Vale 6 pts</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const TabPrecificacao = ({ data, onChange }) => {
            return (
                <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <p className="text-sm font-medium text-gray-700 mb-4">
                        Todos os produtos HEINEKEN estão precificados corretamente?
                    </p>
                    <div className="flex gap-4">
                        <button
                            onClick={() => onChange(true)}
                            className={`flex-1 py-2 rounded-lg font-bold border ${data ? 'bg-[#008200] text-white border-[#008200]' : 'bg-white text-gray-500 border-gray-300'}`}
                        >
                            SIM
                        </button>
                        <button
                            onClick={() => onChange(false)}
                            className={`flex-1 py-2 rounded-lg font-bold border ${!data ? 'bg-red-500 text-white border-red-500' : 'bg-white text-gray-500 border-gray-300'}`}
                        >
                            NÃO
                        </button>
                    </div>
                    <p className="text-center mt-4 font-bold text-gray-600">
                        {data ? '5 Pontos' : '0 Pontos'}
                    </p>
                </div>
            );
        };

        const AuditoriaTabs = ({ 
            activeTab, onTabChange, 
            presencaData, onPresencaChange, storeType,
            allData, CATEGORIES, activeCategory, onSelectCategory, onUpdateWorld, onUpdateProduct,
            checklistData, onChecklistChange,
            visibilidadeData, onVisibilidadeChange,
            precificacaoData, onPrecificacaoChange,
            auditoriaScore
        }) => {
            const tabs = [
                { id: 'presenca', label: 'Presença', icon: LayoutGrid },
                { id: 'posicionamento', label: 'Posic.', icon: Target },
                { id: 'visibilidade', label: 'Promo.', icon: Megaphone },
                { id: 'precificacao', label: 'Preço', icon: Tag }
            ];

            return (
                <div className="bg-white rounded-xl shadow-sm border border-gray-100 mb-6 overflow-hidden">
                    <div className="bg-gray-100 p-1 rounded-xl flex gap-1 m-2">
                        {tabs.map(tab => {
                            const Icon = tab.icon;
                            const isActive = activeTab === tab.id;
                            return (
                                <button
                                    key={tab.id}
                                    onClick={() => onTabChange(tab.id)}
                                    className={`flex-1 flex items-center justify-center gap-1 py-2 rounded-lg text-xs md:text-sm font-bold transition-all ${
                                        isActive
                                            ? 'bg-white text-[#008200] shadow-sm ring-1 ring-black/5'
                                            : 'text-gray-500 hover:text-gray-700 hover:bg-gray-200/50'
                                    }`}
                                >
                                    <Icon size={16} />
                                    {tab.label}
                                </button>
                            );
                        })}
                    </div>
                    <div className="p-4">
                        {activeTab === 'presenca' && (
                            <TabPresenca 
                                data={presencaData} 
                                storeType={storeType} 
                                onChange={onPresencaChange} 
                            />
                        )}
                        {activeTab === 'posicionamento' && (
                            <TabPosicionamento 
                                allData={allData}
                                CATEGORIES={CATEGORIES}
                                activeCategory={activeCategory}
                                onSelectCategory={onSelectCategory}
                                onUpdateWorld={onUpdateWorld}
                                onUpdateProduct={onUpdateProduct}
                                checklistData={checklistData}
                                onChecklistChange={onChecklistChange}
                                auditoriaScore={auditoriaScore}
                            />
                        )}
                        {activeTab === 'visibilidade' && (
                            <TabVisibilidade 
                                data={visibilidadeData} 
                                onChange={onVisibilidadeChange} 
                            />
                        )}
                        {activeTab === 'precificacao' && (
                            <TabPrecificacao 
                                data={precificacaoData} 
                                onChange={onPrecificacaoChange} 
                            />
                        )}
                    </div>
                </div>
            );
        };



            const ReportTable = ({ allData, globalData, date, time, storeName, fds, auditoriaData, auditoriaScore, storeType }) => {
                let headerBg = "bg-red-600";
                let scoreDesc = "Crítico! A execução está muito abaixo do esperado. Ação imediata necessária.";
                
                if (auditoriaScore.total >= 70) {
                    headerBg = "bg-[#008200]";
                    scoreDesc = "Excelente! Execução dentro do padrão de excelência.";
                } else if (auditoriaScore.total >= 30) {
                    headerBg = "bg-amber-500";
                    scoreDesc = "Atenção! Existem oportunidades de melhoria na execução.";
                }

                return (
                    <div className="bg-white p-6 w-[3200px] font-sans text-gray-800 border border-gray-300">
                        <div className="border-b-8 border-[#008200] pb-6 mb-8 flex justify-between items-end">
                            <div>
                                <h1 className="text-6xl font-bold text-[#008200] uppercase tracking-tighter">Relatório de Execução</h1>
                                <p className="text-3xl text-gray-500 font-semibold mt-3">HEINEKEN BRASIL - EXECUÇÃO PERFEITA</p>
                            </div>
                            <div className="text-right text-3xl text-gray-500">
                                <p>{date}</p>
                                <p>{time}</p>
                            </div>
                        </div>

                        <div className="mb-8 grid grid-cols-3 gap-6">
                            <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                                <span className="text-2xl font-bold text-gray-500 uppercase block mb-2">Loja</span>
                                <span className="text-4xl font-bold text-gray-800">{storeName || '-'}</span>
                            </div>
                            <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                                <span className="text-2xl font-bold text-gray-500 uppercase block mb-2">Tipo de Loja</span>
                                <span className="text-4xl font-bold text-gray-800 uppercase">{storeType || '-'}</span>
                            </div>
                            <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                                <span className="text-2xl font-bold text-gray-500 uppercase block mb-2">Colaborador</span>
                                <div className="flex items-baseline gap-2">
                                    <span className="text-4xl font-bold text-gray-800">{fds || '-'}</span>
                                </div>
                            </div>
                        </div>

                        {/* AUDITORIA FDS SECTION */}
                        <div className="mb-10 border-2 border-gray-400 rounded-xl overflow-hidden">
                            <div className={`${headerBg} text-white p-6 flex flex-col justify-center items-center text-center font-bold uppercase gap-2`}>
                                <div className="flex justify-between w-full items-center">
                                    <span className="text-4xl">Auditoria FDS</span>
                                    <span className="text-5xl">{auditoriaScore.total} / 100 pts</span>
                                </div>
                                <span className="text-2xl font-medium opacity-90 normal-case mt-2">{scoreDesc}</span>
                            </div>
                        <div className="grid grid-cols-4 divide-x-2 divide-gray-300 bg-gray-50 border-b border-gray-300">
                            <div className="p-6 text-center">
                                <span className="block text-2xl font-bold text-gray-500 uppercase mb-2">Presença</span>
                                <span className="block text-5xl font-bold text-gray-800">{auditoriaScore.presenca}</span>
                            </div>
                            <div className="p-6 text-center">
                                <span className="block text-2xl font-bold text-gray-500 uppercase mb-2">Posicionamento</span>
                                <span className="block text-5xl font-bold text-gray-800">{auditoriaScore.posicionamento}</span>
                            </div>
                            <div className="p-6 text-center">
                                <span className="block text-2xl font-bold text-gray-500 uppercase mb-2">Promoção</span>
                                <span className="block text-5xl font-bold text-gray-800">{auditoriaScore.visibilidade}</span>
                            </div>
                            <div className="p-6 text-center">
                                <span className="block text-2xl font-bold text-gray-500 uppercase mb-2">Preço</span>
                                <span className="block text-5xl font-bold text-gray-800">{auditoriaScore.precificacao}</span>
                            </div>
                        </div>
                        <div className="p-6 bg-white">
                            <h4 className="text-4xl font-bold text-gray-500 uppercase mb-4">Detalhamento</h4>
                            <div className="grid grid-cols-2 gap-8 text-4xl leading-relaxed">
                                <div>
                                    <p className="font-bold text-gray-700 mb-1">Presença (Mix Obrigatório):</p>
                                    <ul className="list-disc pl-4 space-y-1 text-gray-600">
                                        {Object.entries(auditoriaData.presenca).map(([prod, state]) => {
                                            if (!state.gondola && !state.gelada) return null;
                                            return (
                                                <li key={prod}>
                                                    {prod}: 
                                                    {state.gondola ? ' Gôndola' : ''}
                                                    {state.gondola && state.gelada ? ' + ' : ''}
                                                    {state.gelada ? ' Gelada' : ''}
                                                </li>
                                            );
                                        })}
                                        {Object.keys(auditoriaData.presenca).length === 0 && <li>Nenhum item marcado</li>}
                                    </ul>
                                </div>
                                <div>
                                    <p className="font-bold text-gray-700 mb-1">Posicionamento & Promoção:</p>
                                    <ul className="space-y-1 text-gray-600">
                                        <li><strong>Checklist Posicionamento:</strong></li>
                                        {POSICIONAMENTO_CHECKLIST.map(item => {
                                            if (!auditoriaData.posicionamentoChecklist?.[item.id]) return null;
                                            return <li key={item.id} className="pl-2">- {item.label} ({item.points} pts)</li>
                                        })}
                                        <li className="mt-2 font-bold text-gray-700">Promoção (Total Pes: {auditoriaData.visibilidade.totalPes || 0}):</li>
                                        <li>Craft: {auditoriaData.visibilidade.peCraft || 0} PE (Meta: {
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 5 ? '-' : '1'
                                        })</li>
                                        <li>Premium: {auditoriaData.visibilidade.pePremium || 0} PE (Meta: {
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 5 ? '1' :
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 10 ? '2' :
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 15 ? '3' :
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 20 ? '5' : '6'
                                        })</li>
                                        <li>Mainstream: {auditoriaData.visibilidade.peMainstream || 0} PE (Meta: {
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 5 ? '1' :
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 10 ? '1' :
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 15 ? '2' :
                                            (parseInt(auditoriaData.visibilidade.totalPes) || 0) <= 20 ? '2' : '3'
                                        })</li>
                                        <li>Preço Correto: {auditoriaData.precificacao ? 'Sim' : 'Não'}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-3 gap-6">
                        {Object.entries(CATEGORIES).map(([key, config]) => {
                            const catData = allData[key];
                            const worldCm = parseFloat(catData.world) || 0;
                            const productValues = catData.products;
                            
                            let catTotalHnk = 0;
                            config.products.forEach(p => catTotalHnk += (parseFloat(productValues[p]) || 0));
                            
                            const catShare = worldCm > 0 ? ((catTotalHnk / worldCm) * 100).toFixed(1) : 0;
                            const isMet = config.target ? parseFloat(catShare) >= config.target : true;

                            return (
                                <div key={key} className="border-2 border-gray-400 rounded-xl overflow-hidden">
                                    <div className={`${config.headerColor} p-6 flex flex-col gap-3 font-bold uppercase`}>
                                        <div className="flex justify-between items-center">
                                            <span className="text-4xl">{config.title}</span>
                                            <div className="flex gap-8 text-3xl">
                                                {config.target && <span>Meta: {config.target}%</span>}
                                                <span>Atingido: {catShare}%</span>
                                            </div>
                                        </div>
                                        {config.target && (parseFloat(catShare) < config.target) && (
                                            <div className="bg-white/20 p-3 rounded text-center text-2xl mt-2">
                                                Faltam {((worldCm * config.target / 100) - catTotalHnk).toFixed(1)} cm para a meta
                                            </div>
                                        )}
                                    </div>
                                    
                                    <table className="w-full text-3xl">
                                        <thead>
                                            <tr className="bg-gray-100 border-b-2 border-gray-300 text-gray-600">
                                                <th className="p-6 text-left w-1/2">Produto</th>
                                                <th className="p-6 text-center">Executado (cm)</th>
                                                <th className="p-6 text-center">Share Indiv.</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y-2 divide-gray-200">
                                            {config.products.map((prod, idx) => {
                                                const val = parseFloat(productValues[prod]) || 0;
                                                const share = worldCm > 0 ? ((val / worldCm) * 100).toFixed(1) : 0;
                                                return (
                                                    <tr key={idx} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                                        <td className="p-6 font-medium">{prod}</td>
                                                        <td className="p-6 text-center">{val} cm</td>
                                                        <td className="p-6 text-center font-bold text-gray-500">{share}%</td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                        <tfoot className="bg-gray-50 font-bold border-t-2 border-gray-300">
                                            <tr>
                                                <td className="p-6 text-right text-gray-500">TOTAL MUNDO: {worldCm}cm</td>
                                                <td className="p-6 text-center text-gray-800">{catTotalHnk} cm</td>
                                                <td className={`p-6 text-center ${isMet ? 'text-[#008200] bg-green-50' : 'text-red-600 bg-red-50'}`}>
                                                    {isMet ? 'META OK' : 'GAP'}
                                                </td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            );
                        })}

                        <div className="bg-gray-800 text-white p-6 flex justify-between items-center border-t-8 border-[#008200]">
                            <div>
                                <p className="text-sm text-gray-400 uppercase">Resultado Consolidado</p>
                                <p className="font-bold text-2xl">SHARE CERVEJA</p>
                            </div>
                            <div className="text-right">
                                <span className="text-5xl font-bold">{globalData.share}%</span>
                                <p className="text-sm text-gray-400 mt-1">Total HNK: {globalData.hnk}cm / Total Mundo: {globalData.world}cm</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const PRICE_RULER_DATA_CC = [
            { brand: "HEINEKEN", sku: "SHOT 250", price: 5.29, promo: 4.99 },
            { brand: "EISENBAHN PILSEN", sku: "LATA 269", price: 3.09, promo: 3.09 },
            { brand: "AMSTEL", sku: "LATA 269", price: 3.29, promo: 3.09 },
            { brand: "LAGUNITAS", sku: "LONG NECK", price: 10.99, promo: 10.99 },
            // EISENBAHN ESTILOS LONG NECK
            { brand: "EISENBAHN WEIZENBIER", sku: "LONG NECK", price: 6.79, promo: 6.59 },
            { brand: "EISENBAHN PALE ALE", sku: "LONG NECK", price: 6.79, promo: 6.59 },
            { brand: "EISENBAHN IPA", sku: "LONG NECK", price: 6.79, promo: 6.59 },
            { brand: "EISENBAHN SESSION IPA", sku: "LONG NECK", price: 6.79, promo: 6.59 },
            
            { brand: "HEINEKEN", sku: "LONG NECK", price: 6.99, promo: 6.59 },
            { brand: "HEINEKEN 0.0", sku: "LONG NECK", price: 6.99, promo: 6.59 },
            { brand: "SOL PREMIUM", sku: "LONG NECK", price: 5.99, promo: 5.79 },
            { brand: "EISENBAHN PILSEN", sku: "LONG NECK", price: 5.09, promo: 4.19 },
            
            // BADEN BADEN LATA 350
            { brand: "BADEN BADEN WITBIER", sku: "LATA 350", price: 6.09, promo: 5.39 },
            { brand: "BADEN BADEN AMBER", sku: "LATA 350", price: 6.09, promo: 5.39 },
            { brand: "BADEN BADEN IPA", sku: "LATA 350", price: 6.09, promo: 5.39 },
            { brand: "BADEN BADEN CRYSTAL", sku: "LATA 350", price: 6.09, promo: 5.39 },
            { brand: "BADEN BADEN PEACH", sku: "LATA 350", price: 6.09, promo: 5.39 },
            { brand: "BADEN BADEN GOLDEN", sku: "LATA 350", price: 6.09, promo: 5.39 },

            // EISENBAHN ESTILOS LATA 350
            { brand: "EISENBAHN PALE ALE", sku: "LATA 350", price: 5.69, promo: 5.09 },
            { brand: "EISENBAHN IPA", sku: "LATA 350", price: 5.69, promo: 5.09 },
            { brand: "EISENBAHN SESSION IPA", sku: "LATA 350", price: 5.69, promo: 5.09 },

            { brand: "HEINEKEN", sku: "LATA 350", price: 5.69, promo: 5.29 },
            { brand: "HEINEKEN 0.0", sku: "LATA 350", price: 5.69, promo: 5.29 },
            { brand: "EISENBAHN PILSEN", sku: "LATA 350", price: 3.99, promo: 3.99 },
            { brand: "AMSTEL", sku: "LATA 350", price: 3.89, promo: 3.69 },
            { brand: "HEINEKEN", sku: "LATA 473", price: 6.59, promo: 6.09 },
            { brand: "EISENBAHN PILSEN", sku: "LATA 473", price: 4.79, promo: 4.79 },
            { brand: "AMSTEL", sku: "LATA 473", price: 4.89, promo: 4.69 },
            
            // BADEN BADEN 600
            { brand: "BADEN BADEN WITBIER", sku: "600 ML DESC", price: 14.19, promo: 14.19 },
            { brand: "BADEN BADEN IPA", sku: "600 ML DESC", price: 14.19, promo: 14.19 },
            { brand: "BADEN BADEN CRYSTAL", sku: "600 ML DESC", price: 14.19, promo: 14.19 },
            { brand: "BADEN BADEN PEACH", sku: "600 ML DESC", price: 14.19, promo: 14.19 },
            { brand: "BADEN BADEN GOLDEN", sku: "600 ML DESC", price: 14.19, promo: 14.19 },

            { brand: "HEINEKEN", sku: "600 ML DESC", price: 13.49, promo: 13.49 },
            { brand: "HEINEKEN", sku: "DRAUGHT KEG", price: 113.99, promo: 113.99 },
            { brand: "AMSTEL ULTRA", sku: "LATA 269", price: 3.99, promo: 3.49 },
            { brand: "AMSTEL ULTRA", sku: "LONG NECK", price: 4.79, promo: 4.79 },
            { brand: "HEINEKEN", sku: "LATA 269", price: 4.59, promo: 3.99 },
            { brand: "BLUE MOON", sku: "LONG NECK", price: 10.99, promo: 10.99 },
            { brand: "BLUE MOON", sku: "LATA 350", price: 8.99, promo: 6.99 },
            
            // FYS TONICA
            { brand: "FYS TONICA", sku: "LATA 350", price: 2.99, promo: 2.69 },
            { brand: "FYS TONICA ZERO", sku: "LATA 350", price: 2.99, promo: 2.69 },

            // FYS REFRIGERANTES
            { brand: "FYS LIMÃO SICILIANO", sku: "LATA 350", price: 2.79, promo: 2.49 },
            { brand: "FYS LIMÃO SICILIANO ZERO", sku: "LATA 350", price: 2.79, promo: 2.49 },
            { brand: "FYS GUARANÁ", sku: "LATA 350", price: 2.79, promo: 2.49 },
            { brand: "FYS GUARANÁ ZERO", sku: "LATA 350", price: 2.79, promo: 2.49 },
            { brand: "FYS LARANJA", sku: "LATA 350", price: 2.79, promo: 2.49 },
            { brand: "FYS LARANJA ZERO", sku: "LATA 350", price: 2.79, promo: 2.49 },

            { brand: "LAGUNITAS", sku: "LATA 350", price: 8.99, promo: 6.99 },
            { brand: "EISENBAHN UNFILTERED", sku: "LONG NECK", price: 5.09, promo: 4.19 },
            { brand: "EISENBAHN UNFILTERED", sku: "LATA 350", price: 3.99, promo: 3.99 },
            { brand: "HEINEKEN 0.0", sku: "LATA 269", price: 4.59, promo: 3.99 },
            { brand: "CLASHD", sku: "LATA 269", price: 4.59, promo: 3.99 },
            { brand: "AMSTEL", sku: "LONG NECK", price: 4.69, promo: 4.49 },
            
            // AMSTEL VIBES
            { brand: "AMSTEL VIBES LEMON", sku: "LATA 269", price: 5.69, promo: 3.79 },
            { brand: "AMSTEL VIBES STRAWMELLON", sku: "LATA 269", price: 5.69, promo: 3.79 },

            { brand: "EISENBAHN UNFILTERED", sku: "LATA 473", price: 4.79, promo: 4.79 },
            { brand: "SOL PREMIUM", sku: "600 ML DESC", price: 8.99, promo: 8.99 },
            { brand: "SOL PREMIUM 0.0%", sku: "LONG NECK", price: 5.99, promo: 5.79 }
        ];

        const PRICE_RULER_DATA_VAREJO = [
            { brand: "HEINEKEN", sku: "SHOT 250", price: 5.59, promo: 5.29 },
            { brand: "AMSTEL", sku: "LATA 269", price: 3.49, promo: 3.29 },
            { brand: "LAGUNITAS", sku: "LONG NECK", price: 11.59, promo: 11.59 },
            
            // EISENBAHN ESTILOS LONG NECK
            { brand: "EISENBAHN WEIZENBIER", sku: "LONG NECK", price: 7.19, promo: 7.19 },
            { brand: "EISENBAHN PALE ALE", sku: "LONG NECK", price: 7.19, promo: 7.19 },
            { brand: "EISENBAHN IPA", sku: "LONG NECK", price: 7.19, promo: 7.19 },
            { brand: "EISENBAHN SESSION IPA", sku: "LONG NECK", price: 7.19, promo: 7.19 },

            { brand: "HEINEKEN", sku: "LONG NECK", price: 6.99, promo: 6.59 },
            { brand: "HEINEKEN 0.0", sku: "LONG NECK", price: 6.99, promo: 6.59 },
            { brand: "SOL PREMIUM", sku: "LONG NECK", price: 6.29, promo: 6.09 },
            { brand: "EISENBAHN PILSEN", sku: "LONG NECK", price: 5.39, promo: 4.49 },
            
            // BADEN BADEN LATA 350
            { brand: "BADEN BADEN WITBIER", sku: "LATA 350", price: 6.39, promo: 5.69 },
            { brand: "BADEN BADEN AMBER", sku: "LATA 350", price: 6.39, promo: 5.69 },
            { brand: "BADEN BADEN IPA", sku: "LATA 350", price: 6.39, promo: 5.69 },
            { brand: "BADEN BADEN CRYSTAL", sku: "LATA 350", price: 6.39, promo: 5.69 },
            { brand: "BADEN BADEN PEACH", sku: "LATA 350", price: 6.39, promo: 5.69 },
            { brand: "BADEN BADEN GOLDEN", sku: "LATA 350", price: 6.39, promo: 5.69 },

            // EISENBAHN ESTILOS LATA 350
            { brand: "EISENBAHN PALE ALE", sku: "LATA 350", price: 5.99, promo: 5.39 },
            { brand: "EISENBAHN IPA", sku: "LATA 350", price: 5.99, promo: 5.39 },
            { brand: "EISENBAHN SESSION IPA", sku: "LATA 350", price: 5.99, promo: 5.39 },

            { brand: "HEINEKEN", sku: "LATA 350", price: 5.99, promo: 5.59 },
            { brand: "HEINEKEN 0.0", sku: "LATA 350", price: 5.99, promo: 5.59 },
            { brand: "EISENBAHN PILSEN", sku: "LATA 350", price: 4.19, promo: 4.19 },
            { brand: "AMSTEL", sku: "LATA 350", price: 4.09, promo: 3.89 },
            { brand: "HEINEKEN", sku: "LATA 473", price: 7.29, promo: 6.79 },
            { brand: "EISENBAHN PILSEN", sku: "LATA 473", price: 5.29, promo: 5.29 },
            { brand: "AMSTEL", sku: "LATA 473", price: 5.49, promo: 5.29 },
            { brand: "SCHIN", sku: "LATA 473", price: 3.69, promo: 3.69 },
            
            // BADEN BADEN 600
            { brand: "BADEN BADEN WITBIER", sku: "600 ML DESC", price: 14.99, promo: 14.99 },
            { brand: "BADEN BADEN IPA", sku: "600 ML DESC", price: 14.99, promo: 14.99 },
            { brand: "BADEN BADEN CRYSTAL", sku: "600 ML DESC", price: 14.99, promo: 14.99 },
            { brand: "BADEN BADEN PEACH", sku: "600 ML DESC", price: 14.99, promo: 14.99 },
            { brand: "BADEN BADEN GOLDEN", sku: "600 ML DESC", price: 14.99, promo: 14.99 },

            { brand: "HEINEKEN", sku: "600 ML DESC", price: 13.49, promo: 13.49 },
            { brand: "HEINEKEN", sku: "DRAUGHT KEG", price: 119.99, promo: 119.99 },
            { brand: "AMSTEL ULTRA", sku: "LATA 269", price: 4.19, promo: 3.69 },
            { brand: "AMSTEL ULTRA", sku: "LONG NECK", price: 4.99, promo: 4.99 },
            { brand: "HEINEKEN", sku: "LATA 269", price: 4.79, promo: 4.19 },
            { brand: "BLUE MOON", sku: "LONG NECK", price: 11.59, promo: 11.59 },
            { brand: "BLUE MOON", sku: "LATA 350", price: 9.49, promo: 7.39 },
            
            // FYS TONICA
            { brand: "FYS TONICA", sku: "LATA 350", price: 3.19, promo: 2.89 },
            { brand: "FYS TONICA ZERO", sku: "LATA 350", price: 3.19, promo: 2.89 },

            // FYS REFRIGERANTES
            { brand: "FYS LIMÃO SICILIANO", sku: "LATA 350", price: 2.99, promo: 2.59 },
            { brand: "FYS LIMÃO SICILIANO ZERO", sku: "LATA 350", price: 2.99, promo: 2.59 },
            { brand: "FYS GUARANÁ", sku: "LATA 350", price: 2.99, promo: 2.59 },
            { brand: "FYS GUARANÁ ZERO", sku: "LATA 350", price: 2.99, promo: 2.59 },
            { brand: "FYS LARANJA", sku: "LATA 350", price: 2.99, promo: 2.59 },
            { brand: "FYS LARANJA ZERO", sku: "LATA 350", price: 2.99, promo: 2.59 },

            { brand: "EISENBAHN UNFILTERED", sku: "LONG NECK", price: 5.39, promo: 4.49 },
            { brand: "EISENBAHN UNFILTERED", sku: "LATA 350", price: 4.19, promo: 4.19 },
            { brand: "HEINEKEN 0.0", sku: "LATA 269", price: 4.79, promo: 4.19 },
            { brand: "CLASHD", sku: "LATA 269", price: 4.89, promo: 4.29 },
            { brand: "AMSTEL", sku: "LONG NECK", price: 4.99, promo: 4.79 },
            
            // AMSTEL VIBES
            { brand: "AMSTEL VIBES LEMON", sku: "LATA 269", price: 5.99, promo: 3.99 },
            { brand: "AMSTEL VIBES STRAWMELLON", sku: "LATA 269", price: 5.99, promo: 3.99 },

            { brand: "EISENBAHN UNFILTERED", sku: "LATA 473", price: 5.29, promo: 5.29 },
            { brand: "SOL PREMIUM", sku: "600 ML DESC", price: 9.49, promo: 9.49 },
            { brand: "SOL PREMIUM 0.0%", sku: "LONG NECK", price: 6.29, promo: 6.09 }
        ];

        const VALIDITY_DATA_LIST = [
            // HEINEKEN
            { brand: "HEINEKEN", sku: "SHOT 250ml" },
            { brand: "HEINEKEN", sku: "LATA 269ml" },
            { brand: "HEINEKEN", sku: "LATA 350ml" },
            { brand: "HEINEKEN", sku: "LATA 473ml" },
            { brand: "HEINEKEN", sku: "LONG NECK 330ml" },
            { brand: "HEINEKEN", sku: "GARRAFA 600ml" },
            { brand: "HEINEKEN", sku: "KEG 5L" },
            { brand: "HEINEKEN 0.0", sku: "LATA 269ml" },
            { brand: "HEINEKEN 0.0", sku: "LATA 350ml" },
            { brand: "HEINEKEN 0.0", sku: "LONG NECK 330ml" },
            
            // AMSTEL
            { brand: "AMSTEL", sku: "LATA 269ml" },
            { brand: "AMSTEL", sku: "LATA 350ml" },
            { brand: "AMSTEL", sku: "LATA 473ml" },
            { brand: "AMSTEL", sku: "LONG NECK" },
            { brand: "AMSTEL", sku: "GARRAFA 600ml" },
            { brand: "AMSTEL ULTRA", sku: "LATA 269ml" },
            { brand: "AMSTEL ULTRA", sku: "LONG NECK" },
            { brand: "AMSTEL VIBES", sku: "LEMON (LIMÃO) 269ml" },
            { brand: "AMSTEL VIBES", sku: "STRAWMELLON 269ml" },

            // EISENBAHN PILSEN
            { brand: "EISENBAHN PILSEN", sku: "LATA 269ml" },
            { brand: "EISENBAHN PILSEN", sku: "LATA 350ml" },
            { brand: "EISENBAHN PILSEN", sku: "LATA 473ml" },
            { brand: "EISENBAHN PILSEN", sku: "LONG NECK" },
            { brand: "EISENBAHN PILSEN", sku: "GARRAFA 600ml" },

            // EISENBAHN UNFILTERED
            { brand: "EISENBAHN UNFILTERED", sku: "LATA 350ml" },
            { brand: "EISENBAHN UNFILTERED", sku: "LATA 473ml" },
            { brand: "EISENBAHN UNFILTERED", sku: "LONG NECK" },

            // EISENBAHN ESTILOS
            { brand: "EISENBAHN WEIZENBIER", sku: "LONG NECK" },
            { brand: "EISENBAHN PALE ALE", sku: "LONG NECK" },
            { brand: "EISENBAHN PALE ALE", sku: "LATA 350ml" },
            { brand: "EISENBAHN IPA", sku: "LONG NECK" },
            { brand: "EISENBAHN IPA", sku: "LATA 350ml" },
            { brand: "EISENBAHN SESSION IPA", sku: "LONG NECK" },
            { brand: "EISENBAHN SESSION IPA", sku: "LATA 350ml" },

            // BADEN BADEN
            { brand: "BADEN BADEN WITBIER", sku: "LATA 350ml" },
            { brand: "BADEN BADEN WITBIER", sku: "GARRAFA 600ml" },
            { brand: "BADEN BADEN AMBER", sku: "LATA 350ml" },
            { brand: "BADEN BADEN IPA", sku: "LATA 350ml" },
            { brand: "BADEN BADEN IPA", sku: "GARRAFA 600ml" },
            { brand: "BADEN BADEN CRYSTAL", sku: "LATA 350ml" },
            { brand: "BADEN BADEN CRYSTAL", sku: "GARRAFA 600ml" },
            { brand: "BADEN BADEN PEACH", sku: "LATA 350ml" },
            { brand: "BADEN BADEN PEACH", sku: "GARRAFA 600ml" },
            { brand: "BADEN BADEN GOLDEN", sku: "LATA 350ml" },
            { brand: "BADEN BADEN GOLDEN", sku: "GARRAFA 600ml" },

            // SOL
            { brand: "SOL PREMIUM", sku: "LONG NECK" },
            { brand: "SOL PREMIUM", sku: "GARRAFA 600ml" },
            { brand: "SOL PREMIUM 0.0%", sku: "LONG NECK" },

            // PRAYA
            { brand: "PRAYA", sku: "CLASSICA 355ml" },
            { brand: "PRAYA", sku: "CLASSICA 600ml" },
            { brand: "PRAYA", sku: "LAGER 355ml" },

            // LAGUNITAS
            { brand: "LAGUNITAS", sku: "LONG NECK" },
            { brand: "LAGUNITAS", sku: "LATA 350ml" },

            // BLUE MOON
            { brand: "BLUE MOON", sku: "LONG NECK" },
            { brand: "BLUE MOON", sku: "LATA 350ml" },

            // FYS
            { brand: "FYS", sku: "LIMÃO SICILIANO 350ml" },
            { brand: "FYS", sku: "LIMÃO SICILIANO ZERO 350ml" },
            { brand: "FYS", sku: "GUARANÁ DA AMAZÔNIA 350ml" },
            { brand: "FYS", sku: "GUARANÁ DA AMAZÔNIA ZERO 350ml" },
            { brand: "FYS", sku: "LARANJA PERA 350ml" },
            { brand: "FYS", sku: "LARANJA PERA ZERO 350ml" },
            { brand: "FYS TÔNICA", sku: "ÁGUA TÔNICA 350ml" },
            { brand: "FYS TÔNICA", sku: "ÁGUA TÔNICA ZERO 350ml" },
            
             // CLASH'D
            { brand: "CLASHD", sku: "LIMÃO, MORANGO E GENGIBRE 269ml" },
            { brand: "CLASHD", sku: "FRUTAS VERMELHAS E HIBISCO 269ml" },
            { brand: "CLASHD", sku: "MAÇÃ, CANELA E BAUNILHA 269ml" }
        ];

        const SKU_TO_SCORE_GROUP = {
            "BADEN BADEN IPA LATA 350ml": "Baden Baden IPA Lata 350ml OU Vidro 600ml",
            "BADEN BADEN IPA GARRAFA 600ml": "Baden Baden IPA Lata 350ml OU Vidro 600ml",
            "BADEN BADEN WITBIER LATA 350ml": "Baden Baden Witbier Lata 350ml OU Vidro 600ml",
            "BADEN BADEN WITBIER GARRAFA 600ml": "Baden Baden Witbier Lata 350ml OU Vidro 600ml",
            "BADEN BADEN CRYSTAL LATA 350ml": "Baden Baden Pilsen Cristal Lata 350ml OU Vidro 600ml",
            "BADEN BADEN CRYSTAL GARRAFA 600ml": "Baden Baden Pilsen Cristal Lata 350ml OU Vidro 600ml",
            "EISENBAHN IPA LATA 350ml": "Eisenbahn IPA Lata 350ml OU Vidro 355ml",
            "EISENBAHN IPA LONG NECK": "Eisenbahn IPA Lata 350ml OU Vidro 355ml",
            "EISENBAHN PALE ALE LATA 350ml": "Eisenbahn Pale Ale Lata 350ml OU Vidro 355ml",
            "EISENBAHN PALE ALE LONG NECK": "Eisenbahn Pale Ale Lata 350ml OU Vidro 355ml",
            "EISENBAHN SESSION IPA LATA 350ml": "Eisenbahn Session Ipa Lata 350ml OU Vidro 355ml",
            "EISENBAHN SESSION IPA LONG NECK": "Eisenbahn Session Ipa Lata 350ml OU Vidro 355ml",
            "EISENBAHN WEIZENBIER LATA 350ml": "Eisenbahn Weizenbier Vidro 355ml",
            "EISENBAHN WEIZENBIER LONG NECK": "Eisenbahn Weizenbier Vidro 355ml",
            "LAGUNITAS LONG NECK": "Lagunitas IPA Lata 350ml OU Vidro 355ml",
            "LAGUNITAS LATA 350ml": "Lagunitas IPA Lata 350ml OU Vidro 355ml",
            "BLUE MOON LONG NECK": "Blue Moon Lata 350ml ou Vidro 355ml",
            "BLUE MOON LATA 350ml": "Blue Moon Lata 350ml ou Vidro 355ml",
            "PRAYA CLASSICA 355ml": "Praya Classica 355ml OU Classica 600ml",
            "PRAYA CLASSICA 600ml": "Praya Classica 355ml OU Classica 600ml",
            "PRAYA LAGER 355ml": "Praya Lager 355ml",
            "EISENBAHN PILSEN LONG NECK": "Eisenbahn Pilsen Vidro 355ml OU Unfiltered 355ml",
            "EISENBAHN UNFILTERED LONG NECK": "Eisenbahn Pilsen Vidro 355ml OU Unfiltered 355ml",
            "EISENBAHN PILSEN LATA 473ml": "Eisenbahn Pilsen Lata 473ml OU Unfiltered 350ml",
            "EISENBAHN UNFILTERED LATA 350ml": "Eisenbahn Pilsen Lata 473ml OU Unfiltered 350ml",
            "HEINEKEN LATA 350ml": "Heineken Lager Lata 350ml",
            "HEINEKEN LATA 269ml": "Heineken Lager Vidro 250ml OU Lata 269ml",
            "HEINEKEN SHOT 250ml": "Heineken Lager Vidro 250ml OU Lata 269ml",
            "HEINEKEN LATA 473ml": "Heineken Lager Lata 473ml",
            "HEINEKEN LONG NECK 330ml": "Heineken Lager Vidro 330ml",
            "HEINEKEN 0.0 LATA 350ml": "Heineken Pilsen Zero Lata 350ml OU 269ml",
            "HEINEKEN 0.0 LATA 269ml": "Heineken Pilsen Zero Lata 350ml OU 269ml",
            "HEINEKEN 0.0 LONG NECK 330ml": "Heineken Pilsen Zero Vidro 330ml",
            "SOL PREMIUM LONG NECK": "Sol Pilsen Vidro 330ml",
            "AMSTEL ULTRA LONG NECK": "Amstel Ultra Vidro 275ml OU Lata 269ml",
            "AMSTEL ULTRA LATA 269ml": "Amstel Ultra Vidro 275ml OU Lata 269ml",
            "AMSTEL LATA 269ml": "Amstel Lager Lata 269ml",
            "AMSTEL LATA 350ml": "Amstel Lager Lata 350ml",
            "AMSTEL LATA 473ml": "Amstel Lager Lata 473ml",
            "AMSTEL LONG NECK": "Amstel Lager Vidro 355ml",
        };

        const getScoreGroup = (product) => {
            if (SKU_TO_SCORE_GROUP[product]) return SKU_TO_SCORE_GROUP[product];
            if (product.includes("FYS TÔNICA")) return "Fys Tônica Lata 350ml (Regular/Zero)";
            if (product.includes("FYS")) return "Fys (Todos sabores/variações, exceto Tônica)";
            return null;
        };

        const ValidadeReport = ({ data, storeName, fds, date, time }) => {
            return (
                <div className="bg-white p-8 w-[2400px] font-sans text-gray-800 border border-gray-300">
                    <div className="border-b-8 border-blue-600 pb-6 mb-8 flex justify-between items-end">
                        <div>
                            <h1 className="text-6xl font-bold text-blue-600 uppercase tracking-tighter">Relatório de Validade</h1>
                            <p className="text-3xl text-gray-500 font-semibold mt-3">Controle de Vencimentos - Heineken Brasil</p>
                        </div>
                        <div className="text-right text-3xl text-gray-500">
                            <p>{date}</p>
                            <p>{time}</p>
                        </div>
                    </div>

                    <div className="mb-8 grid grid-cols-2 gap-6">
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <span className="text-2xl font-bold text-gray-500 uppercase block mb-2">Loja</span>
                            <span className="text-4xl font-bold text-gray-800">{storeName || '-'}</span>
                        </div>
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <span className="text-2xl font-bold text-gray-500 uppercase block mb-2">Colaborador</span>
                            <span className="text-4xl font-bold text-gray-800">{fds || '-'}</span>
                        </div>
                    </div>

                    <table className="w-full text-2xl border-collapse">
                        <thead>
                            <tr className="bg-gray-100 border-b-4 border-gray-300 text-gray-600 uppercase">
                                <th className="p-4 text-left">Produto</th>
                                <th className="p-4 text-center">Quantidade</th>
                                <th className="p-4 text-center">Data de Vencimento</th>
                                <th className="p-4 text-center">Dias Restantes</th>
                                <th className="p-4 text-center">Status</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y-2 divide-gray-200">
                            {VALIDITY_DATA_LIST.map((item, idx) => {
                                const key = `${item.brand} - ${item.sku}`;
                                const itemData = data[key] || {};
                                const expirationDate = itemData.date;
                                
                                if (!expirationDate) return null;

                                const daysRemaining = Math.ceil((new Date(expirationDate) - new Date()) / (1000 * 60 * 60 * 24));
                                let statusColor = "bg-green-100 text-green-800";
                                let statusText = "OK";

                                if (daysRemaining < 0) {
                                    statusColor = "bg-red-100 text-red-800";
                                    statusText = "VENCIDO";
                                } else if (daysRemaining <= 30) {
                                    statusColor = "bg-amber-100 text-amber-800";
                                    statusText = "CRÍTICO";
                                }

                                return (
                                    <tr key={idx} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                        <td className="p-4 font-medium text-gray-800">{item.brand} {item.sku}</td>
                                        <td className="p-4 text-center font-bold">{itemData.quantity || '-'}</td>
                                        <td className="p-4 text-center">{new Date(expirationDate).toLocaleDateString('pt-BR')}</td>
                                        <td className="p-4 text-center font-bold">{daysRemaining} dias</td>
                                        <td className="p-4 text-center">
                                            <span className={`px-4 py-1 rounded-full font-bold text-xl ${statusColor}`}>
                                                {statusText}
                                            </span>
                                        </td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
            );
        };

        const ValidadeView = ({ data, onChange, onDownload, onDownloadPNG }) => {
            return (
                <div className="space-y-6">
                    <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-lg font-bold text-gray-800 flex items-center gap-2">
                                <RefreshCw className="text-blue-500" />
                                Controle de Validade
                            </h2>
                            <div className="flex gap-2">
                                <button
                                    onClick={onDownload}
                                    className="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700 transition-colors shadow-sm text-xs"
                                >
                                    PDF
                                </button>
                                <button
                                    onClick={onDownloadPNG}
                                    className="flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-600 transition-colors shadow-sm text-xs"
                                >
                                    PNG
                                </button>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 gap-3">
                            {VALIDITY_DATA_LIST.map((item, idx) => {
                                const key = `${item.brand} - ${item.sku}`;
                                const itemData = data[key] || {};
                                const expirationDate = itemData.date || '';
                                const quantity = itemData.quantity || '';
                                let daysRemaining = null;
                                let statusColor = "text-gray-500";

                                if (expirationDate) {
                                    daysRemaining = Math.ceil((new Date(expirationDate) - new Date()) / (1000 * 60 * 60 * 24));
                                    if (daysRemaining < 0) statusColor = "text-red-600 font-bold";
                                    else if (daysRemaining <= 30) statusColor = "text-amber-600 font-bold";
                                    else statusColor = "text-green-600 font-bold";
                                }

                                return (
                                    <div key={idx} className="p-4 rounded-lg border border-gray-200 bg-gray-50">
                                        <div className="flex flex-col md:flex-row justify-between md:items-center gap-4">
                                            <div className="flex-1 min-w-0">
                                                <span className="font-bold text-gray-800 block">{item.brand}</span>
                                                <span className="text-xs text-gray-500 break-words">{item.sku}</span>
                                            </div>
                                            <div className="flex items-center gap-4">
                                                {daysRemaining !== null && (
                                                    <span className={`text-sm ${statusColor}`}>
                                                        {daysRemaining} dias
                                                    </span>
                                                )}
                                                <div className="flex flex-col">
                                                    <label className="text-[10px] font-bold text-gray-500 uppercase mb-1">Qtd</label>
                                                    <input
                                                        type="number"
                                                        value={quantity}
                                                        onChange={(e) => onChange(key, 'quantity', e.target.value)}
                                                        className="p-2 border border-gray-300 rounded text-sm w-20 focus:ring-1 focus:ring-blue-500 outline-none"
                                                        placeholder="0"
                                                    />
                                                </div>
                                                <div className="flex flex-col w-32 sm:w-auto">
                                                    <label className="text-[10px] font-bold text-gray-500 uppercase mb-1">Validade</label>
                                                    <input
                                                        type="date"
                                                        value={expirationDate}
                                                        onChange={(e) => onChange(key, 'date', e.target.value)}
                                                        className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 outline-none"
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        const PriceRulerReport = ({ data, rulerData, storeName, fds, date, time }) => {
            return (
                <div className="bg-white p-8 w-[2400px] font-sans text-gray-800 border border-gray-300">
                    <div className="border-b-8 border-green-600 pb-6 mb-8 flex justify-between items-end">
                        <div>
                            <h1 className="text-6xl font-bold text-green-600 uppercase tracking-tighter">Relatório de Régua de Preço</h1>
                            <p className="text-3xl text-gray-500 font-semibold mt-3">Auditoria de Preços - Heineken Brasil</p>
                        </div>
                        <div className="text-right text-3xl text-gray-500">
                            <p>{date}</p>
                            <p>{time}</p>
                        </div>
                    </div>

                    <div className="mb-8 grid grid-cols-2 gap-6">
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <span className="text-2xl font-bold text-gray-500 uppercase block mb-2">Loja</span>
                            <span className="text-4xl font-bold text-gray-800">{storeName || '-'}</span>
                        </div>
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <span className="text-2xl font-bold text-gray-500 uppercase block mb-2">Colaborador</span>
                            <span className="text-4xl font-bold text-gray-800">{fds || '-'}</span>
                        </div>
                    </div>

                    <table className="w-full text-2xl border-collapse">
                        <thead>
                            <tr className="bg-gray-100 border-b-4 border-gray-300 text-gray-600 uppercase">
                                <th className="p-4 text-left">Produto</th>
                                <th className="p-4 text-center">Preço Régua</th>
                                <th className="p-4 text-center">Preço Loja</th>
                                <th className="p-4 text-center">Status</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y-2 divide-gray-200">
                            {rulerData.map((item, idx) => {
                                const key = `${item.brand} - ${item.sku}`;
                                const entry = data[key] || {};
                                const priceStore = entry.price;
                                const pricePromo = entry.promo;
                                
                                if (!priceStore && !pricePromo) return null;

                                let status = "OK";
                                let statusColor = "bg-green-100 text-green-800";
                                
                                // Validation Logic
                                if (priceStore) {
                                    if (parseFloat(priceStore) !== item.price) {
                                        status = "FORA DA RÉGUA";
                                        statusColor = "bg-red-100 text-red-800";
                                    }
                                }
                                if (pricePromo) {
                                    if (parseFloat(pricePromo) !== item.promo) {
                                        status = "FORA DA RÉGUA (PROMO)";
                                        statusColor = "bg-red-100 text-red-800";
                                    }
                                }

                                return (
                                    <tr key={idx} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                        <td className="p-4 font-medium text-gray-800">{item.brand} {item.sku}</td>
                                        <td className="p-4 text-center">
                                            <div className="flex flex-col">
                                                <span className="text-gray-500 text-2xl">Reg: R$ {item.price.toFixed(2).replace('.', ',')}</span>
                                                <span className="text-gray-500 text-2xl">Promo: R$ {item.promo.toFixed(2).replace('.', ',')}</span>
                                            </div>
                                        </td>
                                        <td className="p-4 text-center font-bold">
                                            {priceStore && <div>Reg: R$ {parseFloat(priceStore).toFixed(2).replace('.', ',')}</div>}
                                            {pricePromo && <div>Promo: R$ {parseFloat(pricePromo).toFixed(2).replace('.', ',')}</div>}
                                        </td>
                                        <td className="p-4 text-center">
                                            <span className={`px-4 py-1 rounded-full font-bold text-xl ${statusColor}`}>
                                                {status}
                                            </span>
                                        </td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
            );
        };

        const PriceRulerView = ({ data, rulerData, onChange, onDownload, onDownloadPNG }) => {
            const formatCurrency = (value) => {
                if (!value) return '';
                return parseFloat(value).toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            };

            const handleCurrencyChange = (key, field, value) => {
                const digits = value.replace(/\D/g, '');
                if (!digits) {
                    onChange(key, field, '');
                    return;
                }
                const number = (parseInt(digits, 10) / 100).toFixed(2);
                onChange(key, field, number);
            };

            return (
                <div className="space-y-6">
                    <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-lg font-bold text-gray-800 flex items-center gap-2">
                                <Tag className="text-green-600" />
                                Régua de Preço
                            </h2>
                            <div className="flex gap-2">
                                <button
                                    onClick={onDownload}
                                    className="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700 transition-colors shadow-sm text-xs"
                                >
                                    PDF
                                </button>
                                <button
                                    onClick={onDownloadPNG}
                                    className="flex items-center gap-2 bg-green-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-600 transition-colors shadow-sm text-xs"
                                >
                                    PNG
                                </button>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 gap-3">
                            {rulerData.map((item, idx) => {
                                const key = `${item.brand} - ${item.sku}`;
                                const entry = data[key] || {};
                                
                                const isStorePriceWrong = entry.price && parseFloat(entry.price) !== item.price;
                                const isPromoPriceWrong = entry.promo && parseFloat(entry.promo) !== item.promo;

                                return (
                                    <div key={idx} className="p-4 rounded-lg border border-gray-200 bg-gray-50">
                                        <div className="flex flex-col gap-3">
                                            <div className="flex justify-between items-start">
                                                <div>
                                                    <span className="font-bold text-gray-800 block">{item.brand}</span>
                                                    <span className="text-xs text-gray-500">{item.sku}</span>
                                                </div>
                                                <div className="text-right text-xs text-gray-500">
                                                    <div>Régua: <span className="font-bold">R$ {item.price.toFixed(2).replace('.', ',')}</span></div>
                                                    <div>Promo: <span className="font-bold">R$ {item.promo.toFixed(2).replace('.', ',')}</span></div>
                                                </div>
                                            </div>
                                            
                                            <div className="flex gap-4">
                                                <div className="flex-1">
                                                    <label className="text-[10px] font-bold text-gray-500 uppercase block mb-1">Preço Loja</label>
                                                    <input
                                                        type="text"
                                                        inputMode="numeric"
                                                        value={formatCurrency(entry.price)}
                                                        onChange={(e) => handleCurrencyChange(key, 'price', e.target.value)}
                                                        className={`w-full p-2 border rounded text-sm outline-none ${isStorePriceWrong ? 'border-red-500 bg-red-50 text-red-700' : 'border-gray-300 focus:border-green-500'}`}
                                                        placeholder="0,00"
                                                    />
                                                    {isStorePriceWrong && <span className="text-[10px] text-red-500 font-bold">Fora da Régua</span>}
                                                </div>
                                                <div className="flex-1">
                                                    <label className="text-[10px] font-bold text-gray-500 uppercase block mb-1">Preço Promo (Caso esteja)</label>
                                                    <input
                                                        type="text"
                                                        inputMode="numeric"
                                                        value={formatCurrency(entry.promo)}
                                                        onChange={(e) => handleCurrencyChange(key, 'promo', e.target.value)}
                                                        className={`w-full p-2 border rounded text-sm outline-none ${isPromoPriceWrong ? 'border-red-500 bg-red-50 text-red-700' : 'border-gray-300 focus:border-green-500'}`}
                                                        placeholder="0,00"
                                                    />
                                                    {isPromoPriceWrong && <span className="text-[10px] text-red-500 font-bold">Fora da Régua</span>}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        const RupturasReport = ({ data, storeType, storeName, fds, date, time }) => {
            const totalPotentialPoints = Object.values(SCORES_PRESENCA).reduce((acc, scores) => {
                const s = scores[storeType] || { gondola: 0, gelada: 0 };
                return acc + s.gondola + s.gelada;
            }, 0);

            // Calculate total lost points based on Score Groups (OR logic)
            const totalLostPoints = Object.keys(SCORES_PRESENCA).reduce((acc, scoreGroup) => {
                // Find all SKUs that belong to this score group
                const groupSkus = VALIDITY_DATA_LIST.filter(item => {
                    const product = `${item.brand} ${item.sku}`;
                    return getScoreGroup(product) === scoreGroup;
                });

                // If no SKUs found for this group (shouldn't happen if mapping is complete), skip
                if (groupSkus.length === 0) return acc;

                // Check if ALL items in this group are 'ruptura'
                const allRuptura = groupSkus.every(item => {
                    const product = `${item.brand} ${item.sku}`;
                    return data[product] === 'ruptura';
                });

                if (allRuptura) {
                    const scores = SCORES_PRESENCA[scoreGroup][storeType] || { gondola: 0, gelada: 0 };
                    return acc + scores.gondola + scores.gelada;
                }

                return acc;
            }, 0);

            const ruptureCount = Object.values(data).filter(s => s === 'ruptura').length;
            const lowVolumeCount = Object.values(data).filter(s => s === 'baixo_volume').length;

            return (
                <div className="bg-white p-8 w-[3200px] font-sans text-gray-800 border border-gray-300">
                    <div className="border-b-8 border-red-600 pb-6 mb-8 flex justify-between items-end">
                        <div>
                            <h1 className="text-6xl font-bold text-red-600 uppercase tracking-tighter">Relatório de Rupturas</h1>
                            <p className="text-3xl text-gray-500 font-semibold mt-3">Gestão de Disponibilidade - Heineken Brasil</p>
                        </div>
                        <div className="text-right text-3xl text-gray-500">
                            <p>{date}</p>
                            <p>{time}</p>
                        </div>
                    </div>

                    <div className="mb-8 grid grid-cols-3 gap-6">
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <span className="text-2xl font-bold text-gray-500 uppercase block mb-2">Loja</span>
                            <span className="text-4xl font-bold text-gray-800">{storeName || '-'}</span>
                        </div>
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <span className="text-2xl font-bold text-gray-500 uppercase block mb-2">Tipo de Loja</span>
                            <span className="text-4xl font-bold text-gray-800 uppercase">{storeType || '-'}</span>
                        </div>
                        <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <span className="text-2xl font-bold text-gray-500 uppercase block mb-2">Colaborador</span>
                            <span className="text-4xl font-bold text-gray-800">{fds || '-'}</span>
                        </div>
                    </div>

                    <div className="grid grid-cols-3 gap-6 mb-8">
                        <div className="bg-red-50 p-6 rounded-xl border border-red-200 text-center">
                            <span className="text-2xl font-bold text-red-600 uppercase block mb-2">Itens em Ruptura</span>
                            <span className="text-6xl font-bold text-red-700">{ruptureCount}</span>
                        </div>
                        <div className="bg-amber-50 p-6 rounded-xl border border-amber-200 text-center">
                            <span className="text-2xl font-bold text-amber-600 uppercase block mb-2">Baixo Volume</span>
                            <span className="text-6xl font-bold text-amber-700">{lowVolumeCount}</span>
                        </div>
                        <div className="bg-gray-800 p-6 rounded-xl border border-gray-700 text-center text-white">
                            <span className="text-2xl font-bold text-gray-400 uppercase block mb-2">Pontos Perdidos</span>
                            <span className="text-6xl font-bold">{totalLostPoints} <span className="text-2xl text-gray-500">/ {totalPotentialPoints}</span></span>
                        </div>
                    </div>

                    <div className="grid grid-cols-4 gap-4">
                        {VALIDITY_DATA_LIST.map((item, idx) => {
                            const product = `${item.brand} ${item.sku}`;
                            const status = data[product] || 'ok';
                            const scoreGroup = getScoreGroup(product);
                            const currentScores = (scoreGroup && SCORES_PRESENCA[scoreGroup] && SCORES_PRESENCA[scoreGroup][storeType]) || { gondola: 0, gelada: 0 };
                            const potentialPoints = currentScores.gondola + currentScores.gelada;
                            
                            // Calculate if points are actually lost for this specific item
                            let isLost = false;
                            if (status === 'ruptura' && scoreGroup) {
                                // Check if any other item in the same group is NOT ruptura
                                const groupSkus = VALIDITY_DATA_LIST.filter(i => getScoreGroup(`${i.brand} ${i.sku}`) === scoreGroup);
                                const anyOk = groupSkus.some(i => {
                                    const p = `${i.brand} ${i.sku}`;
                                    return data[p] !== 'ruptura';
                                });
                                // If NO item is OK (all are ruptura), then points are lost
                                isLost = !anyOk;
                            }

                            const lostPoints = isLost ? potentialPoints : 0;

                            let statusColor = "bg-green-100 text-green-800 border-green-200";
                            let statusText = "OK";
                            if (status === 'ruptura') {
                                statusColor = "bg-red-100 text-red-800 border-red-200";
                                statusText = "RUPTURA";
                            } else if (status === 'baixo_volume') {
                                statusColor = "bg-amber-100 text-amber-800 border-amber-200";
                                statusText = "BAIXO VOL.";
                            }

                            return (
                                <div key={product} className={`p-4 rounded-lg border ${statusColor} flex flex-col justify-between h-full`}>
                                    <div className="mb-2">
                                        <span className="font-bold text-gray-800 text-5xl leading-tight block mb-1">{item.brand}</span>
                                        <span className="text-5xl text-gray-600 block">{item.sku}</span>
                                    </div>
                                    <div className="flex justify-between items-end mt-2">
                                        <span className={`px-3 py-1 rounded-lg text-2xl font-bold uppercase ${status === 'ok' ? 'bg-green-200' : status === 'ruptura' ? 'bg-red-200' : 'bg-amber-200'}`}>
                                            {statusText}
                                        </span>
                                        {lostPoints > 0 && (
                                            <span className="text-red-600 font-bold text-3xl">-{lostPoints} pts</span>
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const RupturasView = ({ storeType, data, onChange, onDownload, onDownloadPNG }) => {
            return (
                <div className="space-y-6">
                    <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                         <div className="flex justify-between items-center mb-4">
                            <h2 className="text-lg font-bold text-gray-800 flex items-center gap-2">
                                <AlertTriangle className="text-red-500" />
                                Controle de Rupturas
                            </h2>
                            <div className="flex gap-2">
                                <button
                                    onClick={onDownload}
                                    className="flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-red-700 transition-colors shadow-sm text-xs"
                                >
                                    PDF
                                </button>
                                <button
                                    onClick={onDownloadPNG}
                                    className="flex items-center gap-2 bg-red-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-red-600 transition-colors shadow-sm text-xs"
                                >
                                    PNG
                                </button>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 gap-3">
                            {VALIDITY_DATA_LIST.map((item) => {
                                const product = `${item.brand} ${item.sku}`;
                                const scoreGroup = getScoreGroup(product);
                                const currentScores = (scoreGroup && SCORES_PRESENCA[scoreGroup] && SCORES_PRESENCA[scoreGroup][storeType]) || { gondola: 0, gelada: 0 };
                                const potentialPoints = currentScores.gondola + currentScores.gelada;
                                const status = data[product] || 'ok';

                                return (
                                    <div key={product} className={`p-4 rounded-lg border transition-all ${
                                        status === 'ruptura' ? 'bg-red-50 border-red-200' : 
                                        status === 'baixo_volume' ? 'bg-amber-50 border-amber-200' : 
                                        'bg-gray-50 border-gray-200'
                                    }`}>
                                        <div className="flex flex-col md:flex-row justify-between md:items-center gap-4">
                                            <div className="flex-1">
                                                <span className="font-bold text-gray-800 block">{product}</span>
                                                <span className="text-xs text-gray-500">Impacto: {potentialPoints} pts</span>
                                            </div>
                                            
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={() => onChange(product, 'ok')}
                                                    className={`px-3 py-2 rounded text-sm font-bold border transition-all ${
                                                        status === 'ok' 
                                                            ? 'bg-green-600 text-white border-green-600 shadow-sm' 
                                                            : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'
                                                    }`}
                                                >
                                                    OK
                                                </button>
                                                <button
                                                    onClick={() => onChange(product, 'baixo_volume')}
                                                    className={`px-3 py-2 rounded text-sm font-bold border transition-all ${
                                                        status === 'baixo_volume' 
                                                            ? 'bg-amber-500 text-white border-amber-500 shadow-sm' 
                                                            : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'
                                                    }`}
                                                >
                                                    Baixo Vol.
                                                </button>
                                                <button
                                                    onClick={() => onChange(product, 'ruptura')}
                                                    className={`px-3 py-2 rounded text-sm font-bold border transition-all ${
                                                        status === 'ruptura' 
                                                            ? 'bg-red-600 text-white border-red-600 shadow-sm' 
                                                            : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'
                                                    }`}
                                                >
                                                    Ruptura
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [allData, setAllData] = useState(() => {
                const initial = {};
                Object.keys(CATEGORIES).forEach(key => initial[key] = { world: '', products: {} });
                return initial;
            });
            
            const [storeName, setStoreName] = useState('');
            const [fds, setFds] = useState('');
            const [activeCategory, setActiveCategory] = useState('premium');
            const [activeView, setActiveView] = useState('simulador');
            const [rupturasData, setRupturasData] = useState({});
            const [validityData, setValidityData] = useState({});
            const [priceRulerData, setPriceRulerData] = useState({});
            
            const rupturasReportRef = useRef(null);
            const validityReportRef = useRef(null);
            const priceRulerReportRef = useRef(null);

            // AUDITORIA STATE
            const [storeType, setStoreType] = useState('hiper');
            const [activeAuditoriaTab, setActiveAuditoriaTab] = useState('presenca');
            const [auditoriaData, setAuditoriaData] = useState({
                presenca: {}, // { "Heineken Lata": { gondola: true, gelada: false } }
                posicionamentoChecklist: {},
                visibilidade: {
                    totalPes: '',
                    peCraft: '',
                    pePremium: '',
                    peMainstream: ''
                },
                precificacao: false
            });

            const reportRef = useRef(null);
            const [isCapturing, setIsCapturing] = useState(false);

            const handleUpdateWorld = (catKey, val) => {
                setAllData(prev => ({
                    ...prev,
                    [catKey]: { ...prev[catKey], world: val }
                }));
            };

            const handleUpdateProduct = (catKey, prodName, val) => {
                setAllData(prev => ({
                    ...prev,
                    [catKey]: {
                        ...prev[catKey],
                        products: { ...prev[catKey].products, [prodName]: val }
                    }
                }));
            };

            // AUDITORIA HANDLERS
            const handleUpdateAuditoriaPresenca = (product, type, value) => {
                setAuditoriaData(prev => ({
                    ...prev,
                    presenca: {
                        ...prev.presenca,
                        [product]: {
                            ...prev.presenca[product],
                            [type]: value
                        }
                    }
                }));
            };

            const handleUpdateAuditoriaVisibilidade = (field, value) => {
                setAuditoriaData(prev => ({
                    ...prev,
                    visibilidade: {
                        ...prev.visibilidade,
                        [field]: value
                    }
                }));
            };

            const handleUpdateAuditoriaPrecificacao = (value) => {
                setAuditoriaData(prev => ({
                    ...prev,
                    precificacao: value
                }));
            };

            const handleUpdateAuditoriaPosicionamentoChecklist = (id, checked) => {
                setAuditoriaData(prev => ({
                    ...prev,
                    posicionamentoChecklist: {
                        ...prev.posicionamentoChecklist,
                        [id]: checked
                    }
                }));
            };

            const handleRupturasChange = (product, status) => {
                setRupturasData(prev => ({ ...prev, [product]: status }));
            };

            const handleValidityChange = (key, field, value) => {
                setValidityData(prev => ({ 
                    ...prev, 
                    [key]: {
                        ...prev[key],
                        [field]: value
                    }
                }));
            };

            const handlePriceRulerChange = (key, field, value) => {
                setPriceRulerData(prev => ({
                    ...prev,
                    [key]: {
                        ...prev[key],
                        [field]: value
                    }
                }));
            };

            const handleReset = () => {
                if(window.confirm("Deseja limpar todos os dados inseridos?")) {
                    const reset = {};
                    Object.keys(CATEGORIES).forEach(key => reset[key] = { world: '', products: {} });
                    setAllData(reset);
                    setStoreName('');
                    setFds('');
                    setAuditoriaData({
                        presenca: {},
                        visibilidade: { totalPes: '', peCraft: '', pePremium: '', peMainstream: '' },
                        precificacao: false
                    });
                    setStoreType('hiper');
                    setRupturasData({});
                    setValidityData({});
                    setPriceRulerData({});
                }
            };

            const calculateGlobalShare = () => {
                let totalHnk = 0;
                let totalWorld = 0;

                Object.entries(allData).forEach(([key, data]) => {
                    if (key === 'nab' || key === 'rtd') return;

                    const worldCm = parseFloat(data.world) || 0;
                    totalWorld += worldCm;
                    
                    const config = CATEGORIES[key];
                    config.products.forEach(prod => {
                        totalHnk += (parseFloat(data.products[prod]) || 0);
                    });
                });

                const share = totalWorld > 0 ? ((totalHnk / totalWorld) * 100).toFixed(1) : '0.0';
                return { share, hnk: totalHnk, world: totalWorld };
            };

            const globalData = calculateGlobalShare();

            const calculateAuditoriaScore = () => {
                // 1. PRESENÇA
                let scorePresenca = 0;
                Object.entries(SCORES_PRESENCA).forEach(([product, scores]) => {
                    const productState = auditoriaData.presenca[product];
                    if (productState) {
                        const typeScores = scores[storeType] || { gondola: 0, gelada: 0 };
                        if (productState.gondola) scorePresenca += typeScores.gondola;
                        if (productState.gelada) scorePresenca += typeScores.gelada;
                    }
                });

                // 2. POSICIONAMENTO (SOVI)
                let scorePosicionamento = 0;
                
                // Helper to calculate share for a category
                const getCatShare = (catKey) => {
                    const catData = allData[catKey];
                    const worldCm = parseFloat(catData.world) || 0;
                    const config = CATEGORIES[catKey];
                    let catTotalHnk = 0;
                    config.products.forEach(prod => {
                        catTotalHnk += (parseFloat(catData.products[prod]) || 0);
                    });
                    return worldCm > 0 ? (catTotalHnk / worldCm) * 100 : 0;
                };

                // Premium Rule: >= 57% -> +9 pts
                if (getCatShare('premium') >= 57) scorePosicionamento += 9;
                
                // Craft Rule: >= 53% -> +8 pts
                if (getCatShare('craft') >= 53) scorePosicionamento += 8;

                // Mainstream Rule: >= 25% -> +8 pts
                if (getCatShare('mainstream') >= 25) scorePosicionamento += 8;
                
                // Checklist Score
                POSICIONAMENTO_CHECKLIST.forEach(item => {
                    if (auditoriaData.posicionamentoChecklist?.[item.id]) {
                        scorePosicionamento += item.points;
                    }
                });

                // 3. VISIBILIDADE
                let scoreVisibilidade = 0;
                const { totalPes, peCraft, pePremium, peMainstream } = auditoriaData.visibilidade;
                
                if (totalPes !== '') {
                    const totalPesVal = parseInt(totalPes);

                    // Determine targets based on Total Feet Range
                    let targetCraft = 0;
                    let targetPremium = 0;
                    let targetMainstream = 0;

                    if (totalPesVal <= 5) {
                        targetCraft = 0;
                        targetPremium = 1;
                        targetMainstream = 1;
                    } else if (totalPesVal >= 6 && totalPesVal <= 10) {
                        targetCraft = 1;
                        targetPremium = 2;
                        targetMainstream = 1;
                    } else if (totalPesVal >= 11 && totalPesVal <= 15) {
                        targetCraft = 1;
                        targetPremium = 3;
                        targetMainstream = 2;
                    } else if (totalPesVal >= 16 && totalPesVal <= 20) {
                        targetCraft = 1;
                        targetPremium = 5;
                        targetMainstream = 2;
                    } else if (totalPesVal >= 21) {
                        targetCraft = 1;
                        targetPremium = 6;
                        targetMainstream = 3;
                    }

                    // Calculate Score - Only if input is provided
                    if (peCraft !== '' && parseInt(peCraft) >= targetCraft) scoreVisibilidade += 6; // Craft (6 pts)
                    if (pePremium !== '' && parseInt(pePremium) >= targetPremium) scoreVisibilidade += 8; // Premium (8 pts)
                    if (peMainstream !== '' && parseInt(peMainstream) >= targetMainstream) scoreVisibilidade += 6; // Mainstream (6 pts)
                }

                // 4. PRECIFICAÇÃO
                const scorePrecificacao = auditoriaData.precificacao ? 5 : 0;

                return {
                    presenca: scorePresenca,
                    posicionamento: scorePosicionamento,
                    visibilidade: scoreVisibilidade,
                    precificacao: scorePrecificacao,
                    total: scorePresenca + scorePosicionamento + scoreVisibilidade + scorePrecificacao
                };
            };



            const handleDownloadPDF = async () => {
                if (!window.html2canvas || !window.jspdf) {
                    alert("As ferramentas de captura ainda estão carregando. Tente novamente em alguns segundos.");
                    return;
                }
                
                setIsCapturing(true);
                try {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    const canvas = await window.html2canvas(reportRef.current, {
                        scale: 1, // Reduced from 2 (3200px width is already high res)
                        backgroundColor: "#ffffff",
                        logging: false,
                        useCORS: true
                    });
                    
                    const imgData = canvas.toDataURL('image/jpeg', 0.98); // JPEG with very high quality
                    const pdf = new window.jspdf.jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4',
                        compress: true // Enable compression
                    });

                    const imgProps = pdf.getImageProperties(imgData);
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    
                    const imgWidth = imgProps.width;
                    const imgHeight = imgProps.height;
                    
                    const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                    
                    const imgX = (pdfWidth - imgWidth * ratio) / 2;
                    const imgY = 0; // Top align

                    pdf.addImage(imgData, 'JPEG', imgX, imgY, imgWidth * ratio, imgHeight * ratio);
                    
                    const dateStr = new Date().toLocaleDateString('pt-BR').replace(/\//g, '-');
                    pdf.save(`RELATORIO_SOVI_HEINEKEN_${dateStr}.pdf`);
                } catch (err) {
                    console.error(err);
                    alert("Erro ao gerar PDF. Tente novamente.");
                } finally {
                    setIsCapturing(false);
                }
            };

            const handleDownloadRupturasReport = async () => {
                await generatePDF(rupturasReportRef, `RELATORIO_RUPTURAS_HEINEKEN`);
            };

            const handleDownloadValidityReport = async () => {
                await generatePDF(validityReportRef, `RELATORIO_VALIDADE_HEINEKEN`);
            };

            const handleDownloadPriceRulerReport = async () => {
                await generatePDF(priceRulerReportRef, `RELATORIO_REGUA_PRECO_HEINEKEN`);
            };

            const handleDownloadRupturasPNG = async () => {
                await generatePNG(rupturasReportRef, `RELATORIO_RUPTURAS_HEINEKEN`);
            };

            const handleDownloadValidityPNG = async () => {
                await generatePNG(validityReportRef, `RELATORIO_VALIDADE_HEINEKEN`);
            };

            const handleDownloadPriceRulerPNG = async () => {
                await generatePNG(priceRulerReportRef, `RELATORIO_REGUA_PRECO_HEINEKEN`);
            };

            const generatePNG = async (ref, filenamePrefix) => {
                if (!window.html2canvas) {
                    alert("As ferramentas de captura ainda estão carregando. Tente novamente em alguns segundos.");
                    return;
                }
                
                setIsCapturing(true);
                try {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    const canvas = await window.html2canvas(ref.current, {
                        scale: 2,
                        backgroundColor: "#ffffff",
                        logging: false,
                        useCORS: true
                    });
                    
                    const link = document.createElement('a');
                    const dateStr = new Date().toLocaleDateString('pt-BR').replace(/\//g, '-');
                    link.download = `${filenamePrefix}_${dateStr}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                } catch (err) {
                    console.error(err);
                    alert("Erro ao gerar imagem. Tente novamente.");
                } finally {
                    setIsCapturing(false);
                }
            };

            const generatePDF = async (ref, filenamePrefix) => {
                if (!window.html2canvas || !window.jspdf) {
                    alert("As ferramentas de captura ainda estão carregando. Tente novamente em alguns segundos.");
                    return;
                }
                
                setIsCapturing(true);
                try {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    const canvas = await window.html2canvas(ref.current, {
                        scale: 1,
                        backgroundColor: "#ffffff",
                        logging: false,
                        useCORS: true
                    });
                    
                    const imgData = canvas.toDataURL('image/jpeg', 0.98);
                    const pdf = new window.jspdf.jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4',
                        compress: true
                    });

                    const imgProps = pdf.getImageProperties(imgData);
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    
                    const imgWidth = imgProps.width;
                    const imgHeight = imgProps.height;
                    
                    const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                    
                    const imgX = (pdfWidth - imgWidth * ratio) / 2;
                    const imgY = 0;

                    pdf.addImage(imgData, 'JPEG', imgX, imgY, imgWidth * ratio, imgHeight * ratio);
                    
                    const dateStr = new Date().toLocaleDateString('pt-BR').replace(/\//g, '-');
                    pdf.save(`${filenamePrefix}_${dateStr}.pdf`);
                } catch (err) {
                    console.error(err);
                    alert("Erro ao gerar PDF. Tente novamente.");
                } finally {
                    setIsCapturing(false);
                }
            };

            const handleDownloadPNG = async () => {
                if (!window.html2canvas) {
                    alert("As ferramentas de captura ainda estão carregando. Tente novamente em alguns segundos.");
                    return;
                }
                
                setIsCapturing(true);
                try {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                    const canvas = await window.html2canvas(reportRef.current, {
                        scale: 2,
                        backgroundColor: "#ffffff",
                        logging: false,
                        useCORS: true
                    });
                    
                    const link = document.createElement('a');
                    link.download = `RELATORIO_SOVI_HEINEKEN_${new Date().toLocaleDateString('pt-BR').replace(/\//g, '-')}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                } catch (err) {
                    console.error(err);
                    alert("Erro ao gerar imagem. Tente novamente.");
                } finally {
                    setIsCapturing(false);
                }
            };

            const auditoriaScore = calculateAuditoriaScore();
            
            const activePriceRulerData = storeType === 'cc' ? PRICE_RULER_DATA_CC : PRICE_RULER_DATA_VAREJO;

            return (
                <div className="min-h-screen pb-20 font-sans text-gray-800">
                    <header className="bg-[#008200] text-white p-4 shadow-lg sticky top-0 z-50">
                        <div className="max-w-md mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <Star className="fill-current text-red-500" />
                                <h1 className="text-xl font-bold tracking-tighter">SIMULADOR DE FDS</h1>
                                <span className="text-[10px] text-white/80 ml-1 font-normal">Desenvolvido por: Pedro Lameirão</span>
                            </div>
                            <button onClick={handleReset} className="text-white/80 hover:text-white transition-colors">
                                <RefreshCw size={20} />
                            </button>
                        </div>
                    </header>

                    <main className="max-w-md mx-auto p-4">
                        {/* Navigation Bar */}
                        <div className="bg-white p-1 rounded-xl shadow-sm border border-gray-100 mb-6 flex gap-1">
                            <button
                                onClick={() => setActiveView('simulador')}
                                className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${
                                    activeView === 'simulador'
                                        ? 'bg-[#008200] text-white shadow-md'
                                        : 'text-gray-500 hover:bg-gray-50'
                                }`}
                            >
                                Simulador
                            </button>
                            <button
                                onClick={() => setActiveView('rupturas')}
                                className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${
                                    activeView === 'rupturas'
                                        ? 'bg-red-600 text-white shadow-md'
                                        : 'text-gray-500 hover:bg-gray-50'
                                }`}
                            >
                                Rupturas
                            </button>
                            <button
                                onClick={() => setActiveView('validade')}
                                className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${
                                    activeView === 'validade'
                                        ? 'bg-blue-600 text-white shadow-md'
                                        : 'text-gray-500 hover:bg-gray-50'
                                }`}
                            >
                                Validade
                            </button>
                            <button
                                onClick={() => setActiveView('regua')}
                                className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${
                                    activeView === 'regua'
                                        ? 'bg-green-600 text-white shadow-md'
                                        : 'text-gray-500 hover:bg-gray-50'
                                }`}
                            >
                                Régua de Preço
                            </button>
                        </div>

                        <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-6">
                            <h2 className="text-sm font-bold text-gray-400 uppercase mb-3">Dados da Loja</h2>
                            <div className="space-y-3">
                                <div>
                                    <label className="block text-xs font-bold text-gray-500 mb-1">NOME DA LOJA</label>
                                    <input 
                                        type="text" 
                                        value={storeName}
                                        onChange={(e) => setStoreName(e.target.value)}
                                        className="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg outline-none focus:border-[#008200] transition-all"
                                        placeholder="EX: Supermercado Pão de Mel"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-gray-500 mb-1">NOME DO COLABORADOR</label>
                                    <input 
                                        type="text" 
                                        value={fds}
                                        onChange={(e) => setFds(e.target.value)}
                                        className="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg outline-none focus:border-[#008200] transition-all"
                                        placeholder="Ex: João Silva"
                                    />
                                </div>
                            </div>
                        </div>

                        <StoreTypeSelector selected={storeType} onSelect={setStoreType} />
                        
                        {activeView === 'simulador' && (
                            <>
                                <AuditoriaScorecard scores={auditoriaScore} totalScore={auditoriaScore.total} />

                                <AuditoriaTabs 
                                    activeTab={activeAuditoriaTab} 
                                    onTabChange={setActiveAuditoriaTab}
                                    presencaData={auditoriaData.presenca}
                                    onPresencaChange={handleUpdateAuditoriaPresenca}
                                    storeType={storeType}
                                    allData={allData}
                                    CATEGORIES={CATEGORIES}
                                    activeCategory={activeCategory}
                                    onSelectCategory={setActiveCategory}
                                    onUpdateWorld={handleUpdateWorld}
                                    onUpdateProduct={handleUpdateProduct}
                                    checklistData={auditoriaData.posicionamentoChecklist}
                                    onChecklistChange={handleUpdateAuditoriaPosicionamentoChecklist}
                                    visibilidadeData={auditoriaData.visibilidade}
                                    onVisibilidadeChange={handleUpdateAuditoriaVisibilidade}
                                    precificacaoData={auditoriaData.precificacao}
                                    onPrecificacaoChange={handleUpdateAuditoriaPrecificacao}
                                    auditoriaScore={auditoriaScore}
                                />

                                <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-40">
                                    <div className="max-w-md mx-auto flex gap-3">
                                        <div className="flex-1">
                                            <p className="text-xs text-gray-500 font-bold uppercase">Share Cerveja</p>
                                            <p className="text-3xl font-bold text-[#008200]">{globalData.share}%</p>
                                        </div>
                                        <div className="flex items-center gap-2 text-sm font-bold text-gray-500">
                                            Baixe o seu relatório <ArrowRight size={16} />
                                        </div>
                                        <div className="flex gap-2">
                                            <button 
                                                onClick={handleDownloadPDF}
                                                disabled={isCapturing}
                                                className="bg-[#008200] text-white px-4 py-2 rounded-lg font-bold shadow-lg active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex flex-col items-center justify-center text-xs"
                                            >
                                                <span>{isCapturing ? '...' : 'PDF'}</span>
                                            </button>
                                            <button 
                                                onClick={handleDownloadPNG}
                                                disabled={isCapturing}
                                                className="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold shadow-lg active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex flex-col items-center justify-center text-xs"
                                            >
                                                <span>{isCapturing ? '...' : 'PNG'}</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </>
                        )}

                        {activeView === 'rupturas' && (
                            <RupturasView 
                                storeType={storeType}
                                data={rupturasData}
                                onChange={handleRupturasChange}
                                onDownload={handleDownloadRupturasReport}
                                onDownloadPNG={handleDownloadRupturasPNG}
                            />
                        )}

                        {activeView === 'validade' && (
                            <ValidadeView 
                                data={validityData}
                                onChange={handleValidityChange}
                                onDownload={handleDownloadValidityReport}
                                onDownloadPNG={handleDownloadValidityPNG}
                            />
                        )}

                        {activeView === 'regua' && (
                            <PriceRulerView 
                                data={priceRulerData}
                                rulerData={activePriceRulerData}
                                onChange={handlePriceRulerChange}
                                onDownload={handleDownloadPriceRulerReport}
                                onDownloadPNG={handleDownloadPriceRulerPNG}
                            />
                        )}
                    </main>

                    {/* Hidden Report for Capture */}
                    <div className="fixed top-0 left-0 -z-50 opacity-0 pointer-events-none">
                        <div ref={rupturasReportRef}>
                            <RupturasReport 
                                data={rupturasData}
                                storeType={storeType}
                                storeName={storeName}
                                fds={fds}
                                date={new Date().toLocaleDateString('pt-BR')}
                                time={new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}
                            />
                        </div>
                        <div ref={validityReportRef}>
                            <ValidadeReport 
                                data={validityData}
                                storeName={storeName}
                                fds={fds}
                                date={new Date().toLocaleDateString('pt-BR')}
                                time={new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}
                            />
                        </div>
                        <div ref={priceRulerReportRef}>
                            <PriceRulerReport 
                                data={priceRulerData}
                                rulerData={activePriceRulerData}
                                storeName={storeName}
                                fds={fds}
                                date={new Date().toLocaleDateString('pt-BR')}
                                time={new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}
                            />
                        </div>
                        <div ref={reportRef}>
                            <ReportTable 
                                allData={allData} 
                                globalData={globalData}
                                date={new Date().toLocaleDateString('pt-BR')}
                                time={new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}
                                storeName={storeName}
                                fds={fds}
                                auditoriaData={auditoriaData}
                                auditoriaScore={auditoriaScore}
                                storeType={storeType}
                            />
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
